

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>chplvis &mdash; Chapel Documentation 1.24</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Mason" href="../mason/mason.html" />
    <link rel="prev" title="chpldoc" href="../chpldoc/man.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.24
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.24";
$pagename = "tools/chplvis/chplvis";
include "../..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../c2chapel/c2chapel.html">c2chapel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chpldoc/chpldoc.html">chpldoc</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">chplvis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-task-and-communication-debug-tool-for-chapel">A Task and Communication Debug Tool for Chapel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chapel-source-code">Chapel Source Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-1">Example 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chplvis-elements">chplvis Elements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#graph-view">Graph View</a></li>
<li class="toctree-l4"><a class="reference internal" href="#grid-view">Grid View</a></li>
<li class="toctree-l4"><a class="reference internal" href="#concurrency-view">Concurrency View</a></li>
<li class="toctree-l4"><a class="reference internal" href="#profile-view">Profile View</a></li>
<li class="toctree-l4"><a class="reference internal" href="#settings">Settings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#display-interaction">Display Interaction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-2">Example 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-3">Example 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-4">Example 4</a></li>
<li class="toctree-l3"><a class="reference internal" href="#config-parameters-and-variables">Config Parameters and Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#final-comments">Final Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mason/mason.html">Mason</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protoc-gen-chpl/protoc-gen-chpl.html">Protocol Buffers Support in Chapel</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../primers/index.html">Primers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mason-packages.html">Mason Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Tools</a> &raquo;</li>
        
      <li>chplvis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tools/chplvis/chplvis.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chplvis">
<span id="id1"></span><h1>chplvis<a class="headerlink" href="#chplvis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="a-task-and-communication-debug-tool-for-chapel">
<h2>A Task and Communication Debug Tool for Chapel<a class="headerlink" href="#a-task-and-communication-debug-tool-for-chapel" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">chplvis</span></code> is a tool to help the Chapel programmer visualize their
Chapel program’s tasks and communication between locales.  Using the
standard module <a class="reference internal" href="../../modules/packages/VisualDebug.html#module-VisualDebug" title="VisualDebug: Support for the visualization tool :ref:`chplvis`."><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">VisualDebug</span></code></a>, the programmer controls what part
of their program generates information for <code class="docutils literal notranslate"><span class="pre">chplvis</span></code>.  During the run of
a program using the <a class="reference internal" href="../../modules/packages/VisualDebug.html#module-VisualDebug" title="VisualDebug: Support for the visualization tool :ref:`chplvis`."><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">VisualDebug</span></code></a> module, data files are
created that are used as input for <code class="docutils literal notranslate"><span class="pre">chplvis</span></code>.  This document
will help you understand the <a class="reference internal" href="../../modules/packages/VisualDebug.html#module-VisualDebug" title="VisualDebug: Support for the visualization tool :ref:`chplvis`."><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">VisualDebug</span></code></a> module and the
<code class="docutils literal notranslate"><span class="pre">chplvis</span></code> tool.</p>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">chplvis</span></code> is built by giving the command <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">chplvis</span></code> at the top level of
the chapel tree.  This also builds the GUI tool, <em>FLTK</em>, required to build and
run <code class="docutils literal notranslate"><span class="pre">chplvis</span></code>.  (Note: Some versions of Linux may require the standard
package <code class="docutils literal notranslate"><span class="pre">libx11-dev</span></code> to be installed before <em>FLTK</em> will compile properly.)
To get the most out of this primer, you should compile and run the example
programs and examine the <a class="reference internal" href="../../modules/packages/VisualDebug.html#module-VisualDebug" title="VisualDebug: Support for the visualization tool :ref:`chplvis`."><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">VisualDebug</span></code></a> results with <code class="docutils literal notranslate"><span class="pre">chplvis</span></code>.  The
example programs are found on the path <code class="docutils literal notranslate"><span class="pre">examples/primers/chplvis</span></code>.  The
graphics in this primer were produced on a system using the <code class="docutils literal notranslate"><span class="pre">fifo</span></code> threads
instead of the default, <code class="docutils literal notranslate"><span class="pre">qthreads</span></code>, for the tasking layer.   If you use
<code class="docutils literal notranslate"><span class="pre">qthreads</span></code>, your task count may differ from the examples.</p>
</div>
<div class="section" id="chapel-source-code">
<h2>Chapel Source Code<a class="headerlink" href="#chapel-source-code" title="Permalink to this headline">¶</a></h2>
<p>To use <code class="docutils literal notranslate"><span class="pre">chplvis</span></code>, the programmer adds code to their program.  In many
cases, the programmer may want to investigate only part of the program.  This
is accomplished by having functions <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.startVdebug" title="VisualDebug.startVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">startVdebug</span></code></a> and
<a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.stopVdebug" title="VisualDebug.stopVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">stopVdebug</span></code></a> to control where to start and stop the
instrumentation of their program.  Compilation and execution of these programs
remain the same.  When the <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.startVdebug" title="VisualDebug.startVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">startVdebug</span></code></a> is executed, a
collection of files, one per locale, are created in a directory with the
<code class="docutils literal notranslate"><span class="pre">name</span></code> given in <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.startVdebug" title="VisualDebug.startVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">startVdebug</span></code></a>.</p>
</div>
<div class="section" id="example-1">
<h2>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h2>
<p>Consider the chapel program <code class="docutils literal notranslate"><span class="pre">chplvis1.chpl</span></code>: (The example programs in this
primer are found in the directory <code class="docutils literal notranslate"><span class="pre">examples/primers/chplvis</span></code> in your
distribution tree.)</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="c1">// chplvis: Basic Usage</span>

<span class="c1">//  Example 1 using visual debug</span>

<span class="c1">//  The standard module &quot;VisualDebug&quot; is needed to generate data</span>
<span class="c1">//  during the program&#39;s run for chplvis.</span>

<span class="k">use</span> <span class="nx">VisualDebug</span><span class="p">;</span>

<span class="c1">//  This call requests the VisualDebug system to start the</span>
<span class="c1">//  generation of data files that tracks communication</span>
<span class="c1">//  between locales and tasks.</span>

<span class="nx">startVdebug</span><span class="p">(</span><span class="s">&quot;E1&quot;</span><span class="p">);</span>

<span class="c1">//  This is a simple loop that runs tasks on all locales</span>

<span class="k">coforall</span> <span class="nx">loc</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="k">do</span>
  <span class="k">on</span> <span class="nx">loc</span> <span class="k">do</span> <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Hello from locale &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">);</span>

<span class="c1">//  This stops the VisualDebug system and close the data files.</span>

<span class="nx">stopVdebug</span><span class="p">();</span>

<span class="c1">//  Now that the program has completed and generated data files,</span>
<span class="c1">//  run &quot;chplvis E1&quot; to look at the results.</span>
</pre></div>
</div>
<p>Compiling the program and running it with the options <code class="docutils literal notranslate"><span class="pre">-nl</span> <span class="pre">6</span></code> will then
produce a directory called <code class="docutils literal notranslate"><span class="pre">E1</span></code> containing 6 data files, one
for each of the locales and named <code class="docutils literal notranslate"><span class="pre">E1-n</span></code> where <code class="docutils literal notranslate"><span class="pre">n</span></code> is
replaced with the locale number, a number from 0 to 5.  Once this
directory is created, one can run <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> as <code class="docutils literal notranslate"><span class="pre">chplvis</span> <span class="pre">E1</span></code> or
simply <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> and then open the file <code class="docutils literal notranslate"><span class="pre">E1/E1-0</span></code> from the
<code class="docutils literal notranslate"><span class="pre">file/open</span></code> menu.  The resulting display is:</p>
<img alt="../../_images/E1.png" src="../../_images/E1.png" />
<p>(Note: This image is from an X11 display.  On OS-X, the menu bar
will be on the normal menu bar at the top of the screen and will
not show in the main window.)</p>
</div>
<div class="section" id="chplvis-elements">
<h2>chplvis Elements<a class="headerlink" href="#chplvis-elements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The <em>information</em> box shows the file set opened, which tag (see
<a class="reference internal" href="#example-2">Example 2</a> ) is displayed, the maximum values of the data
currently being displayed and a color bar to help visually see what
values are displayed for locales and communication.  This
<em>information</em> box is also used to show various other information as
described below.</p></li>
<li><p>The <em>view selection</em> box on the left edge of the display allows the
user to select how to view the <em>VisualDebug</em> data.  There are four
data views and a settings view.</p></li>
<li><p>The <em>data view area</em> box is the main display of data.  The data views
are the <em>graph</em> view, the <em>grid</em> view, the <em>concurrency</em> view and the
<em>profile</em> view.  The <em>settings</em> view is also displayed in the
<em>data view area</em>.</p></li>
<li><p>Menus control many aspects of <code class="docutils literal notranslate"><span class="pre">chplvis</span></code>.   These menus are different
depending what data view is visible.   Also, a mouse right click
in the <em>data view area</em> will cause a pop-up menu to be shown that
is a duplicate of the data view’s menus on the main menu bar.</p></li>
</ul>
<div class="section" id="graph-view">
<h3>Graph View<a class="headerlink" href="#graph-view" title="Permalink to this headline">¶</a></h3>
<p>The <em>graph view</em> is the default view when <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> is run. The
following are shown in the <em>graph view</em>:</p>
<ul>
<li><p>A <em>Locale</em> is represented by a colored box.  The initial display
draws the color of the locale to represent the number of tasks run
at that locale.  For example 1, we can see that locale 0 has the
most tasks and we expect that to be 12 since that is the maximum
number of tasks as shown by the color reference in the information
box at the top of the window.  Hover your mouse over a locale and it
will display a “tooltip” that is the value for that locale.</p></li>
<li><p><em>Communication links</em> are shown by lines between two
locale boxes.  The color of the line adjacent to a locale box
represents the data being sent to that locale from the locale on
the other end.   For example 1, the line between locale 0 and
locale 1 is colored red next to locale 0.  This means that there
is a lot of communications <em>into locale 0</em> from locale 1.
The blue line next to locale 1 means that there is little
communication <em>into locale 1</em> from locale 0.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If two locales do not communicate, no line is drawn between them.  If
communication is only one way, the communication color for <em>no
communication</em> is gray.</p>
</div>
</li>
<li><p>The <em>Data</em> menu controls what data is used for the display colors
and available tooltip values.  This initial data is number of tasks
for locales and number of communications calls for the communication
links.  For locales, one can select number of tasks, CPU time, clock
time or concurrency.  Clock time is normally very close to equal
across all locales.  For the communication links, one can select
number of communications or size of data sent.</p></li>
<li><p>The <em>View</em> menu allows the user to zoom in or out in the data display.</p></li>
</ul>
</div>
<div class="section" id="grid-view">
<h3>Grid View<a class="headerlink" href="#grid-view" title="Permalink to this headline">¶</a></h3>
<p>The <em>grid view</em> displays the same information as the <em>graph view</em> but in
a different format. The <em>grid view</em> display looks like:</p>
<img alt="../../_images/E1-grid.png" src="../../_images/E1-grid.png" />
<p>The elements of the <em>grid view</em> are:</p>
<ul class="simple">
<li><p>Each <em>Locale</em> is shown twice in this view, vertical on the left of
the view and horizontal along the top of the view.  The top most
and left most locales represent <em>locale 0</em>.  (If the box is big enough,
the locale number is placed in the box.  With a large number of locales
displayed, they locale number may be too big to fit in the display box.)</p></li>
<li><p><em>Communication links</em> are shown as boxes in the center of the display.
Data transmission is <em>from</em> locale i on the left <em>to</em> locale j on the top
and is shown in the box on row i and column j.  This box is colored to
represent the amount of data sent from locale i to locale j.  (This is
either the number of communications or the size of data sent as controlled
by the <em>Data</em> menu.)  Communication boxes with no color represent no
communication.  (The diagonal will always be white since no locale sends
data to itself over the communication subsystem.)</p></li>
<li><p>The menus for the <em>grid view</em> are the same as the <em>graph view</em>.</p></li>
</ul>
</div>
<div class="section" id="concurrency-view">
<span id="id2"></span><h3>Concurrency View<a class="headerlink" href="#concurrency-view" title="Permalink to this headline">¶</a></h3>
<p>The <em>concurrency view</em> shows task information for a single locale.  Chapel
programs run by starting low level tasks to do the required jobs. This
display shows the order the tasks are executed and the color of each
task shows the clock time for that task.  The black vertical vertical
lines show the life time of the task.  There are two kinds of tasks
shown: tasks started remotely via the <code class="docutils literal notranslate"><span class="pre">on</span></code> statements (on calls) to
this locale indicated by an <em>OC</em> and tasks started locally indicated
by an <em>L</em>.  Also, some tasks communicate with other locales and others
do not.   The tasks that communicate with other locales are marked with
an asterisk before the <em>OC</em> or <em>L</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The task order may change from run to run.  The following shows one possible
execution order of the tasks:</p>
</div>
<img alt="../../_images/E1-L0-cw.png" src="../../_images/E1-L0-cw.png" />
<p>Note the special <em>Main</em> task.  It is shown as a square gray box because
it was already running at the start of the displayed data.</p>
<p>Menus allow the user to change the displayed locale and tag.  The
above example does not show the tags menu because no tags were
defined for this example program.</p>
</div>
<div class="section" id="profile-view">
<h3>Profile View<a class="headerlink" href="#profile-view" title="Permalink to this headline">¶</a></h3>
<p>Chapel programs are run by the runtime executing tasks.  Each task runs
an <em>internal function</em>.   These functions are generated by the compiler and
the VisualDebug system tracks these functions and tasks.   In the <em>profile
view</em>, these functions are displayed.   Data collected for each function is
total CPU and clock time spent in the function as well as the number of
puts, gets and ‘on calls’ performed by the function.   This view sorts the
list of internal functions based on the chosen data.  The default data
is clock time.  Functions with a zero value are not displayed, so not
every function will be displayed for all data selections.  Each line
shows the data (e.g. clock), the internal function name which may not
make much sense to the developer, and the Chapel source file and line number
that for which the task was created.  The following
as an example of the <em>profile view</em>.</p>
<img alt="../../_images/E1-prof.png" src="../../_images/E1-prof.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Clock time for a function is total time for all tasks that
run in that function.  This shows a total accumulation of time, but
it does not show the effects of concurrency on running time of the
program.  At the current time, the data does not easily yield the
total time a function contributes to the overall time of a program.</p>
</div>
</div>
<div class="section" id="settings">
<h3>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">chplvis</span></code> has two settings that are set by a <em>settings view</em> and are
saved in a file named <code class="docutils literal notranslate"><span class="pre">~/.cache/chplvis</span></code>.   First, the user can
select custom colors for the ‘heat’ displays.  The standard colors are
used in this document.  Next, <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> can save the window size
of the main display for use on the next execution.   Both of these
settings are set in the settings window.  The settings window is
opened via the <code class="docutils literal notranslate"><span class="pre">file/settings</span></code> menu option.  The settings window
looks like:</p>
<img alt="../../_images/S1.png" src="../../_images/S1.png" />
<p>The <code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">for</span> <span class="pre">this</span> <span class="pre">run</span> <span class="pre">only</span></code> button allows the user to choose custom
heat colors for the current run only and on the next run, the default
or saved colors will be used.   The <code class="docutils literal notranslate"><span class="pre">window</span> <span class="pre">size</span></code> setting is
ignored when this button is clicked.</p>
</div>
</div>
<div class="section" id="display-interaction">
<h2>Display Interaction<a class="headerlink" href="#display-interaction" title="Permalink to this headline">¶</a></h2>
<p>Clicking on elements of the display will bring up more information.
In <em>graph view</em> and <em>grid view</em>, clicking on a locale will add a box
to the <em>information</em> box with the information about that locale.  In
example 1, clicking on locale 0 when the locale data is ‘number of
tasks’, ‘CPU time’ or ‘clock time’ will produce a display that looks
like:</p>
<img alt="../../_images/E1-L0.png" src="../../_images/E1-L0.png" />
<p>(Note: There is overhead generated in tasks, CPU time, clock time and
communication for the Visual Debug function calls.  <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> removes
the overhead tasks and communication from displayed values, but it can
not remove the CPU and clock time overhead.)</p>
<p>In <em>grid view</em>, clicking on a communication line will create an
<em>information</em> box with communication information for that link.  Clicking red
part of the line between locale 0 and locale 1 will produce a display
that looks like:</p>
<img alt="../../_images/E1-C1.0.png" src="../../_images/E1-C1.0.png" />
<p>It is important to notice the direction of the <em>arrow</em> in the header
for the box.  This is for communication from locale 1 to locale 0.
The total number of communication calls was 12.  It is further broken
out into three components:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Gets:</em> This is a communication call initiated by locale 0 to
get a data located on locale 1.</p></li>
<li><p><em>Puts:</em> This is a communication call initiated by <em>locale 1</em>
to put data from locale 1 onto locale 0.</p></li>
<li><p><em>On Calls:</em> This where <em>locale 1</em> starts a task running
on locale 0.  As part of the task start, a block of data is sent to
locale 0 as an argument to the task.  This data is considered a
communication call  by <em>chplvis</em>.</p></li>
</ul>
</div></blockquote>
<p>The same communication information box is presented in <em>grid view</em> when
a communication box is clicked.</p>
<p>When the locale data selected is ‘concurrency’ in <em>graph view</em> or
<em>grid view</em>, clicking on a locale will switch to the
<a class="reference internal" href="#concurrency-view">Concurrency View</a> and select the locale which was clicked.</p>
<p>In the <em>Concurrency View</em>, clicking on a task that has communication
(noted by the asterisk) will bring up a list of communications.  This
looks like:</p>
<img alt="../../_images/E1-L0-tc.png" src="../../_images/E1-L0-tc.png" />
<p>The number in brackets is the clock time since the task started
execution.   This list gives details about the <em>gets</em>, <em>puts</em> and
<em>on calls</em> initiated by this task.</p>
<p>In this list, clicking on any line that has a file name will bring up
that source code file and position the display on the line responsible
for the communication.  This line in the source code file is
highlighted.</p>
<img alt="../../_images/E1-L0-cf.png" src="../../_images/E1-L0-cf.png" />
<p>In a similar way, in the <em>Profile View</em>, clicking on a function line
will also display the file and line, highlighted, of the line that
caused the internal function to be defined.</p>
<p><em>Tool tips</em> are available in several of the data views.  Locales
in the <em>graph</em> and <em>grid</em> views have tool tips that show the value
selected for display, for example, the clock time.  In the <em>grid view</em>,
the communication squares have tool tips showing the communication value
selected.  In the <em>concurrency view</em>, tool tips show the communication
values and in the case of a local task, the file and line number that
called that task.</p>
</div>
<div class="section" id="example-2">
<span id="id3"></span><h2>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h2>
<p>In many programs, one will want to look at a number of small parts of
their program in addition to seeing the total statistics.  <code class="docutils literal notranslate"><span class="pre">chplvis2.chpl</span></code>
gives an example of using the <a class="reference internal" href="../../modules/packages/VisualDebug.html#module-VisualDebug" title="VisualDebug: Support for the visualization tool :ref:`chplvis`."><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">VisualDebug</span></code></a> functions
<a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.tagVdebug" title="VisualDebug.tagVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">tagVdebug</span></code></a> and <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.pauseVdebug" title="VisualDebug.pauseVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">pauseVdebug</span></code></a>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="c1">// chplvis: Tags</span>

<span class="c1">// Example 2 of use of the VisualDebug module and chplvis tool.</span>

<span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">VisualDebug</span><span class="p">;</span>

<span class="kd">config</span> <span class="kd">var</span> <span class="nx">ncells</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="k">proc</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

   <span class="c1">// Create a couple of domains and a block mapped data array.</span>
   <span class="kd">const</span> <span class="nx">Domain</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">..</span> <span class="nx">ncells</span> <span class="p">};</span>
   <span class="kd">const</span> <span class="nx">mapDomain</span> <span class="o">=</span> <span class="nx">Domain</span> <span class="k">dmapped</span> <span class="nx">Block</span><span class="p">(</span><span class="nx">Domain</span><span class="p">);</span>

   <span class="kd">var</span>  <span class="nx">data</span> <span class="p">:</span> <span class="p">[</span><span class="nx">mapDomain</span><span class="p">]</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

   <span class="c1">// Start VisualDebug here</span>
   <span class="nx">startVdebug</span> <span class="p">(</span><span class="s">&quot;E2&quot;</span><span class="p">);</span>

   <span class="c1">// First computation step ... a simple forall</span>
   <span class="c1">// Even though the data is distributed, the computation is</span>
   <span class="c1">// on Locale 0.  chplvis shows no computation on locales</span>
   <span class="c1">// other than 0.   Domain is not dmapped.</span>
   <span class="k">forall</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">Domain</span> <span class="k">do</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
   
   <span class="c1">// Write the result, we want to see the results of the above</span>
   <span class="c1">// so we tag before we continue.  Computation only on locale 0.</span>
   <span class="nx">tagVdebug</span><span class="p">(</span><span class="s">&quot;writeln 1&quot;</span><span class="p">);</span>
   <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;data= &quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>

   <span class="c1">// Second computation step ... using the distributed domain</span>
   <span class="c1">// in the forall and thus computation is distributed.  Again,</span>
   <span class="c1">// chplvis shows computation on all locales.</span>
   <span class="nx">tagVdebug</span><span class="p">(</span><span class="s">&quot;step 2&quot;</span><span class="p">);</span>
   <span class="k">forall</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">mapDomain</span> <span class="k">do</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>

   <span class="c1">// Don&#39;t capture the writeln</span>
   <span class="nx">pauseVdebug</span><span class="p">();</span>
   <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;data2= &quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>

   <span class="c1">// Reduction step, computation on all locales.</span>
   <span class="nx">tagVdebug</span><span class="p">(</span><span class="s">&quot;reduce&quot;</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="o">+</span> <span class="k">reduce</span> <span class="nx">data</span><span class="p">;</span>

   <span class="c1">// done with visual debug</span>
   <span class="nx">stopVdebug</span><span class="p">();</span>

   <span class="nx">writeln</span> <span class="p">(</span><span class="s">&quot;sum is &quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">);</span>
<span class="p">}</span>
   
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">startVdebug(&quot;E2&quot;)</span></code> is placed after the declarations
so that tasks and communication for the declarations are not included.
The initial display of <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> shows data for the entire run. (This
program was run on five locales.)</p>
<img alt="../../_images/E2-1.png" src="../../_images/E2-1.png" />
<p>There is now a new menu called <em>Tags</em> that reflects the
<a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.tagVdebug" title="VisualDebug.tagVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">tagVdebug()</span></code></a> calls in the program.  Selecting the tags menu
gives the following display:</p>
<img alt="../../_images/E2-2.png" src="../../_images/E2-2.png" />
<p>There are two special tags in this menu, <em>All</em> and <em>Start</em>.  <em>All</em>
shows the initial display for the entire run and <em>Start</em> shows the
tasks and communication only between the <code class="docutils literal notranslate"><span class="pre">startVdebug(&quot;E2&quot;)</span></code> call and
the first call to <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.tagVdebug" title="VisualDebug.tagVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">tagVdebug()</span></code></a>, in this case, <code class="docutils literal notranslate"><span class="pre">tagVdebug(&quot;writeln</span>
<span class="pre">1&quot;)</span></code>.  The display for the <em>Start</em> tag looks like:</p>
<img alt="../../_images/E2-3.png" src="../../_images/E2-3.png" />
<p>You should be able to immediately see that</p>
<blockquote>
<div><ul class="simple">
<li><p>Locale 0 has 3 tasks and all other locales do not have any tasks.
(Locale boxes colored white mean no tasks at that locale.)
This means that locale 0 is doing all the computation.</p></li>
<li><p>The majority of communication is happening from other locales to
locale 0.  By clicking on the communication links you should be
to easily see that locale 0 is doing gets and puts for all the
communication.</p></li>
</ul>
</div></blockquote>
<p>Compare the results of this first <code class="docutils literal notranslate"><span class="pre">forall</span></code> loop with the loop in the second
computation step, tagged <em>step 2</em>.  Notice, <em>step 2</em> does not include the
second <code class="docutils literal notranslate"><span class="pre">writeln</span></code> because of the call to <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.pauseVdebug" title="VisualDebug.pauseVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">pauseVdebug()</span></code></a>.
That suspends collecting task and communication data until the next
<a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.tagVdebug" title="VisualDebug.tagVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">tagVdebug()</span></code></a> call.</p>
<img alt="../../_images/E2-5.png" src="../../_images/E2-5.png" />
<p>The difference between the two loops is the domain used.   <em>Domain</em>
is not a distributed domain, so the computation remains on locale 0.
The <code class="docutils literal notranslate"><span class="pre">mapDomain</span></code> is a distributed domain, so the computation is
distributed.  One needs to be careful in specifying these kind of loops
to make sure you use a distributed domain if you are operating on
distributed data and you want distributed computation.  This is
where <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> can quickly let you know if you used the wrong
domain in your <code class="docutils literal notranslate"><span class="pre">forall</span></code> loop.</p>
<p>Now, consider the <em>writeln 1</em> tag display.</p>
<img alt="../../_images/E2-4.png" src="../../_images/E2-4.png" />
<p>Notice the gray communication links.  This means there was no data
flow from locale 0 to the other locales.   The gray links are provided
to make it easy to visually see the corresponding locale.</p>
<p>Finally, for completeness, look at the display for the last tag
used, <em>reduce</em>.  It is very similar to the <em>step 2</em>
tag.</p>
<img alt="../../_images/E2-6.png" src="../../_images/E2-6.png" />
</div>
<div class="section" id="example-3">
<h2>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h2>
<p>The program <code class="docutils literal notranslate"><span class="pre">chplvis3.chpl</span></code> computes the solution of a Laplace equation
using the Jacobi method.  This version uses dmapped domains
and VisualDebug.  Only parts of the code are shown to illustrate
other <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> features.  First, config variables are handy here so one
can create different directories of chplvis data on different runs.
Although not shown here, config params are useful to allow your
program to use VisualDebug and generate data only if you need it.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="c1">// Allow different runs to create different data directories so it is</span>
<span class="c1">// easier to compare runs with chplvis.</span>
<span class="kd">config</span> <span class="kd">var</span> <span class="nx">dirname</span> <span class="o">=</span> <span class="s">&quot;E3&quot;</span><span class="p">;</span>

<span class="c1">// Start VisualDebug here to see that distributed domain and variable</span>
<span class="c1">// declarations generate tasks and communication.</span>
<span class="nx">startVdebug</span><span class="p">(</span><span class="nx">dirname</span><span class="p">);</span>
</pre></div>
</div>
<p>Next, if <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.tagVdebug" title="VisualDebug.tagVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">tagVdebug()</span></code></a> calls are made inside a loop, it
produces a unique tag for each call.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="c1">// Main computation loop -- we want to see the two parts of this</span>
<span class="c1">// loop, the computation and the reduction part.</span>

<span class="k">while</span> <span class="p">(</span><span class="nx">delta</span> <span class="o">&gt;</span> <span class="nx">epsilon</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// Tag the computation part of this loop</span>
  <span class="nx">tagVdebug</span><span class="p">(</span><span class="s">&quot;computation&quot;</span><span class="p">);</span>

  <span class="k">for</span> <span class="nx">t</span> <span class="kd">in</span> <span class="mi">1</span> <span class="o">..</span> <span class="nx">compLoop</span> <span class="k">do</span> <span class="p">{</span>
    <span class="k">forall</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="kd">in</span> <span class="nx">R</span> <span class="k">do</span>
      <span class="nx">A</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="o">=</span> <span class="nx">Temp</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">);</span>
    <span class="k">forall</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="kd">in</span> <span class="nx">R</span> <span class="k">do</span>
      <span class="nx">Temp</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nx">A</span><span class="p">(</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="o">+</span> <span class="nx">A</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="o">+</span> <span class="nx">A</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">A</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// tag the reduction part of this loop.</span>
  <span class="nx">tagVdebug</span><span class="p">(</span><span class="s">&quot;max&quot;</span><span class="p">);</span>
  <span class="k">forall</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="kd">in</span> <span class="nx">R</span> <span class="p">{</span>
    <span class="nx">Diff</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="o">=</span> <span class="nx">abs</span><span class="p">(</span><span class="nx">Temp</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span><span class="o">-</span><span class="nx">A</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="nx">delta</span> <span class="o">=</span> <span class="nx">max</span> <span class="k">reduce</span> <span class="nx">Diff</span><span class="p">;</span>

  <span class="nx">pauseVdebug</span><span class="p">();</span>
  <span class="nx">iteration</span> <span class="o">+=</span> <span class="nx">compLoop</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">verbose</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;iteration: &quot;</span><span class="p">,</span> <span class="nx">iteration</span><span class="p">);</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;delta:     &quot;</span><span class="p">,</span> <span class="nx">delta</span><span class="p">);</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="nx">Temp</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We use <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.pauseVdebug" title="VisualDebug.pauseVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">pauseVdebug()</span></code></a> here to make sure chplvis data is generated for
the parts of the loop of interest.</p>
<p>This example was run with the command line arguments <code class="docutils literal notranslate"><span class="pre">--n=8</span> <span class="pre">-nl</span> <span class="pre">8</span></code>.
The following shows the default <em>tags</em> menu for this run:</p>
<img alt="../../_images/E3-1.png" src="../../_images/E3-1.png" />
<p>Notice that the tags are now numbered and the tags menu extends past
the end of the window. (This screenshot does not show the entire tags
menu that was displayed on the screen.)  <em>All</em> and <em>Start</em> remain the
same, but since two or more tags have the same name, <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> shows a
unique tag for each <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.tagVdebug" title="VisualDebug.tagVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">tagVdebug()</span></code></a> call.  Notice the new menu
item above <em>All</em> which is highlighted in this example.  <em>Merge Tags</em> allows you
to see data for tags with the same name to be merged together.  For this
example, with merged tags, the tags menu now looks like:</p>
<img alt="../../_images/E3-2.png" src="../../_images/E3-2.png" />
<p>Now, selecting the tag <em>computation</em> will show the accumulated tasks and
communication for the entire <em>while</em> loop for just the computation
part of the loop.  This is all code between the <code class="docutils literal notranslate"><span class="pre">tagVdebug(&quot;computation&quot;)</span></code>
call and the <code class="docutils literal notranslate"><span class="pre">tagVdebug(&quot;max&quot;)</span></code> call.   Selecting the tag <em>max</em> will
then show accumulated tasks and communication for the code between
the <code class="docutils literal notranslate"><span class="pre">tagVdebug(&quot;max&quot;)</span></code> call and the <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.pauseVdebug" title="VisualDebug.pauseVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">pauseVdebug()</span></code></a> call.
The following shows the display for the <em>computation</em> tags and displaying <em>CPU</em>
data.</p>
<img alt="../../_images/E3-3.png" src="../../_images/E3-3.png" />
<p>The concurrency display is not available for tags in the “merge tag mode”
except the <em>All</em> tag, which is the same for both tags mode.</p>
<p>This example has some extra config variables that can be used to help
understand the usefulness of <code class="docutils literal notranslate"><span class="pre">chplvis</span></code>.  For example, one can compare
the CPU time used between the <em>computation</em> and <em>max</em> phases of this
Jacobi computation.  The config variable <em>compLoop</em> allows one to run
the computation loop more than once before then checking for convergence
in the <em>max</em> tagged code.  It is known that the Jacobi code will not
diverge and thus extra computation steps will not produce a “wrong”
answer.  By doing extra computation, the result will be a bit more
accurate.  The reader should use the <em>compLoop</em> and the <em>dirname</em>
config variables to run several versions of this program yielding
a <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> directory for each run.  Then one can compare the different
results by running <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> multiple times.  By a good choice of
the <em>compLoop</em> variable, one can dramatically reduce the CPU time for
computing the <em>max</em> while not increasing the <em>computation</em> time by much.</p>
</div>
<div class="section" id="example-4">
<h2>Example 4<a class="headerlink" href="#example-4" title="Permalink to this headline">¶</a></h2>
<p>To help show another feature of the “<a class="reference internal" href="#concurrency-view">Concurrency View</a>”, <code class="docutils literal notranslate"><span class="pre">chplvis4.chpl</span></code>
was written to create a <em>begin</em> task on all locales and have those tasks
live across calls to the <a class="reference internal" href="../../modules/packages/VisualDebug.html#module-VisualDebug" title="VisualDebug: Support for the visualization tool :ref:`chplvis`."><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">VisualDebug</span></code></a> module.  The code is:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="c1">// chplvis: Begin Tasks</span>

<span class="c1">// Example 4, begin tasks as shown in chplvis</span>
<span class="c1">// This is a contrived example to have tasks live</span>
<span class="c1">// across a tagVdebug() call.</span>

<span class="k">use</span> <span class="nx">VisualDebug</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">BlockDist</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">space</span> <span class="o">=</span>  <span class="p">{</span> <span class="mi">0</span> <span class="o">..</span> <span class="o">#</span><span class="nx">numLocales</span> <span class="p">};</span>
<span class="kd">const</span> <span class="nx">Dspace</span> <span class="o">=</span> <span class="nx">space</span> <span class="k">dmapped</span> <span class="nx">Block</span> <span class="p">(</span><span class="nx">boundingBox</span><span class="o">=</span><span class="nx">space</span><span class="p">);</span>

<span class="nx">startVdebug</span><span class="p">(</span><span class="s">&quot;E4&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">go$</span><span class="p">:</span> <span class="p">[</span><span class="nx">Dspace</span><span class="p">]</span> <span class="k">single</span> <span class="kt">bool</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">done$</span><span class="p">:</span> <span class="p">[</span><span class="nx">Dspace</span><span class="p">]</span> <span class="k">single</span> <span class="kt">bool</span><span class="p">;</span>

<span class="c1">// Start a begin task on all locales.  The task will start and then block.</span>
<span class="k">coforall</span> <span class="nx">loc</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="k">do</span>
  <span class="k">on</span> <span class="nx">loc</span> <span class="k">do</span> <span class="k">begin</span> <span class="p">{</span> <span class="c1">// start a async task</span>

              <span class="nx">go$</span><span class="p">[</span><span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span> <span class="c1">// Block until ready!</span>
              <span class="nx">writeln</span> <span class="p">(</span><span class="s">&quot;Finishing running the &#39;begin&#39; statement on locale &quot;</span>
                       <span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">);</span>
              <span class="nx">done$</span><span class="p">[</span><span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
           <span class="p">}</span>

<span class="nx">tagVdebug</span><span class="p">(</span><span class="s">&quot;loc&quot;</span><span class="p">);</span>

<span class="k">coforall</span> <span class="nx">loc</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="k">do</span>
    <span class="k">on</span> <span class="nx">loc</span> <span class="k">do</span> <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Hello from &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="nx">tagVdebug</span><span class="p">(</span><span class="s">&quot;finish&quot;</span><span class="p">);</span>

<span class="c1">// Let all tasks go</span>
<span class="nx">go$</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="c1">// Wait until all tasks are finished</span>
<span class="nx">done$</span><span class="p">;</span>

<span class="nx">stopVdebug</span><span class="p">();</span>
</pre></div>
</div>
<p>First we will look at the results of running this code on a single
locale.  Even though there is no communication, <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> can help
you see how tasks are run, especially how much concurrency you have.</p>
<img alt="../../_images/E4-1.png" src="../../_images/E4-1.png" />
<p>This view shows the tasks for locale 0, the only locale in this run.
Things to notice from this view are</p>
<blockquote>
<div><ul class="simple">
<li><p>Main represents the main program.  It is shown as a gray rectangular
box to show that it was running at the time of
<a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.startVdebug" title="VisualDebug.startVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">startVdebug()</span></code></a> was called.</p></li>
<li><p>In the <em>tag ALL</em> view, tags are shown in the sequence of tasks.</p></li>
<li><p>Task <em>OC 29</em> is started before the <em>loc</em> tag, but it finishes
in the <em>finish</em> tag.</p></li>
</ul>
</div></blockquote>
<img alt="../../_images/E4-2.png" src="../../_images/E4-2.png" />
<p>This view shows the tasks for locale 1 on a 3 locale run for the tag
<em>loc</em>.  In this view, the task started before the <em>loc</em> tag appears
as a gray rectangular box at the top of the view.  This indicates
that is was running at the start of the tag.  The lack of a task
termination horizontal line on the task line indicates that the task
continued running past the end of the tag.  Tasks that are running
at the beginning of a tag and terminate during a tag can be seen
by the horizontal termination line, such as for task <em>C50</em>, a
<em>continued</em> task for locale 0 on the same 3 locale run as seen next.</p>
<img alt="../../_images/E4-3.png" src="../../_images/E4-3.png" />
<p><em>Main</em> will always show as a continued task with no termination.
<em>Main</em> is shown only for locale 0.  <em>Main</em> is included in the
calculation of concurrency as seen above.</p>
</div>
<div class="section" id="config-parameters-and-variables">
<h2>Config Parameters and Variables<a class="headerlink" href="#config-parameters-and-variables" title="Permalink to this headline">¶</a></h2>
<p>Because <a class="reference internal" href="../../modules/packages/VisualDebug.html#module-VisualDebug" title="VisualDebug: Support for the visualization tool :ref:`chplvis`."><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">VisualDebug</span></code></a> support requires added procedure calls in source to
use it, there is a boolean config const, <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.VisualDebugOn" title="VisualDebug.VisualDebugOn"><code class="xref chpl chpl-const docutils literal notranslate"><span class="pre">VisualDebugOn</span></code></a>
that controls generation of <a class="reference internal" href="../../modules/packages/VisualDebug.html#module-VisualDebug" title="VisualDebug: Support for the visualization tool :ref:`chplvis`."><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">VisualDebug</span></code></a> data.
This may be set on the execution command line like any config const.
The standard default value is <cite>true</cite>.
This default value may be changed at compile time
by setting the config param <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.DefaultVisualDebugOn" title="VisualDebug.DefaultVisualDebugOn"><code class="xref chpl chpl-const docutils literal notranslate"><span class="pre">DefaultVisualDebugOn</span></code></a>.
If this is set to <cite>false</cite> at compile time
then <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.VisualDebugOn" title="VisualDebug.VisualDebugOn"><code class="xref chpl chpl-param docutils literal notranslate"><span class="pre">VisualDebugOn</span></code></a> must be set to <cite>true</cite>
on the execution command line to generate <a class="reference internal" href="../../modules/packages/VisualDebug.html#module-VisualDebug" title="VisualDebug: Support for the visualization tool :ref:`chplvis`."><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">VisualDebug</span></code></a> data.</p>
</div>
<div class="section" id="final-comments">
<h2>Final Comments<a class="headerlink" href="#final-comments" title="Permalink to this headline">¶</a></h2>
<p>The following items are not covered above:</p>
<blockquote>
<div><ul>
<li><p>The command line for <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chplvis</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>
</div>
<p>where <em>name</em> may be the name of the directory or a file in the
directory generated by a run of a program using <a class="reference internal" href="../../modules/packages/VisualDebug.html#module-VisualDebug" title="VisualDebug: Support for the visualization tool :ref:`chplvis`."><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">VisualDebug</span></code></a>.
If <em>name</em> is not given, it looks for the directory named
<code class="docutils literal notranslate"><span class="pre">.Vdebug</span></code> which is generated if the <a class="reference internal" href="../../modules/packages/VisualDebug.html#VisualDebug.startVdebug" title="VisualDebug.startVdebug"><code class="xref chpl chpl-proc docutils literal notranslate"><span class="pre">startVdebug</span></code></a>
function is given a string of zero length.  (“”)</p>
</li>
<li><p>In all the examples given, all calls to <code class="docutils literal notranslate"><span class="pre">xVdebug()</span></code> routines were
essentially in the <code class="docutils literal notranslate"><span class="pre">main</span></code> program.   While this will not be the case
in all programs, a couple of things should be noted.</p>
<ul class="simple">
<li><p>All calls run code on all locales.</p></li>
<li><p>All calls should be made from locale 0.</p></li>
<li><p>Calls should not be made in <code class="docutils literal notranslate"><span class="pre">on</span></code> statements.  While such programs
should run, the <code class="docutils literal notranslate"><span class="pre">chplvis</span></code> data will mostly likely not make much
sense.</p></li>
<li><p>Calls should not be made in <code class="docutils literal notranslate"><span class="pre">begin</span></code> statements for similar reasons.</p></li>
<li><p>Calls should not be made in forall or coforall statements.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">chplvis</span></code> was created in 2015 and first released with Chapel-1.12.0.
The Chapel team hopes this tool will be of use to Chapel programmers
and would like feedback on this tool.</p>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Philip A. Nelson</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../mason/mason.html" class="btn btn-neutral float-right" title="Mason" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../chpldoc/man.html" class="btn btn-neutral float-left" title="chpldoc" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>