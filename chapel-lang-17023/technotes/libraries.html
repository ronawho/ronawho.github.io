

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Calling Chapel Code from Other Languages &mdash; Chapel Documentation 1.24</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Fortran Interoperability" href="fortranInterop.html" />
    <link rel="prev" title="C Interoperability" href="extern.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.24
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.24";
$pagename = "technotes/libraries";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Technical Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#base-language-features">Base Language Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#initializers-and-generic-programming">Initializers and Generic Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#parallel-language-features">Parallel Language Features</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#interoperability">Interoperability</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="extern.html">C Interoperability</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Calling Chapel Code from Other Languages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#static-and-dynamic-libraries">Static and Dynamic Libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#location-of-the-generated-library">Location of the Generated Library</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-define-your-library">How to Define Your Library</a></li>
<li class="toctree-l4"><a class="reference internal" href="#library-name">Library Name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-your-library-in-c">Using Your Library in C</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-your-library-in-python">Using Your Library in Python</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-your-library-in-fortran">Using Your Library in Fortran</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arrays">Arrays</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-your-library-in-chapel">Using Your Library in Chapel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-your-library-in-multilocale-settings">Using Your Library in Multilocale Settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#caveats">Caveats</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fortranInterop.html">Fortran Interoperability</a></li>
<li class="toctree-l3"><a class="reference internal" href="allocators.html">Using the Chapel Allocator from C</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#compiler-features">Compiler Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tool-details">Tool Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../primers/index.html">Primers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mason-packages.html">Mason Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Technical Notes</a> &raquo;</li>
        
      <li>Calling Chapel Code from Other Languages</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/technotes/libraries.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="calling-chapel-code-from-other-languages">
<span id="readme-libraries"></span><h1><a class="toc-backref" href="#id14">Calling Chapel Code from Other Languages</a><a class="headerlink" href="#calling-chapel-code-from-other-languages" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The features described in this document are still under development.
If you encounter a bug or limitation not yet documented as a <a class="reference external" href="https://github.com/chapel-lang/chapel/issues">Github
issue</a>, consider filing
an issue as described in <a class="reference internal" href="../usingchapel/bugs.html#readme-bugs"><span class="std std-ref">Reporting Chapel Issues</span></a>.</p>
</div>
<p>To build a Chapel program as a library, compile with the <code class="docutils literal notranslate"><span class="pre">--library</span></code> flag.
Without this flag, Chapel assumes that you are building a main program and
produces a main routine, whether one is explicitly defined or not.</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#calling-chapel-code-from-other-languages" id="id14">Calling Chapel Code from Other Languages</a></p>
<ul>
<li><p><a class="reference internal" href="#static-and-dynamic-libraries" id="id15">Static and Dynamic Libraries</a></p></li>
<li><p><a class="reference internal" href="#location-of-the-generated-library" id="id16">Location of the Generated Library</a></p></li>
<li><p><a class="reference internal" href="#how-to-define-your-library" id="id17">How to Define Your Library</a></p></li>
<li><p><a class="reference internal" href="#library-name" id="id18">Library Name</a></p></li>
<li><p><a class="reference internal" href="#using-your-library-in-c" id="id19">Using Your Library in C</a></p>
<ul>
<li><p><a class="reference internal" href="#the-header-file" id="id20">The Header File</a></p></li>
<li><p><a class="reference internal" href="#initializing-your-library" id="id21">Initializing Your Library</a></p></li>
<li><p><a class="reference internal" href="#compiling-c-code-with-the-library" id="id22">Compiling C Code with the Library</a></p>
<ul>
<li><p><a class="reference internal" href="#makefile-helper" id="id23">Makefile Helper</a></p></li>
<li><p><a class="reference internal" href="#makefile-less-compilation" id="id24">Makefile-less Compilation</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-your-library-in-python" id="id25">Using Your Library in Python</a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites" id="id26">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#compiling-your-chapel-library" id="id27">Compiling Your Chapel Library</a></p></li>
<li><p><a class="reference internal" href="#python-output-directory-name" id="id28">Python Output Directory Name</a></p></li>
<li><p><a class="reference internal" href="#python-module-name" id="id29">Python Module Name</a></p></li>
<li><p><a class="reference internal" href="#pythonpath" id="id30">PYTHONPATH</a></p></li>
<li><p><a class="reference internal" href="#initializing-and-using-your-library-in-python" id="id31">Initializing and Using Your Library in Python</a></p></li>
<li><p><a class="reference internal" href="#python-init-file" id="id32">Python Init File</a></p></li>
<li><p><a class="reference internal" href="#argument-default-values" id="id33">Argument Default Values</a></p></li>
<li><p><a class="reference internal" href="#c-ptr-arguments" id="id34">c_ptr Arguments</a></p></li>
<li><p><a class="reference internal" href="#debugging-issues-with-library-python" id="id35">Debugging Issues with âlibrary-python</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-your-library-in-fortran" id="id36">Using Your Library in Fortran</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id37">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id38">Compiling Your Chapel Library</a></p></li>
<li><p><a class="reference internal" href="#initializing-and-using-your-library-from-fortran" id="id39">Initializing and Using Your Library From Fortran</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#arrays" id="id40">Arrays</a></p>
<ul>
<li><p><a class="reference internal" href="#chpl-external-array" id="id41">chpl_external_array</a></p></li>
<li><p><a class="reference internal" href="#chpl-opaque-array" id="id42">chpl_opaque_array</a></p></li>
<li><p><a class="reference internal" href="#fortran-arrays" id="id43">Fortran arrays</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-your-library-in-chapel" id="id44">Using Your Library in Chapel</a></p></li>
<li><p><a class="reference internal" href="#using-your-library-in-multilocale-settings" id="id45">Using Your Library in Multilocale Settings</a></p>
<ul>
<li><p><a class="reference internal" href="#id8" id="id46">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#initializing-your-multilocale-library" id="id47">Initializing Your Multilocale Library</a></p>
<ul>
<li><p><a class="reference internal" href="#in-c" id="id48">In C</a></p></li>
<li><p><a class="reference internal" href="#in-python" id="id49">In Python</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id9" id="id50">Makefile-less Compilation</a></p></li>
<li><p><a class="reference internal" href="#what-is-this-server-real-program" id="id51">What is this _server_real program?</a></p></li>
<li><p><a class="reference internal" href="#hostnames-and-connection-issues" id="id52">Hostnames and Connection Issues</a></p></li>
<li><p><a class="reference internal" href="#debugging-issues-with-multilocale-libraries" id="id53">Debugging Issues with Multilocale Libraries</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#caveats" id="id54">Caveats</a></p>
<ul>
<li><p><a class="reference internal" href="#supported-types-for-export-procs" id="id55">Supported Types for export procs</a></p></li>
<li><p><a class="reference internal" href="#multiple-chapel-libraries" id="id56">Multiple Chapel Libraries</a></p></li>
<li><p><a class="reference internal" href="#llvm" id="id57">LLVM</a></p></li>
<li><p><a class="reference internal" href="#exporting-symbols" id="id58">Exporting Symbols</a></p>
<ul>
<li><p><a class="reference internal" href="#default-values" id="id59">Argument Default Values</a></p></li>
<li><p><a class="reference internal" href="#intents-in-python-interoperability" id="id60">Intents in Python Interoperability</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#multilocale-caveats" id="id61">Multilocale Caveats</a></p>
<ul>
<li><p><a class="reference internal" href="#other-settings" id="id62">Other Settings</a></p>
<ul>
<li><p><a class="reference internal" href="#host-and-target-compilers" id="id63">Host and Target Compilers</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#supported-types" id="id64">Supported Types</a></p></li>
<li><p><a class="reference internal" href="#intents" id="id65">Intents</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="static-and-dynamic-libraries">
<h2><a class="toc-backref" href="#id15">Static and Dynamic Libraries</a><a class="headerlink" href="#static-and-dynamic-libraries" title="Permalink to this headline">Â¶</a></h2>
<p>The type of library produced can be specified through the <code class="docutils literal notranslate"><span class="pre">--static</span></code> and
<code class="docutils literal notranslate"><span class="pre">--dynamic</span></code> flags.  If neither <code class="docutils literal notranslate"><span class="pre">--static</span></code> nor <code class="docutils literal notranslate"><span class="pre">--dynamic</span></code> is specified, a
platform-dependent default library type is produced.</p>
<p>Some platforms support linking against both static and dynamic versions of
the same library.  On those platforms, the <code class="docutils literal notranslate"><span class="pre">--static</span></code> or <code class="docutils literal notranslate"><span class="pre">--dynamic</span></code>
flag can be used to select which type of library (and thus which kind of
linking) is performed by default.  Library files which are named explicitly on
the <code class="docutils literal notranslate"><span class="pre">chpl</span></code> command line take precedence over any found through object
library paths (<code class="docutils literal notranslate"><span class="pre">-L</span></code>).  When there is a conflict, the last library
specified takes precedence.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When building a dynamic library, building position independent code is
recommended.  To do this, set the environment variable <code class="docutils literal notranslate"><span class="pre">CHPL_LIB_PIC</span></code> to
<code class="docutils literal notranslate"><span class="pre">pic</span></code> and ensure this configuration is built by performing a <code class="docutils literal notranslate"><span class="pre">make</span></code>
command from <code class="docutils literal notranslate"><span class="pre">$CHPL_HOME</span></code>.  Note that position independent code will likely
encounter some performance degradation as opposed to normal Chapel code.
For this reason, we recommend only using <code class="docutils literal notranslate"><span class="pre">CHPL_LIB_PIC</span></code> when position
independent code is required.</p>
</div>
</div>
<div class="section" id="location-of-the-generated-library">
<span id="id1"></span><h2><a class="toc-backref" href="#id16">Location of the Generated Library</a><a class="headerlink" href="#location-of-the-generated-library" title="Permalink to this headline">Â¶</a></h2>
<p>The library will be placed by default in a sub-directory named <code class="docutils literal notranslate"><span class="pre">lib</span></code> (which
will be created if it does not already exist).  The location for the generated
library and associated files can be changed using the compilation flag
<code class="docutils literal notranslate"><span class="pre">--library-dir</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Library built into bar/libfoo.a</span>
<span class="n">chpl</span> <span class="o">--</span><span class="n">library</span> <span class="o">--</span><span class="n">library</span><span class="o">-</span><span class="nb">dir</span><span class="o">=</span><span class="n">bar</span> <span class="n">foo</span><span class="o">.</span><span class="n">chpl</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-define-your-library">
<h2><a class="toc-backref" href="#id17">How to Define Your Library</a><a class="headerlink" href="#how-to-define-your-library" title="Permalink to this headline">Â¶</a></h2>
<p>When creating a library file from Chapel code, only those symbols with
<code class="docutils literal notranslate"><span class="pre">export</span></code> attached to them will be available from outside the library.  For
example, one can define a Chapel file <code class="docutils literal notranslate"><span class="pre">foo.chpl</span></code> like this:</p>
<div class="highlight-Chapel notranslate"><div class="highlight"><pre><span></span><span class="c1">// This function will be available to the library user</span>
<span class="k">export</span> <span class="k">proc</span> <span class="nf">bar</span><span class="p">():</span> <span class="kt">int</span> <span class="p">{</span>
  <span class="c1">// Does something</span>
  <span class="o">..</span><span class="p">.</span>
<span class="p">}</span>

<span class="c1">// As will this one</span>
<span class="k">export</span> <span class="k">proc</span> <span class="nf">baz</span><span class="p">(</span><span class="kt">int</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Does something different</span>
  <span class="o">..</span><span class="p">.</span>
<span class="p">}</span>

<span class="c1">// but this function will not be, though it can be used by the exported</span>
<span class="c1">// functions</span>
<span class="k">proc</span> <span class="nf">gloop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Does something else</span>
  <span class="o">..</span><span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#exporting-symbols"><span class="std std-ref">Exporting Symbols</span></a> for the current limitations on what can be
exported.</p>
</div>
<div class="section" id="library-name">
<span id="id2"></span><h2><a class="toc-backref" href="#id18">Library Name</a><a class="headerlink" href="#library-name" title="Permalink to this headline">Â¶</a></h2>
<p>The generated library name will be the same as the file being compiled, except
it will start with <code class="docutils literal notranslate"><span class="pre">lib</span></code> if the name does not already, and it will be followed
by a <code class="docutils literal notranslate"><span class="pre">.so</span></code> or <code class="docutils literal notranslate"><span class="pre">.a</span></code> suffix.  Thus, in the example above, the generated
library will be named <code class="docutils literal notranslate"><span class="pre">libfoo.so</span></code> or <code class="docutils literal notranslate"><span class="pre">libfoo.a</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Builds library as lib/libfoo.a</span>
chpl --library --static foo.chpl

<span class="c1"># Builds library as lib/libfoo.so</span>
chpl --library --dynamic foo.chpl

<span class="c1"># Builds library as lib/libfoo.so (note: file named libfoo.chpl)</span>
chpl --library --dynamic libfoo.chpl
</pre></div>
</div>
<p>The basename used (the <code class="docutils literal notranslate"><span class="pre">foo</span></code> portion) can be changed with the <code class="docutils literal notranslate"><span class="pre">-o</span></code> or
<code class="docutils literal notranslate"><span class="pre">--output</span></code> compilation flag.</p>
<p>This flag is required if multiple top level modules or files are being compiled
into the same library, as the default name is determined by the top-most module.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Builds library as lib/libbar.so</span>
chpl --library --dynamic foo.chpl -o bar

<span class="c1"># -o flag required because of multiple modules</span>
<span class="c1"># Builds library as lib/libfoo.so</span>
chpl --library --dynamic foo.chpl bar.chpl -o foo
</pre></div>
</div>
</div>
<div class="section" id="using-your-library-in-c">
<h2><a class="toc-backref" href="#id19">Using Your Library in C</a><a class="headerlink" href="#using-your-library-in-c" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="the-header-file">
<h3><a class="toc-backref" href="#id20">The Header File</a><a class="headerlink" href="#the-header-file" title="Permalink to this headline">Â¶</a></h3>
<p>A header file will be generated for the library by default, using the same base
name as the library (replacing <code class="docutils literal notranslate"><span class="pre">.so</span></code> or <code class="docutils literal notranslate"><span class="pre">.a</span></code> with <code class="docutils literal notranslate"><span class="pre">.h</span></code> and omitting the
<code class="docutils literal notranslate"><span class="pre">lib</span></code> portion).  This name can be changed independently of the generated
library name using the flag <code class="docutils literal notranslate"><span class="pre">--library-header</span></code> at compilation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Builds header as lib/foo.h</span>
chpl --library --dynamic foo.chpl

<span class="c1"># Builds header as lib/bar.h, library is still lib/libfoo.so</span>
chpl --library --dynamic --library-header<span class="o">=</span>bar foo.chpl
</pre></div>
</div>
<p>The header file will contain any exported function, including the exported
module initialization functions (which are generated by default).  It will also
contain a <code class="docutils literal notranslate"><span class="pre">#include</span></code> for <code class="docutils literal notranslate"><span class="pre">stdchpl.h</span></code> and any <code class="docutils literal notranslate"><span class="pre">.h</span></code> files specified in the
program via a <code class="docutils literal notranslate"><span class="pre">require</span></code> clause.</p>
</div>
<div class="section" id="initializing-your-library">
<span id="initializing-your-library-in-c"></span><h3><a class="toc-backref" href="#id21">Initializing Your Library</a><a class="headerlink" href="#initializing-your-library" title="Permalink to this headline">Â¶</a></h3>
<p>When using a Chapel library from C, one must first initialize the Chapel runtime
and standard modules.  This is done by calling the function
<code class="docutils literal notranslate"><span class="pre">chpl_library_init()</span></code> before the Chapel library function calls and by calling
<code class="docutils literal notranslate"><span class="pre">chpl_library_finalize()</span></code> after all the Chapel library function calls are
finished.  These functions are defined in
<code class="docutils literal notranslate"><span class="pre">$CHPL_HOME/runtime/include/chpl-init.h</span></code> and accessible when you <code class="docutils literal notranslate"><span class="pre">#include</span></code>
the generated header file:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">chpl_library_init</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]);</span>
<span class="kt">void</span> <span class="nf">chpl_library_finalize</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>Here is an example program which uses the <code class="docutils literal notranslate"><span class="pre">foo</span></code> library:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;foo.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">chpl_library_init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

    <span class="n">baz</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span> <span class="c1">// Call into a library function</span>

    <span class="n">chpl_library_finalize</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If your exported functions rely upon any global variables defined in your module
(or the modules it relies upon), then you must additionally call the generated
module initialization function.  This function will be named
<code class="docutils literal notranslate"><span class="pre">chpl__init_&lt;moduleName&gt;</span></code>, and you can find its declaration in your generated
<code class="docutils literal notranslate"><span class="pre">.h</span></code> file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended that you always call the module initialization function
before calling any of the exported functions in your library.  You do not
need to do this more than once per program.</p>
</div>
</div>
<div class="section" id="compiling-c-code-with-the-library">
<h3><a class="toc-backref" href="#id22">Compiling C Code with the Library</a><a class="headerlink" href="#compiling-c-code-with-the-library" title="Permalink to this headline">Â¶</a></h3>
<p>When using a Chapel library file in C code, a fairly exact incantation is
required.  If compiling dynamically, update the <code class="docutils literal notranslate"><span class="pre">$LD_LIBRARY_PATH</span></code> environment
variable to include the directory where the new library file lives and the
directory where the Chapel build lives.  The latter can be found by looking at
the output of a <code class="docutils literal notranslate"><span class="pre">$CHPL_HOME/util/printchplenv</span></code> call and finding the
appropriate directory under <code class="docutils literal notranslate"><span class="pre">$CHPL_HOME/lib</span></code>; the directory name can be found
by running <code class="docutils literal notranslate"><span class="pre">$CHPL_HOME/util/printchplenv</span> <span class="pre">--runtime</span> <span class="pre">--path</span></code>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace the first lib with the appropriate path to your library file if its</span>
<span class="c1"># location has been changed by --library-dir, or if you are not in its parent</span>
<span class="c1"># directory</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>lib/:<span class="nv">$CHPL_HOME</span>/lib/<span class="sb">`</span><span class="nv">$CHPL_HOME</span>/util/printchplenv --runtime --path<span class="sb">`</span>:<span class="nv">$LD_LIBRARY_PATH</span>
</pre></div>
</div>
<div class="section" id="makefile-helper">
<span id="id3"></span><h4><a class="toc-backref" href="#id23">Makefile Helper</a><a class="headerlink" href="#makefile-helper" title="Permalink to this headline">Â¶</a></h4>
<p>Compilation of the C program involves some additional command line includes and
links.  For your convenience, a sample Makefile can be generated using
<code class="docutils literal notranslate"><span class="pre">--library-makefile</span></code>.  This will generate a file named
<code class="docutils literal notranslate"><span class="pre">Makefile.&lt;basename&gt;</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Builds makefile as lib/Makefile.foo</span>
chpl --library --dynamic --library-makefile foo.chpl

<span class="c1"># Builds makefile as lib/Makefile.bar</span>
chpl --library --dynamic --library-makefile foo.chpl -o bar
</pre></div>
</div>
<p>This Makefile can then be included and its variables referenced in your own
Makefile.</p>
<p>The generated Makefile will contain the user-facing and internal variables.  The
user-facing variables intended for use in your own Makefile are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CHPL_CFLAGS</span></code> contains the flags and <code class="docutils literal notranslate"><span class="pre">-I</span></code> directories needed at compile
time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CHPL_LDFLAGS</span></code> contains the <code class="docutils literal notranslate"><span class="pre">-L</span></code> directories and <code class="docutils literal notranslate"><span class="pre">-l</span></code> libraries needed
at link time, including libraries specified by your program via <code class="docutils literal notranslate"><span class="pre">require</span></code>
statements.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CHPL_COMPILER</span></code> stores the compiler used when compiling your library.  Using
a different compiler when linking to your library from another code may cause
ABI incompatibility issues or problems when the flags specified in
<code class="docutils literal notranslate"><span class="pre">CHPL_CFLAGS</span></code> are not applicable in that compiler.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CHPL_LINKER</span></code> and <code class="docutils literal notranslate"><span class="pre">CHPL_LINKERSHARED</span></code> store linker commands.</p></li>
</ul>
<p>The internal variables support those others in an attempt to make their contents
slightly more readable.</p>
<p>An example Makefile which uses the generated <code class="docutils literal notranslate"><span class="pre">Makefile.foo</span></code> looks like this:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="cp">include lib/Makefile.foo</span>

<span class="nf">myCProg</span><span class="o">:</span> <span class="n">myCProg</span>.<span class="n">c</span> <span class="n">lib</span>/<span class="n">libfoo</span>.<span class="n">a</span>
  <span class="k">$(</span>CHPL_COMPILER<span class="k">)</span> <span class="k">$(</span>CHPL_CFLAGS<span class="k">)</span> -o myCProg myCProg.c <span class="k">$(</span>CHPL_LDFLAGS<span class="k">)</span>
</pre></div>
</div>
</div>
<div class="section" id="makefile-less-compilation">
<span id="makefileless-compilation-in-single-locale"></span><h4><a class="toc-backref" href="#id24">Makefile-less Compilation</a><a class="headerlink" href="#makefile-less-compilation" title="Permalink to this headline">Â¶</a></h4>
<p>You can also generate the compilation flags necessary to compile a C program
using a Chapel library by using the <code class="docutils literal notranslate"><span class="pre">compileline</span> <span class="pre">--compile</span></code> and <code class="docutils literal notranslate"><span class="pre">compileline</span>
<span class="pre">--libraries</span></code> tools we provide.  The compilation command would then look like
this (replacing <code class="docutils literal notranslate"><span class="pre">myCProg.c</span></code> with the name of your C program that will use the
library):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="sb">`</span><span class="nv">$CHPL_HOME</span>/util/config/compileline --compile<span class="sb">`</span> myCProg.c -Llib/ -lfoo <span class="sb">`</span><span class="nv">$CHPL_HOME</span>/util/config/compileline --libraries<span class="sb">`</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">compileline</span> <span class="pre">--compile-c++</span></code> is also available for compiling a C++
program.</p>
</div>
</div>
</div>
<div class="section" id="using-your-library-in-python">
<span id="readme-libraries-python"></span><h2><a class="toc-backref" href="#id25">Using Your Library in Python</a><a class="headerlink" href="#using-your-library-in-python" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="prerequisites">
<h3><a class="toc-backref" href="#id26">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline">Â¶</a></h3>
<p>To make use of your library in Python with minimal work, the Chapel compiler
requires the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">python3</span></code> installed in your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Cython</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code></p></li>
</ul>
<p>If you are on a system where libraries are built to be position dependent by
default (e.g.  not OSx), you will need to set the environment variable
<code class="docutils literal notranslate"><span class="pre">CHPL_LIB_PIC</span></code> to <code class="docutils literal notranslate"><span class="pre">pic</span></code> and perform a <code class="docutils literal notranslate"><span class="pre">make</span></code> command from <code class="docutils literal notranslate"><span class="pre">$CHPL_HOME</span></code>.
This will cause the Chapel runtime and third-party libraries to be built with
position independent code, which Python interoperability requires.  Note that
position independent code will likely encounter some performance degradation as
opposed to normal Chapel code.  For this reason, we recommend only using
<code class="docutils literal notranslate"><span class="pre">CHPL_LIB_PIC=pic</span></code> when position independent code is required (e.g. when
calling Chapel code from Python).</p>
</div>
<div class="section" id="compiling-your-chapel-library">
<h3><a class="toc-backref" href="#id27">Compiling Your Chapel Library</a><a class="headerlink" href="#compiling-your-chapel-library" title="Permalink to this headline">Â¶</a></h3>
<p>To create a Python-compatible module in addition to the normally generated
library and header, add <code class="docutils literal notranslate"><span class="pre">--library-python</span></code> to the compilation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When compiling on a Cray, or a machine with multiple C compilers, you should
ensure your <code class="docutils literal notranslate"><span class="pre">CHPL_TARGET_COMPILER</span></code> is the same as the compiler used to
install Cython (usually the default C compiler for the machine, or
<code class="docutils literal notranslate"><span class="pre">cray-prgenv-gnu</span></code> on Cray systems).  Using a different
<code class="docutils literal notranslate"><span class="pre">CHPL_TARGET_COMPILER</span></code> may lead to ABI incompatibility issues or the use of
unexpected flags when compiling your Python module.  See
<a class="reference internal" href="../usingchapel/chplenv.html#readme-chplenv-chpl-compiler"><span class="std std-ref">CHPL_*_COMPILER</span></a> for more information on the values of
<code class="docutils literal notranslate"><span class="pre">CHPL_TARGET_COMPILER</span></code></p>
</div>
</div>
<div class="section" id="python-output-directory-name">
<span id="id4"></span><h3><a class="toc-backref" href="#id28">Python Output Directory Name</a><a class="headerlink" href="#python-output-directory-name" title="Permalink to this headline">Â¶</a></h3>
<p>By default, the name of the directory created to contain the generated Python
module will match the generated Python module name. To change the
output directory name so that it does not match the generated Python module
name, use the compilation flag <code class="docutils literal notranslate"><span class="pre">--library-dir</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Builds Python module as foo/foo.py from foo.chpl</span>
chpl --library-python foo.chpl

<span class="c1"># Builds Python module as lib/foo.py from foo.chpl</span>
chpl --library-python --library-dir<span class="o">=</span>lib foo.chpl
</pre></div>
</div>
</div>
<div class="section" id="python-module-name">
<h3><a class="toc-backref" href="#id29">Python Module Name</a><a class="headerlink" href="#python-module-name" title="Permalink to this headline">Â¶</a></h3>
<p>By default, the name of the generated Python module will match the basename
of the generated library, but can be changed independently of the generated
library name using the compilation flag <code class="docutils literal notranslate"><span class="pre">--library-python-name</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Builds Python module as foo/foo.py from foo.chpl</span>
chpl --library-python foo.chpl

<span class="c1"># Builds Python module as bar/bar.py from foo.chpl</span>
chpl --library-python --library-python-name<span class="o">=</span>bar foo.chpl
</pre></div>
</div>
<p>Because the default output directory name mirrors the Python module name,
changing the name of the generated Python module will also change the output
directory name (as in the second example above).</p>
<p>To change the output directory name and the output module name, use a
combination of <code class="docutils literal notranslate"><span class="pre">--library-dir</span></code> and <code class="docutils literal notranslate"><span class="pre">--library-python-name</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Builds Python module as foo/bar.py from baz.chpl</span>
chpl --library-python --library-python-name<span class="o">=</span>bar --library-dir<span class="o">=</span>foo baz.chpl
</pre></div>
</div>
</div>
<div class="section" id="pythonpath">
<h3><a class="toc-backref" href="#id30">PYTHONPATH</a><a class="headerlink" href="#pythonpath" title="Permalink to this headline">Â¶</a></h3>
<p>To use your library in a Python program, you will need to extend your
<code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> environment variable to include the directory where your library
files are generated, e.g.:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span>lib/:<span class="nv">$PYTHONPATH</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#python-output-directory-name"><span class="std std-ref">Python Output Directory Name</span></a> for where your library files are
generated, and how to change this location when generating a Python module
from your Chapel library.</p>
</div>
<div class="section" id="initializing-and-using-your-library-in-python">
<span id="python-libraries"></span><h3><a class="toc-backref" href="#id31">Initializing and Using Your Library in Python</a><a class="headerlink" href="#initializing-and-using-your-library-in-python" title="Permalink to this headline">Â¶</a></h3>
<p>Once your <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> is set up and the Python module created, you can
<code class="docutils literal notranslate"><span class="pre">import</span></code> the module like a normal Python module.</p>
<p>Similarly to using your library with C, you will need to call a set up function
to ensure the Chapel runtime and standard modules are initialized, as well as
a clean up function.</p>
<p>Unlike the C case, the set up function is called <code class="docutils literal notranslate"><span class="pre">chpl_setup()</span></code> and will also
handle initializing your module.   This function will still need to be called
prior to any Chapel library function calls.</p>
<p>Also unlike the C case, the clean up function is called <code class="docutils literal notranslate"><span class="pre">chpl_cleanup()</span></code>.
This function will still need to be called after all the Chapel library
function calls are finished, unless you have imported the output directory
as a package using the <a class="reference internal" href="#python-init-file"><span class="std std-ref">Python Init File</span></a>.</p>
<p>For example:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">foo</span>

<span class="n">foo</span><span class="o">.</span><span class="n">chpl_setup</span><span class="p">()</span>

<span class="n">foo</span><span class="o">.</span><span class="n">baz</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">//</span> <span class="n">Call</span> <span class="n">into</span> <span class="n">a</span> <span class="n">library</span> <span class="n">function</span>

<span class="n">foo</span><span class="o">.</span><span class="n">chpl_cleanup</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">chpl_cleanup()</span></code> function will also cause the Python program to exit.
Make sure your Python functionality is also complete before calling this
function.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are taking advantage of the generated <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> initializer
file to import the output directory as a package, you do not need to call
<code class="docutils literal notranslate"><span class="pre">chpl_cleanup()</span></code> yourself because it is already registered to be called
at program exit. The generated initializer is explained below.</p>
</div>
</div>
<div class="section" id="python-init-file">
<span id="id5"></span><h3><a class="toc-backref" href="#id32">Python Init File</a><a class="headerlink" href="#python-init-file" title="Permalink to this headline">Â¶</a></h3>
<p>A simple <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file is generated in the output directory along with
the Python module. It looks roughly like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">atexit</span>

<span class="c1">#</span>
<span class="c1"># Here directoryName is the name of the directory containing your Python</span>
<span class="c1"># module, and moduleName is the name of your Python module.</span>
<span class="c1">#</span>
<span class="kn">from</span> <span class="nn">directoryName.moduleName</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">moduleName</span><span class="o">.</span><span class="n">chpl_cleanup</span><span class="p">)</span>
</pre></div>
</div>
<p>The initializer file allows the output directory to be imported as a Python
package. It will also register <code class="docutils literal notranslate"><span class="pre">chpl_cleanup()</span></code> to be called automatically
at program exit.</p>
<p>Like any other package, the generated Python package must be visible in order
to import it, such as through importing it locally or by adding it to the
<code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>. Refer to the Python 3 import
<a class="reference external" href="https://docs.python.org/3/reference/import.html#the-import-system">documentation</a>
for more details.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Builds Python module as foo/foo.py</span>
chpl --library-python foo.chpl

<span class="c1"># Adds the current directory to your PYTHONPATH</span>
<span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PWD</span><span class="s2">:</span><span class="nv">$PYTHONPATH</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>From within your Python script:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">foo</span>

<span class="c1">#</span>
<span class="c1"># Setup and use foo as normal. Note that we no longer have to call</span>
<span class="c1"># ``chpl_cleanup()`` when we are finished.</span>
<span class="c1">#</span>
<span class="n">foo</span><span class="o">.</span><span class="n">chpl_setup</span><span class="p">()</span>
<span class="n">foo</span><span class="o">.</span><span class="n">baz</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Chapel compiler will not generate an initializer file if a file with
the name <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> already exists in the output directory. The
compiler will emit a warning instead.</p>
</div>
</div>
<div class="section" id="argument-default-values">
<h3><a class="toc-backref" href="#id33">Argument Default Values</a><a class="headerlink" href="#argument-default-values" title="Permalink to this headline">Â¶</a></h3>
<p>Python has the capacity to support default values for arguments.  The ability to
call Chapel exported functions with argument default values from Python is
present, but is not yet fully supported.  See <a class="reference internal" href="#default-values"><span class="std std-ref">the Caveat section</span></a> for more details.</p>
<p>For the cases that are not supported, the compiler will generate a warning. The
argument must always be provided when calling the function.</p>
</div>
<div class="section" id="c-ptr-arguments">
<h3><a class="toc-backref" href="#id34">c_ptr Arguments</a><a class="headerlink" href="#c-ptr-arguments" title="Permalink to this headline">Â¶</a></h3>
<p>Python code can pass <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays or <code class="docutils literal notranslate"><span class="pre">ctypes</span></code> pointers to <code class="docutils literal notranslate"><span class="pre">c_ptr</span></code>
arguments.</p>
</div>
<div class="section" id="debugging-issues-with-library-python">
<h3><a class="toc-backref" href="#id35">Debugging Issues with âlibrary-python</a><a class="headerlink" href="#debugging-issues-with-library-python" title="Permalink to this headline">Â¶</a></h3>
<p>This compilation strategy uses Cython under the covers, generating a
<code class="docutils literal notranslate"><span class="pre">chpl_foo.pxd</span></code> file, a <code class="docutils literal notranslate"><span class="pre">foo.pyx</span></code> file, and a <code class="docutils literal notranslate"><span class="pre">foo.py</span></code> file by default for
a <code class="docutils literal notranslate"><span class="pre">libfoo.a</span></code> / <code class="docutils literal notranslate"><span class="pre">libfoo.so</span></code>, which are then called using a Cython command
(this command is rather long due to the need to include the Chapel runtime and
third-party libraries).  These files are currently left in the same location as
the generated library - if compilation fails due to generating one or more of
these files incorrectly, you may be able to modify the file and re-run the
Cython command yourself.</p>
</div>
</div>
<div class="section" id="using-your-library-in-fortran">
<span id="readme-libraries-fortran"></span><h2><a class="toc-backref" href="#id36">Using Your Library in Fortran</a><a class="headerlink" href="#using-your-library-in-fortran" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id37">Prerequisites</a><a class="headerlink" href="#id6" title="Permalink to this headline">Â¶</a></h3>
<p>To make use of your library in Fortran, a Fortran compiler that implements
the ISO_Fortran_binding.h header and interface defined by ISO/IEC TS 29113
is required.</p>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id38">Compiling Your Chapel Library</a><a class="headerlink" href="#id7" title="Permalink to this headline">Â¶</a></h3>
<p>To create a Fortran compatible module in addition to the normally generated
library and header, add <code class="docutils literal notranslate"><span class="pre">--library-fortran</span></code> to the compilation. This will
create a Fortran module containing declarations for each Chapel function
declared with <code class="docutils literal notranslate"><span class="pre">export</span></code>. This module can be used from Fortran in order to
make the functions exported from Chapel available.  At present, the generated
module only handles basic types for function arguments and return types, and
the compiler will emit warnings for any types it is unable to handle properly.</p>
</div>
<div class="section" id="initializing-and-using-your-library-from-fortran">
<h3><a class="toc-backref" href="#id39">Initializing and Using Your Library From Fortran</a><a class="headerlink" href="#initializing-and-using-your-library-from-fortran" title="Permalink to this headline">Â¶</a></h3>
<p>Once the library and Fortran interface module are generated, you can <code class="docutils literal notranslate"><span class="pre">use</span></code>
the interface module and make calls to the functions it declares.</p>
<p>Similarly to using your library with C and Python, you will need to call a
set up function to ensure the Chapel runtime and standard modules are
initialize. Unlike C and Python, your library currently needs to define
this function itself.  The following should work after replacing
<code class="docutils literal notranslate"><span class="pre">MyModuleName</span></code> with the name of the actual module:</p>
<div class="highlight-Chapel notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="k">proc</span> <span class="nf">chpl_library_init_ftn</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Make the runtime/library initialization function visible</span>
  <span class="k">extern</span> <span class="k">proc</span> <span class="nf">chpl_library_init</span><span class="p">(</span><span class="nx">argc</span><span class="p">:</span> <span class="nx">c_int</span><span class="p">,</span> <span class="nx">argv</span><span class="p">:</span> <span class="nx">c_ptr</span><span class="p">(</span><span class="nx">c_ptr</span><span class="p">(</span><span class="nx">c_char</span><span class="p">)));</span>
  <span class="kd">var</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">c</span><span class="s">&quot;fake&quot;</span><span class="p">;</span>
  <span class="c1">// Initialize the internal runtime/library</span>
  <span class="nx">chpl_library_init</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">c_ptrTo</span><span class="p">(</span><span class="nx">filename</span><span class="p">):</span> <span class="nx">c_ptr</span><span class="p">(</span><span class="nx">c_ptr</span><span class="p">(</span><span class="nx">c_char</span><span class="p">)));;</span>
  <span class="c1">// Initialize the main user module</span>
  <span class="nx">chpl__init_MyModuleName</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A simple Fortran example using a function <code class="docutils literal notranslate"><span class="pre">myChapelFunction</span></code> from the
<code class="docutils literal notranslate"><span class="pre">MyModuleName</span></code> library is:</p>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="k">program </span><span class="n">Example</span>
  <span class="c">! use the interface module generated with --library-fortran</span>
  <span class="k">use </span><span class="n">MyModuleName</span>
  <span class="k">implicit none</span>

<span class="k">  </span><span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">arg</span><span class="p">,</span> <span class="n">ret</span>
  <span class="n">arg</span> <span class="o">=</span> <span class="mi">3</span>

  <span class="c">! initialize the Chapel library using the function defined above</span>
  <span class="k">call </span><span class="n">chpl_library_init_ftn</span><span class="p">()</span>

  <span class="c">! call a function from the Chapel library</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">myChapelFunction</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

  <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="n">ret</span>
<span class="k">end program </span><span class="n">Example</span>
</pre></div>
</div>
<p>This would then be compiled with commands to first build the interface module,
then to build the example program and link with the Chapel library and Chapel
runtime libraries:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ftn -c lib/MyModuleName.f90
ftn Example.f90 -Llib -lMyModuleName <span class="sb">`</span><span class="nv">$CHPL_HOME</span>/util/config/compileline --libraries<span class="sb">`</span> -o Example
</pre></div>
</div>
</div>
</div>
<div class="section" id="arrays">
<h2><a class="toc-backref" href="#id40">Arrays</a><a class="headerlink" href="#arrays" title="Permalink to this headline">Â¶</a></h2>
<p>Arrays can be returned by exported Chapel functions as one of two C types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">chpl_external_array</span></code></p>
<ul>
<li><p>For arrays that can be translated into native C or Python arrays.  In
Python, the contents of this type is copied into a Python array.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">chpl_opaque_array</span></code></p>
<ul>
<li><p>For arrays that are not currently translated.  In Python, this is used as a
field in a Python class named <code class="docutils literal notranslate"><span class="pre">ChplOpaqueArray</span></code>.</p></li>
</ul>
</li>
</ul>
<div class="section" id="chpl-external-array">
<h3><a class="toc-backref" href="#id41">chpl_external_array</a><a class="headerlink" href="#chpl-external-array" title="Permalink to this headline">Â¶</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">chpl_external_array</span></code> can be created in C or returned by a Chapel function
declared as returning specific Chapel array types.  To create a
<code class="docutils literal notranslate"><span class="pre">chpl_external_array</span></code> in C, you can call:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">chpl_make_external_array(elt_size,</span> <span class="pre">num_elts)</span></code> to create an empty array of
the given size.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chpl_make_external_array_ptr(elts,</span> <span class="pre">num_elts)</span></code> where <code class="docutils literal notranslate"><span class="pre">elts</span></code> is an existing
array of the given size.</p></li>
</ul>
<p>Users should call <code class="docutils literal notranslate"><span class="pre">chpl_free_external_array</span></code> to indicate that they are done
using the <code class="docutils literal notranslate"><span class="pre">chpl_external_array</span></code> instance if it was created for them by a
Chapel function or via <code class="docutils literal notranslate"><span class="pre">chpl_make_external_array</span></code>.  Users should explicitly
free any memory that was stored in a <code class="docutils literal notranslate"><span class="pre">chpl_external_array</span></code> using
<code class="docutils literal notranslate"><span class="pre">chpl_make_external_array_ptr</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The names of these functions may change.</p>
</div>
</div>
<div class="section" id="chpl-opaque-array">
<h3><a class="toc-backref" href="#id42">chpl_opaque_array</a><a class="headerlink" href="#chpl-opaque-array" title="Permalink to this headline">Â¶</a></h3>
<p>Chapel arrays that cannot be returned using <code class="docutils literal notranslate"><span class="pre">chpl_external_array</span></code> will be
returned using <code class="docutils literal notranslate"><span class="pre">chpl_opaque_array</span></code>.  <code class="docutils literal notranslate"><span class="pre">chpl_opaque_array</span></code> instances cannot be
created outside of Chapel, nor can their contents be accessed.
<code class="docutils literal notranslate"><span class="pre">chpl_opaque_array</span></code> instances can only be received and sent to Chapel
functions.</p>
<p>Users should call <code class="docutils literal notranslate"><span class="pre">cleanupOpaqueArray</span></code> to indicate they are done using the
<code class="docutils literal notranslate"><span class="pre">chpl_opaque_array</span></code> instance.</p>
<p>It is our intention to support as many Chapel array types as we can using
<code class="docutils literal notranslate"><span class="pre">chpl_external_array</span></code>.  Chapel arrays types that are currently supported using
<code class="docutils literal notranslate"><span class="pre">chpl_opaque_array</span></code> may become supported by <code class="docutils literal notranslate"><span class="pre">chpl_external_array</span></code> instead
in the future.</p>
</div>
<div class="section" id="fortran-arrays">
<h3><a class="toc-backref" href="#id43">Fortran arrays</a><a class="headerlink" href="#fortran-arrays" title="Permalink to this headline">Â¶</a></h3>
<p>A 1-D contiguous Fortran array can be passed to an exported Chapel function
for an argument with the type <code class="docutils literal notranslate"><span class="pre">[]</span> <span class="pre">t</span></code> where <code class="docutils literal notranslate"><span class="pre">t</span></code> is a primitive type.  The
Chapel compiler will automatically translate such an array into a Chapel array.
This allows it to be used in all the ways any other Chapel array can be used,
for example in parallel loops or reductions.</p>
</div>
</div>
<div class="section" id="using-your-library-in-chapel">
<h2><a class="toc-backref" href="#id44">Using Your Library in Chapel</a><a class="headerlink" href="#using-your-library-in-chapel" title="Permalink to this headline">Â¶</a></h2>
<p>Chapel library files cannot be used from Chapel code.  The library files must
include the chapel runtime and standard modules for use in a non-Chapel program
and when the library is linked to a Chapel program this leads to multiple
definitions of these functions.</p>
</div>
<div class="section" id="using-your-library-in-multilocale-settings">
<h2><a class="toc-backref" href="#id45">Using Your Library in Multilocale Settings</a><a class="headerlink" href="#using-your-library-in-multilocale-settings" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id46">Prerequisites</a><a class="headerlink" href="#id8" title="Permalink to this headline">Â¶</a></h3>
<p>Chapel also supports <code class="docutils literal notranslate"><span class="pre">--library</span></code> when <code class="docutils literal notranslate"><span class="pre">CHPL_COMM</span> <span class="pre">!=</span> <span class="pre">none</span></code>.  We intend to
support other settings in the future, see <a class="reference internal" href="#other-settings"><span class="std std-ref">Other Settings</span></a> in the
<a class="reference internal" href="#multilocale-caveats"><span class="std std-ref">Multilocale Caveats</span></a> section for more information.</p>
<p>To compile a multilocale library, <a class="reference external" href="https://zeromq.org/">ZeroMQ</a> must be
installed.</p>
<p>If ZeroMQ is not installed in a way that enables your C compiler to find it
easily, the environment variable <code class="docutils literal notranslate"><span class="pre">CHPL_ZMQ_HOME</span></code> can be set.  This environment
variable should be set to a directory containing both an <code class="docutils literal notranslate"><span class="pre">include</span></code> directory
which contains <code class="docutils literal notranslate"><span class="pre">zmq.h</span></code> and a <code class="docutils literal notranslate"><span class="pre">lib</span></code> directory which contains <code class="docutils literal notranslate"><span class="pre">libzmq.*</span></code>.
For example, for a directory structure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>|-- .local/
|    |-- include/
|    |    |-- zmq.h
|    |-- lib/
|    |    |-- libzmq.a
|    |    |-- libzmq.so
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CHPL_ZMQ_HOME</span></code> would be set to <code class="docutils literal notranslate"><span class="pre">/absolute/path/to/.local/</span></code>.</p>
</div>
<div class="section" id="initializing-your-multilocale-library">
<h3><a class="toc-backref" href="#id47">Initializing Your Multilocale Library</a><a class="headerlink" href="#initializing-your-multilocale-library" title="Permalink to this headline">Â¶</a></h3>
<p>Multilocale libraries can be used in a manner similar to single locale
libraries.  However, as with transitioning between a single locale executable
and a multilocale one, it is necessary to specify the number of locales required
for the multilocale library.</p>
<div class="section" id="in-c">
<h4><a class="toc-backref" href="#id48">In C</a><a class="headerlink" href="#in-c" title="Permalink to this headline">Â¶</a></h4>
<p>Users must still call <code class="docutils literal notranslate"><span class="pre">chpl_library_init()</span></code> before utilizing the exported
Chapel functions.  However, the <code class="docutils literal notranslate"><span class="pre">char*</span> <span class="pre">argv[]</span></code> must now include two additional
entries: the numlocales flag and its intended value.</p>
<p>This can be accomplished either by explicitly adding the arguments in the C
client program itself, or by passing them as arguments to the executable.</p>
<p>This example demonstrates explicitly adding the arguments in the program using
the <code class="docutils literal notranslate"><span class="pre">foo</span></code> library.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;foo.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">argChapelC</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">char</span><span class="o">*</span> <span class="n">argChapelV</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;-nl&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">};</span>
  <span class="c1">// Initialize the Chapel runtime and standard modules</span>
  <span class="n">chpl_library_init</span><span class="p">(</span><span class="n">argChapelC</span><span class="p">,</span> <span class="n">argChapelV</span><span class="p">);</span>

  <span class="n">baz</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span> <span class="c1">// Call into a library function</span>

  <span class="n">chpl_library_finalize</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Alternatively, the original single locale client from <a class="reference internal" href="#initializing-your-library-in-c">Initializing Your
Library In C</a> can be used with the additional two arguments to the executable:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./a.out -nl <span class="m">2</span>
</pre></div>
</div>
<p>Users also still need to call the generated module initialization function for
multilocale libraries, as mentioned in that section.</p>
</div>
<div class="section" id="in-python">
<h4><a class="toc-backref" href="#id49">In Python</a><a class="headerlink" href="#in-python" title="Permalink to this headline">Â¶</a></h4>
<p>Users must still call <code class="docutils literal notranslate"><span class="pre">chpl_setup()</span></code> before utilizing the exported Chapel
functions.  However, it requires a <code class="docutils literal notranslate"><span class="pre">numLocales</span></code> argument when the library
has been compiled for multilocale settings.  E.g. to run with <code class="docutils literal notranslate"><span class="pre">4</span></code> locales,
write:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">chpl_setup</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>instead of:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">chpl_setup</span><span class="p">()</span>
</pre></div>
</div>
<p>in addition to the other steps described in <a class="reference internal" href="#python-libraries"><span class="std std-ref">Initializing and Using Your Library in Python</span></a>.</p>
</div>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id50">Makefile-less Compilation</a><a class="headerlink" href="#id9" title="Permalink to this headline">Â¶</a></h3>
<p>When compiling a C program using a multilocale Chapel library without a
makefile, some additional steps are needed beyond those required for using a
<a class="reference internal" href="#makefileless-compilation-in-single-locale"><span class="std std-ref">single locale Chapel library</span></a>.
For this reason, we strongly suggest using the Makefile generated by the
<code class="docutils literal notranslate"><span class="pre">--library-makefile</span></code> flag, as described <a class="reference internal" href="#makefile-helper"><span class="std std-ref">here</span></a>.  If
you are using this flag, you can skip the rest of this section.</p>
<p>A new <code class="docutils literal notranslate"><span class="pre">compileline</span></code> tool, <code class="docutils literal notranslate"><span class="pre">compileline</span> <span class="pre">--multilocale-lib-deps</span></code> is currently
required after <code class="docutils literal notranslate"><span class="pre">compileline</span> <span class="pre">--libraries</span></code>.  Additionally, the library being
linked must be listed twice in the compilation command - once before
<code class="docutils literal notranslate"><span class="pre">compileline</span> <span class="pre">--libraries</span></code> and once at the end of the command.  The compilation
command would then look like this (replacing <code class="docutils literal notranslate"><span class="pre">myCProg.c</span></code> with the name of your
C program that will use the library):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="sb">`</span><span class="nv">$CHPL_HOME</span>/util/config/compileline --compile<span class="sb">`</span> myCProg.c -Llib/ -lfoo <span class="se">\</span>
<span class="sb">`</span><span class="nv">$CHPL_HOME</span>/util/config/compileline --libraries<span class="sb">`</span> <span class="se">\</span>
<span class="sb">`</span><span class="nv">$CHPL_HOME</span>/util/config/compileline --multilocale-lib-deps<span class="sb">`</span> -lfoo
</pre></div>
</div>
</div>
<div class="section" id="what-is-this-server-real-program">
<h3><a class="toc-backref" href="#id51">What is this _server_real program?</a><a class="headerlink" href="#what-is-this-server-real-program" title="Permalink to this headline">Â¶</a></h3>
<p>When you compile a Chapel library for use with multiple locales, you should
typically see both a library (see <a class="reference internal" href="#location-of-the-generated-library"><span class="std std-ref">Location of the Generated Library</span></a> for
where this will be placed and how to control that location) and a binary (which
is currently generated in the same directory as the âmainâ source file), in
addition to other support files such as the generated header, makefile, etc.</p>
<p>The library will be named as specified in <a class="reference internal" href="#library-name"><span class="std std-ref">Library Name</span></a>; the binary will
use the same base name as the library (omitting the <code class="docutils literal notranslate"><span class="pre">lib</span></code> and <code class="docutils literal notranslate"><span class="pre">.so</span></code> or
<code class="docutils literal notranslate"><span class="pre">.a</span></code> portions), followed by <code class="docutils literal notranslate"><span class="pre">_server_real</span></code>.  Thus for a library
<code class="docutils literal notranslate"><span class="pre">libfoo.so</span></code>, the binary would be named <code class="docutils literal notranslate"><span class="pre">foo_server_real</span></code>.</p>
<p>The library will appear like a normal single locale library in terms of the
interface it provides to client programs - however, under the covers it will
launch the binary and then communicate with it.  The binary will be what
executes the exported functions and will communicate the result back to the
library, to return to the client program.</p>
</div>
<div class="section" id="hostnames-and-connection-issues">
<h3><a class="toc-backref" href="#id52">Hostnames and Connection Issues</a><a class="headerlink" href="#hostnames-and-connection-issues" title="Permalink to this headline">Â¶</a></h3>
<p>By default, the generated client library will expect the generated server to
communicate with it using the hostname of where the client program is running,
as obtained by <code class="docutils literal notranslate"><span class="pre">gethostname()</span></code>.  This default can be overridden by setting
the environment variable <a class="reference internal" href="../usingchapel/launcher.html#chpl-rt-masterip"><span class="std std-ref">CHPL_RT_MASTERIP</span></a>.</p>
</div>
<div class="section" id="debugging-issues-with-multilocale-libraries">
<h3><a class="toc-backref" href="#id53">Debugging Issues with Multilocale Libraries</a><a class="headerlink" href="#debugging-issues-with-multilocale-libraries" title="Permalink to this headline">Â¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">chpl</span></code> compiler provides a developer flag, <code class="docutils literal notranslate"><span class="pre">--library-ml-debug</span></code>, which
can be used to generate communication and underlying library implementation
debugging output.  It is useful for tracking down connection issues between the
generated executable and the generated library and unlikely to be helpful when
tracking down issues with an exported functionâs body.</p>
</div>
</div>
<div class="section" id="caveats">
<h2><a class="toc-backref" href="#id54">Caveats</a><a class="headerlink" href="#caveats" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="supported-types-for-export-procs">
<h3><a class="toc-backref" href="#id55">Supported Types for export procs</a><a class="headerlink" href="#supported-types-for-export-procs" title="Permalink to this headline">Â¶</a></h3>
<p>See <a class="reference internal" href="extern.html#readme-extern-declarations-limitations"><span class="std std-ref">Allowed Intents and Types</span></a> for details of what
intents and types are allowed.</p>
</div>
<div class="section" id="multiple-chapel-libraries">
<h3><a class="toc-backref" href="#id56">Multiple Chapel Libraries</a><a class="headerlink" href="#multiple-chapel-libraries" title="Permalink to this headline">Â¶</a></h3>
<p>Multiple Chapel libraries cannot currently be used in the same C or Python
program.  Each library file must include the chapel runtime and standard modules
for its own functionality and when two or more libraries are linked to a program
this leads to multiple definitions of these functions.</p>
</div>
<div class="section" id="llvm">
<h3><a class="toc-backref" href="#id57">LLVM</a><a class="headerlink" href="#llvm" title="Permalink to this headline">Â¶</a></h3>
<p>LLVM support with <code class="docutils literal notranslate"><span class="pre">--library</span></code> is currently a work-in-progress.  For the 1.20
release, it does not support Fortran or multilocale interoperability.  We expect
to extend this support in later releases.</p>
</div>
<div class="section" id="exporting-symbols">
<span id="id10"></span><h3><a class="toc-backref" href="#id58">Exporting Symbols</a><a class="headerlink" href="#exporting-symbols" title="Permalink to this headline">Â¶</a></h3>
<p>Only functions can be exported currently.  We hope to extend this support to
types and global variables in the future.</p>
<div class="section" id="default-values">
<span id="id11"></span><h4><a class="toc-backref" href="#id59">Argument Default Values</a><a class="headerlink" href="#default-values" title="Permalink to this headline">Â¶</a></h4>
<p>Python interoperability currently supports default values for function
arguments, but only when the default value is a literal (e.g. <code class="docutils literal notranslate"><span class="pre">4</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;blah&quot;</span></code>).  Default values that are more complicated are not currently
supported.  We hope to extend this support in the future.</p>
<p>C interoperability does not support default values for function arguments.  We
do not anticipate supporting argument default values in C.</p>
</div>
<div class="section" id="intents-in-python-interoperability">
<span id="python-intents"></span><h4><a class="toc-backref" href="#id60">Intents in Python Interoperability</a><a class="headerlink" href="#intents-in-python-interoperability" title="Permalink to this headline">Â¶</a></h4>
<p>Libraries compiled for Python do not support the default intent for <code class="docutils literal notranslate"><span class="pre">string</span></code>,
<code class="docutils literal notranslate"><span class="pre">c_string</span></code> or 1D arrays, as copies are currently performed (which would
violate <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">ref</span></code>).  Instead, only the <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">in</span></code> intents are
supported for these types.  We may be able to support all intents in the future.</p>
</div>
</div>
<div class="section" id="multilocale-caveats">
<span id="id12"></span><h3><a class="toc-backref" href="#id61">Multilocale Caveats</a><a class="headerlink" href="#multilocale-caveats" title="Permalink to this headline">Â¶</a></h3>
<div class="section" id="other-settings">
<span id="id13"></span><h4><a class="toc-backref" href="#id62">Other Settings</a><a class="headerlink" href="#other-settings" title="Permalink to this headline">Â¶</a></h4>
<p>The following settings are not yet supported for <code class="docutils literal notranslate"><span class="pre">--library</span></code> compilation:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--no-local</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CHPL_COMM</span> <span class="pre">=</span> <span class="pre">none</span></code> when <code class="docutils literal notranslate"><span class="pre">CHPL_LAUNCHER</span> <span class="pre">!=</span> <span class="pre">none</span></code></p></li>
</ul>
<p>These settings would behave similarly to the current behavior with <code class="docutils literal notranslate"><span class="pre">CHPL_COMM</span> <span class="pre">=</span>
<span class="pre">gasnet</span></code>, when relevant - for instance, it is expected that all of these
settings would result in an executable that communicates with the userâs program
via the generated library.</p>
<p>Other configurations may also become supported in the future.</p>
<div class="section" id="host-and-target-compilers">
<h5><a class="toc-backref" href="#id63">Host and Target Compilers</a><a class="headerlink" href="#host-and-target-compilers" title="Permalink to this headline">Â¶</a></h5>
<p>Multilocale libraries currently require the host and target compiler to be
compatible. For example, on Crays, a host value of <code class="docutils literal notranslate"><span class="pre">gnu</span></code> and a target
value of <code class="docutils literal notranslate"><span class="pre">cray-prgenv-gnu</span></code> would be considered equivalent.</p>
<p>In the near future, the client library (the library that a user will link
against) will be compiled by the host compiler, while the server will be
compiled by the target compiler.</p>
</div>
</div>
<div class="section" id="supported-types">
<h4><a class="toc-backref" href="#id64">Supported Types</a><a class="headerlink" href="#supported-types" title="Permalink to this headline">Â¶</a></h4>
<p>Multilocale libraries support the same argument and return types as single
locale libraries, with the notable exception of <code class="docutils literal notranslate"><span class="pre">complex</span></code> numbers, arrays, and
pointer types.  We anticipate extending the supported types in the future,
though may not end up supporting pointer types.</p>
</div>
<div class="section" id="intents">
<h4><a class="toc-backref" href="#id65">Intents</a><a class="headerlink" href="#intents" title="Permalink to this headline">Â¶</a></h4>
<p>Multilocale libraries do not support the default intent for <code class="docutils literal notranslate"><span class="pre">string</span></code> and
<code class="docutils literal notranslate"><span class="pre">c_string</span></code>, as the default intent is <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">ref</span></code>.  Only the <code class="docutils literal notranslate"><span class="pre">in</span></code> and
<code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">in</span></code> intents are supported.  We may expand to support <code class="docutils literal notranslate"><span class="pre">out</span></code> and
<code class="docutils literal notranslate"><span class="pre">inout</span></code> in the future.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="fortranInterop.html" class="btn btn-neutral float-right" title="Fortran Interoperability" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="extern.html" class="btn btn-neutral float-left" title="C Interoperability" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>