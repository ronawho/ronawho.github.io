

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Protocol Buffers Support - Generated Chapel Code &mdash; Chapel Documentation 1.24</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tools" href="../tools/index.html" />
    <link rel="prev" title="Variables to Detect Compilation Configuration" href="globalvars.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.24
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.24";
$pagename = "technotes/protoGenCodeGuide";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Technical Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#base-language-features">Base Language Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#initializers-and-generic-programming">Initializers and Generic Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#parallel-language-features">Parallel Language Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#interoperability">Interoperability</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#compiler-features">Compiler Features</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#tool-details">Tool Details</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Protocol Buffers Support - Generated Chapel Code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#compiler-invocation">Compiler Invocation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output-module-name">Output Module Name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#messages">Messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fields">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enumerations">Enumerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oneof">Oneof</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nested-types">Nested Types</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../primers/index.html">Primers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mason-packages.html">Mason Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Technical Notes</a> &raquo;</li>
        
      <li>Protocol Buffers Support - Generated Chapel Code</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/technotes/protoGenCodeGuide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="protocol-buffers-support-generated-chapel-code">
<span id="readme-protogencodeguide"></span><h1>Protocol Buffers Support - Generated Chapel Code<a class="headerlink" href="#protocol-buffers-support-generated-chapel-code" title="Permalink to this headline">¶</a></h1>
<p>This page describes exactly what Chapel code the protocol buffer compiler
generates for protocol definitions using <code class="docutils literal notranslate"><span class="pre">proto3</span></code> syntax. Please see
<a class="reference internal" href="../tools/protoc-gen-chpl/protoc-gen-chpl.html#readme-protobuf"><span class="std std-ref">Protocol Buffers Support in Chapel</span></a> for information about how to use the protocol
buffer support. Additionally, this document assumes familiarity with the
<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3">proto3 language guide</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The aim of this documentation is to provide a better understanding of the
generated code. The user is not expected to modify the generated file.</p>
</div>
<div class="section" id="compiler-invocation">
<h2>Compiler Invocation<a class="headerlink" href="#compiler-invocation" title="Permalink to this headline">¶</a></h2>
<p>The protocol buffer compiler produces Chapel output when invoked with the <code class="docutils literal notranslate"><span class="pre">--chpl_out</span></code>
command-line flag. The parameter to the <code class="docutils literal notranslate"><span class="pre">--chpl_out</span></code> option is the directory where
you want the compiler to write your Chapel output. The compiler creates a single
source file for each <code class="docutils literal notranslate"><span class="pre">.proto</span></code> file input, having a <code class="docutils literal notranslate"><span class="pre">.chpl</span></code> extension.</p>
<p>Only <code class="docutils literal notranslate"><span class="pre">proto3</span></code> messages are supported by the Chapel code generator. Ensure
that each <code class="docutils literal notranslate"><span class="pre">.proto</span></code> file begins with a declaration of:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="k">syntax</span> <span class="o">=</span> <span class="s">&quot;proto3&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="output-module-name">
<h2>Output Module Name<a class="headerlink" href="#output-module-name" title="Permalink to this headline">¶</a></h2>
<p>The name of the output file/module will be same as the <code class="docutils literal notranslate"><span class="pre">package</span></code> name. If the
<code class="docutils literal notranslate"><span class="pre">package</span></code> name is not specified, the module takes the name of the proto
file with all non-alphanumeric characters replaced by an <code class="docutils literal notranslate"><span class="pre">underscore</span></code>.</p>
<p>For example a file called <code class="docutils literal notranslate"><span class="pre">address.proto</span></code> without the package specifier will
result in an output file called <code class="docutils literal notranslate"><span class="pre">address.chpl</span></code> with the generated code wrapped
in a module of the same name. (Full implementation is not shown here.)</p>
<p><code class="docutils literal notranslate"><span class="pre">address.proto</span></code></p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="k">syntax</span> <span class="o">=</span> <span class="s">&quot;proto3&quot;</span><span class="p">;</span>

<span class="kd">message</span> <span class="nc">messageName</span> <span class="p">{</span>
<span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">address.chpl</span></code></p>
<div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">address</span> <span class="p">{</span>
  <span class="k">record</span> <span class="nc">messageName</span> <span class="p">{</span>
  <span class="o">..</span><span class="p">.</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The same proto file with a package declaration <code class="docutils literal notranslate"><span class="pre">package</span> <span class="pre">myPackage;</span></code> will
result in a file called <code class="docutils literal notranslate"><span class="pre">myPackage.chpl</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">address.proto</span></code></p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="k">syntax</span> <span class="o">=</span> <span class="s">&quot;proto3&quot;</span><span class="p">;</span>

<span class="kn">package</span> <span class="nn">myPackage</span><span class="p">;</span>

<span class="kd">message</span> <span class="nc">messageName</span> <span class="p">{</span>
<span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">myPackage.chpl</span></code></p>
<div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">myPackage</span> <span class="p">{</span>
  <span class="k">record</span> <span class="nc">messageName</span> <span class="p">{</span>
  <span class="o">..</span><span class="p">.</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="messages">
<h2>Messages<a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h2>
<p>Given a simple message declaration:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="kt">int32</span> <span class="na">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The protocol buffer compiler generates a record called <code class="docutils literal notranslate"><span class="pre">Foo</span></code>, which has message
field initializers and serialization/parsing methods for wire-type encoding.
(Full implementation is not shown here.)</p>
<blockquote>
<div><div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="k">record</span> <span class="nc">Foo</span> <span class="p">{</span>

  <span class="cm">/*</span>
<span class="cm">    Returns the package name of the proto file. If not declared the method returns</span>
<span class="cm">    an empty string.</span>
<span class="cm">  */</span>
  <span class="k">proc</span> <span class="nf">packageName</span> <span class="kd">param</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;packageName&quot;</span><span class="p">;</span> <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">    Returns the name of the proto message the record is derived from.</span>
<span class="cm">  */</span>
  <span class="k">proc</span> <span class="nf">messageName</span> <span class="kd">param</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;Foo&quot;</span><span class="p">;</span> <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">    Record fields will be generated corresponding to each proto message field.</span>
<span class="cm">  */</span>
  <span class="kd">var</span> <span class="nx">num</span><span class="p">:</span> <span class="kt">int</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">    Used to store encoded byte stream of unknown fields encountered while parsing.</span>

<span class="cm">    As per proto3 documentation, unknown fields should be preserved and appended</span>
<span class="cm">    to the generated message byte stream.</span>
<span class="cm">  */</span>
  <span class="kd">var</span> <span class="nx">unknownFieldStream</span><span class="p">:</span> <span class="kt">bytes</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">    User exposed method for serializing data to protobuf wire format.</span>

<span class="cm">    This is a wrapper method to the actual method.</span>
<span class="cm">  */</span>
  <span class="k">proc</span> <span class="nf">serialize</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">    Contains the actual implementation for serializing data.</span>

<span class="cm">    Calls the `Append` functions of the user support library. It appends the</span>
<span class="cm">    `unknownFieldStream` at the end of the message.</span>

<span class="cm">    This should end up as a private method when supported, so a user should not</span>
<span class="cm">    call it directly.</span>
<span class="cm">  */</span>
  <span class="k">proc</span> <span class="nf">_serialize</span><span class="p">(</span><span class="nx">binCh</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">    User exposed method for parsing data from protobuf wire format.</span>

<span class="cm">    This is a wrapper method to the actual method.</span>
<span class="cm">  */</span>
  <span class="k">proc</span> <span class="nf">deserialize</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">    Contains the actual implementation for parsing data.</span>

<span class="cm">    Calls the `Consume` functions of the user support library. Appends unknown</span>
<span class="cm">    fields encountered to the `unknownFieldStream` variable.</span>

<span class="cm">    This should end up as a private method when supported, so a user should not</span>
<span class="cm">    call it directly.</span>
<span class="cm">  */</span>
  <span class="k">proc</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="nx">binCh</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="any-message-type">
<h3>Any Message Type<a class="headerlink" href="#any-message-type" title="Permalink to this headline">¶</a></h3>
<p>For Any messages, you can call <code class="docutils literal notranslate"><span class="pre">pack</span></code> to pack a specified message into the
current Any message, or <code class="docutils literal notranslate"><span class="pre">unpack</span></code> to unpack the current Any message to a specified
message. Corresponding to an any message type field the plugin will generate a record
field of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type.</p>
<div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="c1">// Field &quot;a&quot;</span>
<span class="kd">var</span> <span class="nx">a</span><span class="p">:</span> <span class="nx">Any</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fields">
<h2>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h2>
<p>The protocol buffer compiler generates a Chapel record field for each field defined
within a message. Methods equivalent to <cite>get</cite> and <cite>set</cite> in other languages are
implicitly generated by the Chapel compiler, so do not need to be generated by
the protocol buffer compiler.</p>
<div class="section" id="scalar-value-types">
<h3>Scalar Value Types<a class="headerlink" href="#scalar-value-types" title="Permalink to this headline">¶</a></h3>
<p>A scalar message field can have one of the following types, the table shows the
type specified in the <code class="docutils literal notranslate"><span class="pre">.proto</span></code> file, and the corresponding generated Chapel type:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>.proto Type</p></th>
<th class="head"><p>Chapel Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>double</p></td>
<td><p>real(64)</p></td>
</tr>
<tr class="row-odd"><td><p>float</p></td>
<td><p>real(32)</p></td>
</tr>
<tr class="row-even"><td><p>int32</p></td>
<td><p>int(32)</p></td>
</tr>
<tr class="row-odd"><td><p>int64</p></td>
<td><p>int(64)</p></td>
</tr>
<tr class="row-even"><td><p>uint32</p></td>
<td><p>uint(32)</p></td>
</tr>
<tr class="row-odd"><td><p>uint64</p></td>
<td><p>uint(64)</p></td>
</tr>
<tr class="row-even"><td><p>sint32</p></td>
<td><p>int(32)</p></td>
</tr>
<tr class="row-odd"><td><p>sint64</p></td>
<td><p>int(64)</p></td>
</tr>
<tr class="row-even"><td><p>fixed32</p></td>
<td><p>uint(32)</p></td>
</tr>
<tr class="row-odd"><td><p>fixed64</p></td>
<td><p>uint(64)</p></td>
</tr>
<tr class="row-even"><td><p>sfixed32</p></td>
<td><p>int(32)</p></td>
</tr>
<tr class="row-odd"><td><p>sfixed64</p></td>
<td><p>int(64)</p></td>
</tr>
<tr class="row-even"><td><p>bool</p></td>
<td><p>bool</p></td>
</tr>
<tr class="row-odd"><td><p>string</p></td>
<td><p>string</p></td>
</tr>
<tr class="row-even"><td><p>bytes</p></td>
<td><p>bytes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="singular-fields">
<h3>Singular Fields<a class="headerlink" href="#singular-fields" title="Permalink to this headline">¶</a></h3>
<p>Every <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3#specifying_field_rules">singular</a> message field generates a record field variable of an appropriate Chapel type.
Fetching a value from a field which hasn’t been explicitly set will return the
default chapel value for that type. For example, a boolean field <code class="docutils literal notranslate"><span class="pre">a</span></code> will generate a
variable of <code class="docutils literal notranslate"><span class="pre">bool</span></code> type, with default value of <code class="docutils literal notranslate"><span class="pre">false</span></code>:</p>
<div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="c1">// Field &quot;a&quot;</span>
<span class="kd">var</span> <span class="nx">a</span><span class="p">:</span> <span class="kt">bool</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="repeated-fields">
<h3>Repeated Fields<a class="headerlink" href="#repeated-fields" title="Permalink to this headline">¶</a></h3>
<p>Every <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3#specifying_field_rules">repeated</a> message field generates a list type. Fetching a value from a field which
hasn’t been explicitly set will return an empty list. For example, a repeated
string field <code class="docutils literal notranslate"><span class="pre">a</span></code> will generate a list of type <code class="docutils literal notranslate"><span class="pre">string</span></code>:</p>
<div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="c1">// Field &quot;a&quot;</span>
<span class="kd">var</span> <span class="nx">a</span><span class="p">:</span> <span class="nx">list</span><span class="p">(</span><span class="kt">string</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="map-fields">
<h3>Map Fields<a class="headerlink" href="#map-fields" title="Permalink to this headline">¶</a></h3>
<p>Given this message definition:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="n">map</span><span class="p">&lt;</span><span class="kt">int32</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;</span> <span class="na">mapfield</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The plugin will generate a Chapel <code class="docutils literal notranslate"><span class="pre">map(int(32),</span> <span class="pre">bool)</span></code> type field:</p>
<div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="c1">// Field &quot;mapfield&quot;</span>
<span class="kd">var</span> <span class="nx">mapfield</span><span class="p">:</span> <span class="nx">map</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="kt">bool</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="enumerations">
<h2>Enumerations<a class="headerlink" href="#enumerations" title="Permalink to this headline">¶</a></h2>
<p>Given an enumeration definition like:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="kd">enum</span> <span class="n">Color</span> <span class="p">{</span>
  <span class="na">RED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="na">GREEN</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="na">BLUE</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The protocol buffer compiler will generate a Chapel enum type called <code class="docutils literal notranslate"><span class="pre">Color</span></code> with the
same set of values.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Color</span></code> proto enum above would therefore become the following Chapel code:</p>
<div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="nx">Color</span> <span class="p">{</span>
  <span class="nx">RED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nx">GREEN</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
  <span class="nx">BLUE</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="oneof">
<h2>Oneof<a class="headerlink" href="#oneof" title="Permalink to this headline">¶</a></h2>
<p>Given a message with a oneof:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="k">oneof</span> <span class="n">test_oneof</span> <span class="p">{</span>
     <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="kt">int32</span> <span class="na">serial_number</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The Chapel record corresponding to <code class="docutils literal notranslate"><span class="pre">Foo</span></code> will have <code class="docutils literal notranslate"><span class="pre">name_</span></code> and <code class="docutils literal notranslate"><span class="pre">serial_number_</span></code>
fields along with explicit <code class="docutils literal notranslate"><span class="pre">get/set</span></code> type methods:</p>
<div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="c1">// Field &quot;name&quot;</span>
<span class="kd">var</span> <span class="nx">name_</span><span class="p">:</span> <span class="kt">string</span><span class="p">;</span>
<span class="k">proc</span> <span class="nf">name</span> <span class="p">{</span>
  <span class="o">..</span><span class="p">.</span>
<span class="p">}</span>
<span class="k">proc</span> <span class="nf">ref</span> <span class="nx">name</span> <span class="kd">ref</span> <span class="p">{</span>
  <span class="o">..</span><span class="p">.</span>
<span class="p">}</span>

<span class="c1">// Field &quot;serial_number&quot;</span>
<span class="kd">var</span> <span class="nx">serial_number_</span><span class="p">:</span> <span class="kt">int</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
<span class="k">proc</span> <span class="nf">serial_number</span> <span class="p">{</span>
  <span class="o">..</span><span class="p">.</span>
<span class="p">}</span>
<span class="k">proc</span> <span class="nf">ref</span> <span class="nx">serial_number</span> <span class="kd">ref</span> <span class="p">{</span>
  <span class="o">..</span><span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The explicit methods are declared to allow the user to set at most one of the
fields in a oneof at a time. For example:</p>
<div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="nx">messageObj</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s">&quot;chapel&quot;</span><span class="p">;</span>
<span class="nx">messageObj</span><span class="p">.</span><span class="nx">serial_number</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span>
</pre></div>
</div>
<p>Setting the value of <code class="docutils literal notranslate"><span class="pre">serial_number</span></code> after <code class="docutils literal notranslate"><span class="pre">name</span></code> will set <code class="docutils literal notranslate"><span class="pre">name</span></code> to its
default value(“” in case of string).</p>
</div>
<div class="section" id="nested-types">
<h2>Nested Types<a class="headerlink" href="#nested-types" title="Permalink to this headline">¶</a></h2>
<p>A message can be declared inside another message. For example:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="kd">message</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this case, or if a message contains a nested enum declaration, the compiler will generate
module level record/enum per nested type. This generated record or enum will have a name prefixed
by the parent message name:</p>
<div class="highlight-chpl notranslate"><div class="highlight"><pre><span></span><span class="k">record</span> <span class="nc">Foo</span> <span class="p">{</span>
 <span class="o">..</span><span class="p">.</span>
<span class="p">}</span>

<span class="c1">// Nested Types</span>
<span class="k">record</span> <span class="nc">Foo_Bar</span> <span class="p">{</span>
  <span class="o">..</span><span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nested records or declaration of enums in records are currently not supported in
Chapel. Once we have support for these, we can declare nested types in the parent
record and thus avoid the name prefix.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tools/index.html" class="btn btn-neutral float-right" title="Tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="globalvars.html" class="btn btn-neutral float-left" title="Variables to Detect Compilation Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>