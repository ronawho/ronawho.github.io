

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>learnChapelInYMinutes.chpl &mdash; Chapel Documentation 1.24</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapel Language Specification" href="../language/spec/index.html" />
    <link rel="prev" title="chpldoc" href="chpldoc.doc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.24
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.24";
$pagename = "primers/learnChapelInYMinutes";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Primers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#language-basics">Language Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#iterators">Iterators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#task-parallelism">Task Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#locality">Locality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-parallelism">Data Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#library-utilities">Library Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#numerical-libraries">Numerical Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tools">Tools</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#language-overview">Language Overview</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Learn Chapel in Y Minutes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-printing">Basic printing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#variables">Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#types">Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#constants-and-parameters">Constants and Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l4"><a class="reference internal" href="#operators">Operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tuples">Tuples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#control-flow">Control Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ranges-and-domains">Ranges and Domains</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arrays">Arrays</a></li>
<li class="toctree-l4"><a class="reference internal" href="#procedures">Procedures</a></li>
<li class="toctree-l4"><a class="reference internal" href="#intents">Intents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#operator-definitions">Operator Definitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iterators">Iterators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modules">Modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parallelism">Parallelism</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mason-packages.html">Mason Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Primers</a> &raquo;</li>
        
      <li>learnChapelInYMinutes.chpl</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/primers/learnChapelInYMinutes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="learnchapelinyminutes-chpl">
<span id="primers-learnchapelinyminutes"></span><h1>learnChapelInYMinutes.chpl<a class="headerlink" href="#learnchapelinyminutes-chpl" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/chapel-lang/chapel/blob/master/test/release/examples/primers/learnChapelInYMinutes.chpl">View learnChapelInYMinutes.chpl on GitHub</a></p>
<p>Learn Chapel in Y Minutes</p>
<p>This primer will go over basic syntax and concepts in Chapel.</p>
<p>Comments are C-family style</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="c1">// one line comment</span>

   <span class="nx">multi</span><span class="o">-</span><span class="nx">line</span> <span class="nx">comment</span>
</pre></div>
</div>
<div class="section" id="basic-printing">
<h2>Basic printing<a class="headerlink" href="#basic-printing" title="Permalink to this headline">¶</a></h2>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">write</span><span class="p">(</span><span class="s">&quot;Hello, &quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;World!&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">write</span></code> and <code class="docutils literal notranslate"><span class="pre">writeln</span></code> can take a list of things to print.
Each thing is printed right next to the others, so include your spacing!</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;There are &quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot; commas (\&quot;,\&quot;) in this line of code&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Different output channels:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">IO</span><span class="p">;</span> <span class="c1">// Required for accessing the alternative output channels</span>

<span class="nx">stdout</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;This goes to standard output, just like plain writeln() does&quot;</span><span class="p">);</span>
<span class="nx">stderr</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;This goes to standard error&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="variables">
<h2>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h2>
<p>Variables don’t have to be explicitly typed as long as
the compiler can figure out the type that it will hold.
10 is an <code class="docutils literal notranslate"><span class="pre">int</span></code>, so <code class="docutils literal notranslate"><span class="pre">myVar</span></code> is implicitly an <code class="docutils literal notranslate"><span class="pre">int</span></code></p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">myVar</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="nx">myVar</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">mySecondVar</span> <span class="o">=</span> <span class="nx">myVar</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">anError;</span></code> would be a compile-time error.</p>
<p>We can (and should) explicitly type things.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">myThirdVar</span><span class="p">:</span> <span class="kt">real</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">myFourthVar</span><span class="p">:</span> <span class="kt">real</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.234</span><span class="p">;</span>
<span class="nx">myThirdVar</span> <span class="o">=</span> <span class="nx">myFourthVar</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="types">
<h2>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h2>
<p>There are a number of basic types.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">myInt</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span><span class="p">;</span> <span class="c1">// Signed ints</span>
<span class="kd">var</span> <span class="nx">myUint</span><span class="p">:</span> <span class="kt">uint</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">;</span> <span class="c1">// Unsigned ints</span>
<span class="kd">var</span> <span class="nx">myReal</span><span class="p">:</span> <span class="kt">real</span> <span class="o">=</span> <span class="mf">9.876</span><span class="p">;</span> <span class="c1">// Floating point numbers</span>
<span class="kd">var</span> <span class="nx">myImag</span><span class="p">:</span> <span class="kt">imag</span> <span class="o">=</span> <span class="m">5.0i</span><span class="p">;</span> <span class="c1">// Imaginary numbers</span>
<span class="kd">var</span> <span class="nx">myCplx</span><span class="p">:</span> <span class="kt">complex</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="m">9i</span><span class="p">;</span> <span class="c1">// Complex numbers</span>
<span class="nx">myCplx</span> <span class="o">=</span> <span class="nx">myInt</span> <span class="o">+</span> <span class="nx">myImag</span><span class="p">;</span> <span class="c1">// Another way to form complex numbers</span>
<span class="kd">var</span> <span class="nx">myBool</span><span class="p">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// Booleans</span>
<span class="kd">var</span> <span class="nx">myStr</span><span class="p">:</span> <span class="kt">string</span> <span class="o">=</span> <span class="s">&quot;Some string...&quot;</span><span class="p">;</span> <span class="c1">// Strings</span>
<span class="kd">var</span> <span class="nx">singleQuoteStr</span> <span class="o">=</span> <span class="s">&#39;Another string...&#39;</span><span class="p">;</span> <span class="c1">// String literal with single quotes</span>
</pre></div>
</div>
<p>Some types can have sizes.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">my8Int</span><span class="p">:</span> <span class="kt">int</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// 8 bit (one byte) sized int;</span>
<span class="kd">var</span> <span class="nx">my64Real</span><span class="p">:</span> <span class="kt">real</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.516</span><span class="p">;</span> <span class="c1">// 64 bit (8 bytes) sized real</span>
</pre></div>
</div>
<p>Typecasting.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">intFromReal</span> <span class="o">=</span> <span class="nx">myReal</span> <span class="p">:</span> <span class="kt">int</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">intFromReal2</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="nx">myReal</span> <span class="p">:</span> <span class="kt">int</span><span class="p">;</span>
</pre></div>
</div>
<p>Type aliasing.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">chroma</span> <span class="o">=</span> <span class="kt">int</span><span class="p">;</span>        <span class="c1">// Type of a single hue</span>
<span class="kd">type</span> <span class="nx">RGBColor</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="nx">chroma</span><span class="p">;</span> <span class="c1">// Type representing a full color</span>
<span class="kd">var</span> <span class="nx">black</span><span class="p">:</span> <span class="nx">RGBColor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">white</span><span class="p">:</span> <span class="nx">RGBColor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="constants-and-parameters">
<h2>Constants and Parameters<a class="headerlink" href="#constants-and-parameters" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">const</span></code> is a constant, and cannot be changed after set in runtime.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">almostPi</span><span class="p">:</span> <span class="kt">real</span> <span class="o">=</span> <span class="mf">22.0</span><span class="o">/</span><span class="mf">7.0</span><span class="p">;</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">param</span></code> is a constant whose value must be known statically at
compile-time.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">param</span> <span class="nx">compileTimeConst</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">config</span></code> modifier allows values to be set at the command line.
Set with <code class="docutils literal notranslate"><span class="pre">--varCmdLineArg=Value</span></code> or <code class="docutils literal notranslate"><span class="pre">--varCmdLineArg</span> <span class="pre">Value</span></code> at runtime.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">config</span> <span class="kd">var</span> <span class="nx">varCmdLineArg</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">123</span><span class="p">;</span>
<span class="kd">config</span> <span class="kd">const</span> <span class="nx">constCmdLineArg</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">777</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">config</span> <span class="pre">param</span></code> can be set at compile-time.
Set with <code class="docutils literal notranslate"><span class="pre">--set</span> <span class="pre">paramCmdLineArg=value</span></code> at compile-time.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">config</span> <span class="kd">param</span> <span class="nx">paramCmdLineArg</span><span class="p">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">varCmdLineArg</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">,</span> <span class="nx">constCmdLineArg</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">,</span> <span class="nx">paramCmdLineArg</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ref</span></code> operates much like a reference in C++. In Chapel, a <code class="docutils literal notranslate"><span class="pre">ref</span></code> cannot
be made to alias a variable other than the variable it is initialized with.
Here, <code class="docutils literal notranslate"><span class="pre">refToActual</span></code> refers to <code class="docutils literal notranslate"><span class="pre">actual</span></code>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">actual</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kd">ref</span> <span class="nx">refToActual</span> <span class="o">=</span> <span class="nx">actual</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="s">&quot; == &quot;</span><span class="p">,</span> <span class="nx">refToActual</span><span class="p">);</span> <span class="c1">// prints the same value</span>
<span class="nx">actual</span> <span class="o">=</span> <span class="o">-</span><span class="mi">123</span><span class="p">;</span> <span class="c1">// modify actual (which refToActual refers to)</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="s">&quot; == &quot;</span><span class="p">,</span> <span class="nx">refToActual</span><span class="p">);</span> <span class="c1">// prints the same value</span>
<span class="nx">refToActual</span> <span class="o">=</span> <span class="mi">99999999</span><span class="p">;</span> <span class="c1">// modify what refToActual refers to (which is actual)</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="s">&quot; == &quot;</span><span class="p">,</span> <span class="nx">refToActual</span><span class="p">);</span> <span class="c1">// prints the same value</span>
</pre></div>
</div>
</div>
<div class="section" id="operators">
<h2>Operators<a class="headerlink" href="#operators" title="Permalink to this headline">¶</a></h2>
<p>Math operators:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">a</span><span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">thisInt</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">,</span> <span class="nx">thatInt</span> <span class="o">=</span> <span class="mi">5678</span><span class="p">;</span>
<span class="nx">a</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">+</span> <span class="nx">thatInt</span><span class="p">;</span>  <span class="c1">// Addition</span>
<span class="nx">a</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">*</span> <span class="nx">thatInt</span><span class="p">;</span>  <span class="c1">// Multiplication</span>
<span class="nx">a</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">-</span> <span class="nx">thatInt</span><span class="p">;</span>  <span class="c1">// Subtraction</span>
<span class="nx">a</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">/</span> <span class="nx">thatInt</span><span class="p">;</span>  <span class="c1">// Division</span>
<span class="nx">a</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">**</span> <span class="nx">thatInt</span><span class="p">;</span> <span class="c1">// Exponentiation</span>
<span class="nx">a</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">%</span> <span class="nx">thatInt</span><span class="p">;</span>  <span class="c1">// Remainder (modulo)</span>
</pre></div>
</div>
<p>Logical operators:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">b</span><span class="p">:</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">thisBool</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">thatBool</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">b</span> <span class="o">=</span> <span class="nx">thisBool</span> <span class="o">&amp;&amp;</span> <span class="nx">thatBool</span><span class="p">;</span> <span class="c1">// Logical and</span>
<span class="nx">b</span> <span class="o">=</span> <span class="nx">thisBool</span> <span class="o">||</span> <span class="nx">thatBool</span><span class="p">;</span> <span class="c1">// Logical or</span>
<span class="nx">b</span> <span class="o">=</span> <span class="o">!</span><span class="nx">thisBool</span><span class="p">;</span>            <span class="c1">// Logical negation</span>
</pre></div>
</div>
<p>Relational operators:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">b</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">&gt;</span> <span class="nx">thatInt</span><span class="p">;</span>           <span class="c1">// Greater-than</span>
<span class="nx">b</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">&gt;=</span> <span class="nx">thatInt</span><span class="p">;</span>          <span class="c1">// Greater-than-or-equal-to</span>
<span class="nx">b</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">&lt;</span> <span class="nx">a</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span> <span class="o">&lt;=</span> <span class="nx">thatInt</span><span class="p">;</span> <span class="c1">// Less-than, and, less-than-or-equal-to</span>
<span class="nx">b</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">!=</span> <span class="nx">thatInt</span><span class="p">;</span>          <span class="c1">// Not-equal-to</span>
<span class="nx">b</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">==</span> <span class="nx">thatInt</span><span class="p">;</span>          <span class="c1">// Equal-to</span>
</pre></div>
</div>
<p>Bitwise operators:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">a</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">;</span>     <span class="c1">// Left-bit-shift by 10 bits;</span>
<span class="nx">a</span> <span class="o">=</span> <span class="nx">thatInt</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">;</span>      <span class="c1">// Right-bit-shift by 5 bits;</span>
<span class="nx">a</span> <span class="o">=</span> <span class="o">~</span><span class="nx">thisInt</span><span class="p">;</span>          <span class="c1">// Bitwise-negation</span>
<span class="nx">a</span> <span class="o">=</span> <span class="nx">thisInt</span> <span class="o">^</span> <span class="nx">thatInt</span><span class="p">;</span> <span class="c1">// Bitwise exclusive-or</span>
</pre></div>
</div>
<p>Compound assignment operators:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">a</span> <span class="o">+=</span> <span class="nx">thisInt</span><span class="p">;</span>          <span class="c1">// Addition-equals (a = a + thisInt;)</span>
<span class="nx">a</span> <span class="o">*=</span> <span class="nx">thatInt</span><span class="p">;</span>          <span class="c1">// Times-equals (a = a * thatInt;)</span>
<span class="nx">b</span> <span class="o">&amp;&amp;=</span> <span class="nx">thatBool</span><span class="p">;</span>        <span class="c1">// Logical-and-equals (b = b &amp;&amp; thatBool;)</span>
<span class="nx">a</span> <span class="o">&lt;&lt;=</span> <span class="mi">3</span><span class="p">;</span>               <span class="c1">// Left-bit-shift-equals (a = a &lt;&lt; 10;)</span>
</pre></div>
</div>
<p>Unlike other C family languages, there are no
pre/post-increment/decrement operators, such as:</p>
<p><code class="docutils literal notranslate"><span class="pre">++j</span></code>, <code class="docutils literal notranslate"><span class="pre">--j</span></code>, <code class="docutils literal notranslate"><span class="pre">j++</span></code>, <code class="docutils literal notranslate"><span class="pre">j--</span></code></p>
<p>Swap operator:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">old_this</span> <span class="o">=</span> <span class="nx">thisInt</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">old_that</span> <span class="o">=</span> <span class="nx">thatInt</span><span class="p">;</span>
<span class="nx">thisInt</span> <span class="o">&lt;=&gt;</span> <span class="nx">thatInt</span><span class="p">;</span> <span class="c1">// Swap the values of thisInt and thatInt</span>
<span class="nx">writeln</span><span class="p">((</span><span class="nx">old_this</span> <span class="o">==</span> <span class="nx">thatInt</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">old_that</span> <span class="o">==</span> <span class="nx">thisInt</span><span class="p">));</span>
</pre></div>
</div>
<p>Operator overloads can also be defined, as we’ll see with procedures.</p>
</div>
<div class="section" id="tuples">
<h2>Tuples<a class="headerlink" href="#tuples" title="Permalink to this headline">¶</a></h2>
<p>Tuples can be of the same type or different types.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">sameTup</span><span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="kt">int</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sameTup2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">diffTup</span><span class="p">:</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">real</span><span class="p">,</span><span class="kt">complex</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.928</span><span class="p">,</span> <span class="nx">myCplx</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">diffTupe2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">5.64</span><span class="p">,</span> <span class="mf">6.0</span><span class="o">+</span><span class="m">1.5i</span><span class="p">);</span>
</pre></div>
</div>
<p>Tuples can be accessed using square brackets or parentheses, and are
0-indexed.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">,</span> <span class="nx">sameTup</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;,&quot;</span><span class="p">,</span> <span class="nx">sameTup</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">diffTup</span><span class="p">);</span>
</pre></div>
</div>
<p>Tuples can also be written into.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">diffTup</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>Tuple values can be expanded into their own variables.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="p">(</span><span class="nx">tupInt</span><span class="p">,</span> <span class="nx">tupReal</span><span class="p">,</span> <span class="nx">tupCplx</span><span class="p">)</span> <span class="o">=</span> <span class="nx">diffTup</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">diffTup</span> <span class="o">==</span> <span class="p">(</span><span class="nx">tupInt</span><span class="p">,</span> <span class="nx">tupReal</span><span class="p">,</span> <span class="nx">tupCplx</span><span class="p">));</span>
</pre></div>
</div>
<p>They are also useful for writing a list of variables, as is common in debugging.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">thisInt</span><span class="p">,</span><span class="nx">thatInt</span><span class="p">,</span><span class="nx">thisBool</span><span class="p">,</span><span class="nx">thatBool</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="control-flow">
<h2>Control Flow<a class="headerlink" href="#control-flow" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code> - <code class="docutils literal notranslate"><span class="pre">then</span></code> - <code class="docutils literal notranslate"><span class="pre">else</span></code> works just like any other C-family language.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="mi">10</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="k">then</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;All is well&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">then</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Continuing to believe reality&quot;</span><span class="p">);</span>
<span class="k">else</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Send mathematician, something&#39;s wrong&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>You can use parentheses if you prefer.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="mi">10</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Universe broken. Please reboot universe.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="nx">a</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="s">&quot; is even.&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="s">&quot; is odd.&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="nx">a</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="s">&quot; is even divisible by 3.&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="s">&quot; is divided by 3 with a remainder of 1.&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="s">&quot; is divided by 3 with a remainder of 2.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ternary: <code class="docutils literal notranslate"><span class="pre">if</span></code> - <code class="docutils literal notranslate"><span class="pre">then</span></code> - <code class="docutils literal notranslate"><span class="pre">else</span></code> in a statement.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">maximum</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">thisInt</span> <span class="o">&lt;</span> <span class="nx">thatInt</span> <span class="k">then</span> <span class="nx">thatInt</span> <span class="k">else</span> <span class="nx">thisInt</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code> statements are much like switch statements in other languages.
However, <code class="docutils literal notranslate"><span class="pre">select</span></code> statements don’t cascade like in C or Java.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">inputOption</span> <span class="o">=</span> <span class="s">&quot;anOption&quot;</span><span class="p">;</span>
<span class="k">select</span> <span class="nx">inputOption</span> <span class="p">{</span>
  <span class="k">when</span> <span class="s">&quot;anOption&quot;</span> <span class="k">do</span> <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Chose &#39;anOption&#39;&quot;</span><span class="p">);</span>
  <span class="k">when</span> <span class="s">&quot;otherOption&quot;</span> <span class="p">{</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Chose &#39;otherOption&#39;&quot;</span><span class="p">);</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Which has a body&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">otherwise</span> <span class="p">{</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Any other Input&quot;</span><span class="p">);</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;the otherwise case doesn&#39;t need a do if the body is one line&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">while</span></code> and <code class="docutils literal notranslate"><span class="pre">do</span></code>-<code class="docutils literal notranslate"><span class="pre">while</span></code> loops also behave like their C counterparts.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">j</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">jSum</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="nx">j</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">jSum</span> <span class="o">+=</span> <span class="nx">j</span><span class="p">;</span>
  <span class="nx">j</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">jSum</span><span class="p">);</span>

<span class="k">do</span> <span class="p">{</span>
  <span class="nx">jSum</span> <span class="o">+=</span> <span class="nx">j</span><span class="p">;</span>
  <span class="nx">j</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">j</span> <span class="o">&lt;=</span> <span class="mi">10000</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">jSum</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">for</span></code> loops are much like those in python in that they iterate over a
range. Ranges (like the <code class="docutils literal notranslate"><span class="pre">1..10</span></code> expression below) are a first-class object
in Chapel, and as such can be stored in variables.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="k">do</span> <span class="nx">write</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">iSum</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">1000</span> <span class="p">{</span>
  <span class="nx">iSum</span> <span class="o">+=</span> <span class="nx">i</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">iSum</span><span class="p">);</span>

<span class="k">for</span> <span class="nx">x</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">y</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="p">{</span>
    <span class="nx">write</span><span class="p">((</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">),</span> <span class="s">&quot;\t&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">writeln</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ranges-and-domains">
<h2>Ranges and Domains<a class="headerlink" href="#ranges-and-domains" title="Permalink to this headline">¶</a></h2>
<p>For-loops and arrays both use ranges and domains to define an index set that
can be iterated over. Ranges are single dimensional integer indices, while
domains can be multi-dimensional and represent indices of different types.</p>
<p>They are first-class citizen types, and can be assigned into variables.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">range1to10</span><span class="p">:</span> <span class="kt">range</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span>  <span class="c1">// 1, 2, 3, ..., 10</span>
<span class="kd">var</span> <span class="nx">range2to11</span> <span class="o">=</span> <span class="mi">2</span><span class="o">..</span><span class="mi">11</span><span class="p">;</span> <span class="c1">// 2, 3, 4, ..., 11</span>
<span class="kd">var</span> <span class="nx">rangeThisToThat</span><span class="p">:</span> <span class="kt">range</span> <span class="o">=</span> <span class="nx">thisInt</span><span class="o">..</span><span class="nx">thatInt</span><span class="p">;</span> <span class="c1">// using variables</span>
<span class="kd">var</span> <span class="nx">rangeEmpty</span><span class="p">:</span> <span class="kt">range</span> <span class="o">=</span> <span class="mi">100</span><span class="o">..-</span><span class="mi">100</span><span class="p">;</span> <span class="c1">// this is valid but contains no indices</span>
</pre></div>
</div>
<p>Ranges can be unbounded.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">range1toInf</span><span class="p">:</span> <span class="kt">range</span><span class="p">(</span><span class="nx">boundedType</span><span class="o">=</span><span class="nx">BoundedRangeType</span><span class="p">.</span><span class="nx">boundedLow</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span> <span class="p">;</span> <span class="c1">// 1, 2, 3, 4, 5, ...</span>
<span class="kd">var</span> <span class="nx">rangeNegInfTo1</span> <span class="o">=</span> <span class="o">..</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// ..., -4, -3, -2, -1, 0, 1</span>
</pre></div>
</div>
<p>Ranges can be strided (and reversed) using the <code class="docutils literal notranslate"><span class="pre">by</span></code> operator.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">range2to10by2</span><span class="p">:</span> <span class="kt">range</span><span class="p">(</span><span class="nx">stridable</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="o">..</span><span class="mi">10</span> <span class="k">by</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// 2, 4, 6, 8, 10</span>
<span class="kd">var</span> <span class="nx">reverse2to10by2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">..</span><span class="mi">10</span> <span class="k">by</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// 10, 8, 6, 4, 2</span>

<span class="kd">var</span> <span class="nx">trapRange</span> <span class="o">=</span> <span class="mi">10</span><span class="o">..</span><span class="mi">1</span> <span class="k">by</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// Do not be fooled, this is still an empty range</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Size of range &#39;&quot;</span><span class="p">,</span> <span class="nx">trapRange</span><span class="p">,</span> <span class="s">&quot;&#39; = &quot;</span><span class="p">,</span> <span class="nx">trapRange</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
</pre></div>
</div>
<p>Note: <code class="docutils literal notranslate"><span class="pre">range(boundedType=</span> <span class="pre">...)</span></code> and <code class="docutils literal notranslate"><span class="pre">range(stridable=</span> <span class="pre">...)</span></code> are only
necessary if we explicitly type the variable.</p>
<p>The end point of a range can be computed by specifying the total size
of the range using the count (<code class="docutils literal notranslate"><span class="pre">#</span></code>) operator.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">rangeCount</span><span class="p">:</span> <span class="kt">range</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="o">..#</span><span class="mi">12</span><span class="p">;</span> <span class="c1">// range from -5 to 6</span>
</pre></div>
</div>
<p>Operators can be mixed.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">rangeCountBy</span><span class="p">:</span> <span class="kt">range</span><span class="p">(</span><span class="nx">stridable</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="o">..#</span><span class="mi">12</span> <span class="k">by</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// -5, -3, -1, 1, 3, 5</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">rangeCountBy</span><span class="p">);</span>
</pre></div>
</div>
<p>Properties of the range can be queried.
In this example, printing the first index, last index, number of indices,
stride, and if 2 is include in the range.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">((</span><span class="nx">rangeCountBy</span><span class="p">.</span><span class="nx">first</span><span class="p">,</span> <span class="nx">rangeCountBy</span><span class="p">.</span><span class="nx">last</span><span class="p">,</span> <span class="nx">rangeCountBy</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span>
           <span class="nx">rangeCountBy</span><span class="p">.</span><span class="nx">stride</span><span class="p">,</span> <span class="nx">rangeCountBy</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="mi">2</span><span class="p">)));</span>

<span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">rangeCountBy</span> <span class="p">{</span>
  <span class="nx">write</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="k">if</span> <span class="nx">i</span> <span class="o">==</span> <span class="nx">rangeCountBy</span><span class="p">.</span><span class="nx">last</span> <span class="k">then</span> <span class="s">&quot;\n&quot;</span> <span class="k">else</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Rectangular domains are defined using the same range syntax,
but they are required to be bounded (unlike ranges).</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">domain1to10</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">};</span>        <span class="c1">// 1D domain from 1..10;</span>
<span class="kd">var</span> <span class="nx">twoDimensions</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">2</span><span class="o">..</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="p">};</span> <span class="c1">// 2D domain over product of ranges</span>
<span class="kd">var</span> <span class="nx">thirdDim</span><span class="p">:</span> <span class="kt">range</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">16</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">threeDims</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span><span class="nx">thirdDim</span><span class="p">,</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="o">..</span><span class="mi">10</span><span class="p">};</span> <span class="c1">// using a range variable</span>
</pre></div>
</div>
<p>Domains can also be resized</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">resizedDom</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">};</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;before, resizedDom = &quot;</span><span class="p">,</span> <span class="nx">resizedDom</span><span class="p">);</span>
<span class="nx">resizedDom</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">10</span><span class="o">..#</span><span class="mi">10</span><span class="p">};</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;after, resizedDom = &quot;</span><span class="p">,</span> <span class="nx">resizedDom</span><span class="p">);</span>
</pre></div>
</div>
<p>Indices can be iterated over as tuples.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">idx</span> <span class="kd">in</span> <span class="nx">twoDimensions</span> <span class="k">do</span>
  <span class="nx">write</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>These tuples can also be destructured.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="kd">in</span> <span class="nx">twoDimensions</span> <span class="p">{</span>
  <span class="nx">write</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="s">&quot;)&quot;</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Associative domains act like sets.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">stringSet</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="kt">string</span><span class="p">);</span> <span class="c1">// empty set of strings</span>
<span class="nx">stringSet</span> <span class="o">+=</span> <span class="s">&quot;a&quot;</span><span class="p">;</span>
<span class="nx">stringSet</span> <span class="o">+=</span> <span class="s">&quot;b&quot;</span><span class="p">;</span>
<span class="nx">stringSet</span> <span class="o">+=</span> <span class="s">&quot;c&quot;</span><span class="p">;</span>
<span class="nx">stringSet</span> <span class="o">+=</span> <span class="s">&quot;a&quot;</span><span class="p">;</span> <span class="c1">// Redundant add &quot;a&quot;</span>
<span class="nx">stringSet</span> <span class="o">-=</span> <span class="s">&quot;c&quot;</span><span class="p">;</span> <span class="c1">// Remove &quot;c&quot;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">stringSet</span><span class="p">.</span><span class="nx">sorted</span><span class="p">());</span>
</pre></div>
</div>
<p>Associative domains can also have a literal syntax</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">intSet</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">};</span>
</pre></div>
</div>
<p>Both ranges and domains can be sliced to produce a range or domain with the
intersection of indices.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">rangeA</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span> <span class="p">;</span> <span class="c1">// range from 1 to infinity</span>
<span class="kd">var</span> <span class="nx">rangeB</span> <span class="o">=</span>  <span class="o">..</span><span class="mi">5</span><span class="p">;</span> <span class="c1">// range from negative infinity to 5</span>
<span class="kd">var</span> <span class="nx">rangeC</span> <span class="o">=</span> <span class="nx">rangeA</span><span class="p">[</span><span class="nx">rangeB</span><span class="p">];</span> <span class="c1">// resulting range is 1..5</span>
<span class="nx">writeln</span><span class="p">((</span><span class="nx">rangeA</span><span class="p">,</span> <span class="nx">rangeB</span><span class="p">,</span> <span class="nx">rangeC</span><span class="p">));</span>

<span class="kd">var</span> <span class="nx">domainA</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="o">..</span><span class="mi">20</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">domainB</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">5</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">domainC</span> <span class="o">=</span> <span class="nx">domainA</span><span class="p">[</span><span class="nx">domainB</span><span class="p">];</span>
<span class="nx">writeln</span><span class="p">((</span><span class="nx">domainA</span><span class="p">,</span> <span class="nx">domainB</span><span class="p">,</span> <span class="nx">domainC</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="arrays">
<h2>Arrays<a class="headerlink" href="#arrays" title="Permalink to this headline">¶</a></h2>
<p>Arrays are similar to those of other languages.
Their sizes are defined using domains that represent their indices.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">intArray</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">intArray2</span><span class="p">:</span> <span class="p">[{</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">}]</span> <span class="kt">int</span><span class="p">;</span> <span class="c1">// equivalent</span>
</pre></div>
</div>
<p>They can be accessed using either brackets or parentheses</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="k">do</span>
  <span class="nx">intArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="nx">i</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">intArray</span><span class="p">);</span>
</pre></div>
</div>
<p>We cannot access <code class="docutils literal notranslate"><span class="pre">intArray[0]</span></code> because it exists outside
of the index set, <code class="docutils literal notranslate"><span class="pre">{1..10}</span></code>, we defined it to have.
<code class="docutils literal notranslate"><span class="pre">intArray[11]</span></code> is illegal for the same reason.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">realDomain</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">7</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">realArray</span><span class="p">:</span> <span class="p">[</span><span class="nx">realDomain</span><span class="p">]</span> <span class="kt">real</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">realArray2</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">7</span><span class="p">]</span> <span class="kt">real</span><span class="p">;</span>   <span class="c1">// equivalent</span>
<span class="kd">var</span> <span class="nx">realArray3</span><span class="p">:</span> <span class="p">[{</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">7</span><span class="p">}]</span> <span class="kt">real</span><span class="p">;</span> <span class="c1">// equivalent</span>

<span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">5</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">(</span><span class="nx">rows</span><span class="p">,</span><span class="nx">cols</span><span class="p">)</span> <span class="o">=</span> <span class="nx">realDomain</span><span class="p">.</span><span class="nx">dims</span><span class="p">();</span>
  <span class="k">for</span> <span class="nx">j</span> <span class="kd">in</span> <span class="nx">cols</span> <span class="p">{</span>   <span class="c1">// Only use the &quot;column&quot; dimension of the domain</span>
    <span class="nx">realArray</span><span class="p">[</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.61803</span> <span class="o">*</span> <span class="nx">i</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nx">j</span><span class="p">;</span>  <span class="c1">// Access using index list</span>
    <span class="kd">var</span> <span class="nx">idx</span><span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="kt">int</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">);</span>                   <span class="c1">// Note: &#39;index&#39; is a keyword</span>
    <span class="nx">realArray</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="nx">realArray</span><span class="p">[(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)];</span>      <span class="c1">// Index using tuples</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Arrays have domains as members, and can be iterated over as normal.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">idx</span> <span class="kd">in</span> <span class="nx">realArray</span><span class="p">.</span><span class="k">domain</span> <span class="p">{</span>  <span class="c1">// Again, idx is a 2*int tuple</span>
  <span class="nx">realArray</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">realArray</span><span class="p">[</span><span class="nx">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span> <span class="c1">// Access by tuple and list</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">(</span><span class="nx">realArray</span><span class="p">);</span>
</pre></div>
</div>
<p>The values of an array can also be iterated directly.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">rSum</span><span class="p">:</span> <span class="kt">real</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="nx">value</span> <span class="kd">in</span> <span class="nx">realArray</span> <span class="p">{</span>
  <span class="nx">rSum</span> <span class="o">+=</span> <span class="nx">value</span><span class="p">;</span> <span class="c1">// Read a value</span>
  <span class="nx">value</span> <span class="o">=</span> <span class="nx">rSum</span><span class="p">;</span>  <span class="c1">// Write a value</span>
<span class="p">}</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">rSum</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="nx">realArray</span><span class="p">);</span>
</pre></div>
</div>
<p>Associative arrays (dictionaries) can be created using associative domains.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">dictDomain</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;one&quot;</span><span class="p">,</span> <span class="s">&quot;two&quot;</span><span class="p">,</span> <span class="s">&quot;three&quot;</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">dict</span><span class="p">:</span> <span class="p">[</span><span class="nx">dictDomain</span><span class="p">]</span> <span class="kt">int</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;one&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;two&quot;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;three&quot;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">];</span>

<span class="k">for</span> <span class="nx">key</span> <span class="kd">in</span> <span class="nx">dictDomain</span><span class="p">.</span><span class="nx">sorted</span><span class="p">()</span> <span class="k">do</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
</pre></div>
</div>
<p>Arrays can be assigned to each other in a few different ways.
These arrays will be used in the example.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">thisArray</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span> <span class="kt">int</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">thatArray</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>
</pre></div>
</div>
<p>First, simply assign one to the other. This copies <code class="docutils literal notranslate"><span class="pre">thisArray</span></code> into
<code class="docutils literal notranslate"><span class="pre">thatArray</span></code>, instead of just creating a reference. Therefore, modifying
<code class="docutils literal notranslate"><span class="pre">thisArray</span></code> does not also modify <code class="docutils literal notranslate"><span class="pre">thatArray</span></code>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">thatArray</span> <span class="o">=</span> <span class="nx">thisArray</span><span class="p">;</span>
<span class="nx">thatArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">((</span><span class="nx">thisArray</span><span class="p">,</span> <span class="nx">thatArray</span><span class="p">));</span>
</pre></div>
</div>
<p>Assign a slice from one array to a slice (of the same size) in the other.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">thatArray</span><span class="p">[</span><span class="mi">4</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nx">thisArray</span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">2</span><span class="p">];</span>
<span class="nx">writeln</span><span class="p">((</span><span class="nx">thisArray</span><span class="p">,</span> <span class="nx">thatArray</span><span class="p">));</span>
</pre></div>
</div>
<p>Operations can also be promoted to work on arrays. ‘thisPlusThat’ is also
an array.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">thisPlusThat</span> <span class="o">=</span> <span class="nx">thisArray</span> <span class="o">+</span> <span class="nx">thatArray</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">thisPlusThat</span><span class="p">);</span>
</pre></div>
</div>
<p>Moving on, arrays and loops can also be expressions, where the loop
body’s expression is the result of each iteration.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">arrayFromLoop</span> <span class="o">=</span> <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="k">do</span> <span class="nx">i</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">arrayFromLoop</span><span class="p">);</span>
</pre></div>
</div>
<p>An expression can result in nothing, such as when filtering with an if-expression.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">evensOrFives</span> <span class="o">=</span> <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="k">do</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="nx">i</span><span class="p">;</span>

<span class="nx">writeln</span><span class="p">(</span><span class="nx">arrayFromLoop</span><span class="p">);</span>
</pre></div>
</div>
<p>Array expressions can also be written with a bracket notation.
Note: this syntax uses the <code class="docutils literal notranslate"><span class="pre">forall</span></code> parallel concept discussed later.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">evensOrFivesAgain</span> <span class="o">=</span> <span class="p">[</span><span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="nx">i</span><span class="p">;</span>
</pre></div>
</div>
<p>They can also be written over the values of the array.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">arrayFromLoop</span> <span class="o">=</span> <span class="p">[</span><span class="nx">value</span> <span class="kd">in</span> <span class="nx">arrayFromLoop</span><span class="p">]</span> <span class="nx">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="procedures">
<h2>Procedures<a class="headerlink" href="#procedures" title="Permalink to this headline">¶</a></h2>
<p>Chapel procedures have similar syntax functions in other languages.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nx">n</span> <span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">:</span> <span class="kt">int</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">n</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">n</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">fibonacci</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">fibonacci</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Input parameters can be untyped to create a generic procedure.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">doublePrint</span><span class="p">(</span><span class="nx">thing</span><span class="p">):</span> <span class="kt">void</span> <span class="p">{</span>
  <span class="nx">write</span><span class="p">(</span><span class="nx">thing</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nx">thing</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The return type can be inferred, as long as the compiler can figure it out.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">addThree</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">n</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">doublePrint</span><span class="p">(</span><span class="nx">addThree</span><span class="p">(</span><span class="nx">fibonacci</span><span class="p">(</span><span class="mi">20</span><span class="p">)));</span>
</pre></div>
</div>
<p>It is also possible to take a variable number of parameters.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">maxOf</span><span class="p">(</span><span class="nx">x</span><span class="p">:?</span><span class="nx">t</span> <span class="o">..</span><span class="p">.?</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// x refers to a tuple of one type, t, with k elements</span>
  <span class="kd">var</span> <span class="nx">maximum</span> <span class="o">=</span> <span class="nx">min</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">x</span><span class="p">.</span><span class="nx">indices</span> <span class="k">do</span> <span class="nx">maximum</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">maximum</span> <span class="o">&lt;</span> <span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">then</span> <span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">else</span> <span class="nx">maximum</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">maximum</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">maxOf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="o">-</span><span class="mi">9071982</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">20001</span><span class="p">,</span> <span class="mi">42</span><span class="p">));</span>
</pre></div>
</div>
<p>Procedures can have default parameter values, and
the parameters can be named in the call, even out of order.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">defaultsProc</span><span class="p">(</span><span class="nx">x</span><span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">y</span><span class="p">:</span> <span class="kt">real</span> <span class="o">=</span> <span class="mf">1.2634</span><span class="p">):</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">real</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">(</span><span class="nx">defaultsProc</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">defaultsProc</span><span class="p">(</span><span class="nx">x</span><span class="o">=</span><span class="mi">11</span><span class="p">));</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">defaultsProc</span><span class="p">(</span><span class="nx">x</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="nx">y</span><span class="o">=</span><span class="mf">5.432</span><span class="p">));</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">defaultsProc</span><span class="p">(</span><span class="nx">y</span><span class="o">=</span><span class="mf">9.876</span><span class="p">,</span> <span class="nx">x</span><span class="o">=</span><span class="mi">13</span><span class="p">));</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">?</span></code> operator is called the query operator, and is used to take
undetermined values like tuple or array sizes and generic types.
For example, taking arrays as parameters. The query operator is used to
determine the domain of <code class="docutils literal notranslate"><span class="pre">A</span></code>. This is useful for defining the return type,
though it’s not required.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">invertArray</span><span class="p">(</span><span class="nx">A</span><span class="p">:</span> <span class="p">[?</span><span class="nx">D</span><span class="p">]</span> <span class="kt">int</span><span class="p">):</span> <span class="p">[</span><span class="nx">D</span><span class="p">]</span> <span class="kt">int</span><span class="p">{</span>
  <span class="k">for</span> <span class="nx">a</span> <span class="kd">in</span> <span class="nx">A</span> <span class="k">do</span> <span class="nx">a</span> <span class="o">=</span> <span class="o">-</span><span class="nx">a</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">A</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">(</span><span class="nx">invertArray</span><span class="p">(</span><span class="nx">intArray</span><span class="p">));</span>
</pre></div>
</div>
<p>We can query the type of arguments to generic procedures.
Here we define a procedure that takes two arguments of
the same type, yet we don’t define what that type is.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">genericProc</span><span class="p">(</span><span class="nx">arg1</span> <span class="p">:</span> <span class="p">?</span><span class="nx">valueType</span><span class="p">,</span> <span class="nx">arg2</span> <span class="p">:</span> <span class="nx">valueType</span><span class="p">):</span> <span class="kt">void</span> <span class="p">{</span>
  <span class="k">select</span><span class="p">(</span><span class="nx">valueType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="kt">int</span> <span class="k">do</span> <span class="nx">writeln</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="s">&quot; and &quot;</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="s">&quot; are ints&quot;</span><span class="p">);</span>
    <span class="k">when</span> <span class="kt">real</span> <span class="k">do</span> <span class="nx">writeln</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="s">&quot; and &quot;</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="s">&quot; are reals&quot;</span><span class="p">);</span>
    <span class="k">otherwise</span> <span class="nx">writeln</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="s">&quot; and &quot;</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="s">&quot; are somethings!&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">genericProc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="nx">genericProc</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">);</span>
<span class="nx">genericProc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="m">2.0i</span><span class="p">,</span> <span class="mf">3.0</span><span class="o">+</span><span class="m">4.0i</span><span class="p">);</span>
</pre></div>
</div>
<p>We can also enforce a form of polymorphism with the <code class="docutils literal notranslate"><span class="pre">where</span></code> clause
This allows the compiler to decide which function to use.
Note: That means that all information needs to be known at compile-time.
The param modifier on the arg is used to enforce this constraint.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">whereProc</span><span class="p">(</span><span class="kd">param</span> <span class="nx">N</span> <span class="p">:</span> <span class="kt">int</span><span class="p">):</span> <span class="kt">void</span>
 <span class="k">where</span> <span class="p">(</span><span class="nx">N</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;N is greater than 0&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">proc</span> <span class="nf">whereProc</span><span class="p">(</span><span class="kd">param</span> <span class="nx">N</span> <span class="p">:</span> <span class="kt">int</span><span class="p">):</span> <span class="kt">void</span>
 <span class="k">where</span> <span class="p">(</span><span class="nx">N</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;N is less than 0&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">whereProc</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="nx">whereProc</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">whereProc(0)</span></code> would result in a compiler error because there
are no functions that satisfy the <code class="docutils literal notranslate"><span class="pre">where</span></code> clause’s condition.
We could have defined a <code class="docutils literal notranslate"><span class="pre">whereProc</span></code> without a <code class="docutils literal notranslate"><span class="pre">where</span></code> clause
that would then have served as a catch all for all the other cases
(of which there is only one).</p>
<p><code class="docutils literal notranslate"><span class="pre">where</span></code> clauses can also be used to constrain based on argument type.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">whereType</span><span class="p">(</span><span class="nx">x</span><span class="p">:</span> <span class="p">?</span><span class="nx">t</span><span class="p">)</span> <span class="k">where</span> <span class="nx">t</span> <span class="o">==</span> <span class="kt">int</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Inside &#39;int&#39; version of &#39;whereType&#39;: &quot;</span><span class="p">,</span> <span class="nx">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">proc</span> <span class="nf">whereType</span><span class="p">(</span><span class="nx">x</span><span class="p">:</span> <span class="p">?</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Inside general version of &#39;whereType&#39;: &quot;</span><span class="p">,</span> <span class="nx">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">whereType</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="nx">whereType</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="intents">
<h2>Intents<a class="headerlink" href="#intents" title="Permalink to this headline">¶</a></h2>
<p>Intent modifiers on the arguments convey how those arguments are passed to the procedure.</p>
<blockquote>
<div><ul class="simple">
<li><p>in: copy arg in, but not out</p></li>
<li><p>out: copy arg out, but not in</p></li>
<li><p>inout: copy arg in, copy arg out</p></li>
<li><p>ref: pass arg by reference</p></li>
</ul>
</div></blockquote>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">intentsProc</span><span class="p">(</span><span class="kd">in</span> <span class="nx">inarg</span><span class="p">,</span> <span class="kd">out</span> <span class="nx">outarg</span><span class="p">,</span> <span class="kd">inout</span> <span class="nx">inoutarg</span><span class="p">,</span> <span class="kd">ref</span> <span class="nx">refarg</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Inside Before: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">inarg</span><span class="p">,</span> <span class="nx">outarg</span><span class="p">,</span> <span class="nx">inoutarg</span><span class="p">,</span> <span class="nx">refarg</span><span class="p">));</span>
  <span class="nx">inarg</span> <span class="o">=</span> <span class="nx">inarg</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
  <span class="nx">outarg</span> <span class="o">=</span> <span class="nx">outarg</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
  <span class="nx">inoutarg</span> <span class="o">=</span> <span class="nx">inoutarg</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
  <span class="nx">refarg</span> <span class="o">=</span> <span class="nx">refarg</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Inside After: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">inarg</span><span class="p">,</span> <span class="nx">outarg</span><span class="p">,</span> <span class="nx">inoutarg</span><span class="p">,</span> <span class="nx">refarg</span><span class="p">));</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">inVar</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">outVar</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">inoutVar</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">refVar</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Outside Before: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">inVar</span><span class="p">,</span> <span class="nx">outVar</span><span class="p">,</span> <span class="nx">inoutVar</span><span class="p">,</span> <span class="nx">refVar</span><span class="p">));</span>
<span class="nx">intentsProc</span><span class="p">(</span><span class="nx">inVar</span><span class="p">,</span> <span class="nx">outVar</span><span class="p">,</span> <span class="nx">inoutVar</span><span class="p">,</span> <span class="nx">refVar</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Outside After: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">inVar</span><span class="p">,</span> <span class="nx">outVar</span><span class="p">,</span> <span class="nx">inoutVar</span><span class="p">,</span> <span class="nx">refVar</span><span class="p">));</span>
</pre></div>
</div>
<p>Similarly, we can define intents on the return type.
<code class="docutils literal notranslate"><span class="pre">refElement</span></code> returns a reference to an element of array.
This makes more practical sense for class methods where references to
elements in a data-structure are returned via a method or iterator.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">refElement</span><span class="p">(</span><span class="nx">array</span> <span class="p">:</span> <span class="p">[?</span><span class="nx">D</span><span class="p">]</span> <span class="p">?</span><span class="nx">T</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="kd">ref</span> <span class="p">:</span> <span class="nx">T</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">array</span><span class="p">[</span><span class="nx">idx</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">myChangingArray</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span> <span class="kt">int</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">];</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">myChangingArray</span><span class="p">);</span>
<span class="kd">ref</span> <span class="nx">refToElem</span> <span class="o">=</span> <span class="nx">refElement</span><span class="p">(</span><span class="nx">myChangingArray</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// store reference to element in ref variable</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">refToElem</span><span class="p">);</span>
<span class="nx">refToElem</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// modify reference which modifies actual value in array</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">refToElem</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">myChangingArray</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="operator-definitions">
<h2>Operator Definitions<a class="headerlink" href="#operator-definitions" title="Permalink to this headline">¶</a></h2>
<p>Chapel allows for operators to be overloaded.
We can define the unary operators:
<code class="docutils literal notranslate"><span class="pre">+</span> <span class="pre">-</span> <span class="pre">!</span> <span class="pre">~</span></code>
and the binary operators:
<code class="docutils literal notranslate"><span class="pre">+</span> <span class="pre">-</span> <span class="pre">*</span> <span class="pre">/</span> <span class="pre">%</span> <span class="pre">**</span> <span class="pre">==</span> <span class="pre">&lt;=</span> <span class="pre">&gt;=</span> <span class="pre">&lt;</span> <span class="pre">&gt;</span> <span class="pre">&lt;&lt;</span> <span class="pre">&gt;&gt;</span> <span class="pre">&amp;</span> <span class="pre">|</span> <span class="pre">ˆ</span> <span class="pre">by</span></code>
<code class="docutils literal notranslate"><span class="pre">+=</span> <span class="pre">-=</span> <span class="pre">*=</span> <span class="pre">/=</span> <span class="pre">%=</span> <span class="pre">**=</span> <span class="pre">&amp;=</span> <span class="pre">|=</span> <span class="pre">ˆ=</span> <span class="pre">&lt;&lt;=</span> <span class="pre">&gt;&gt;=</span> <span class="pre">&lt;=&gt;</span></code></p>
<p>Boolean exclusive or operator.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">^</span><span class="p">(</span><span class="nx">left</span> <span class="p">:</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">right</span> <span class="p">:</span> <span class="kt">bool</span><span class="p">):</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">left</span> <span class="o">||</span> <span class="nx">right</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">left</span> <span class="o">&amp;&amp;</span> <span class="nx">right</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">(</span><span class="kc">true</span>  <span class="o">^</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="kc">false</span> <span class="o">^</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="kc">true</span>  <span class="o">^</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="kc">false</span> <span class="o">^</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>Define a <code class="docutils literal notranslate"><span class="pre">*</span></code> operator on any two types that returns a tuple of those types.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">*</span><span class="p">(</span><span class="nx">left</span> <span class="p">:</span> <span class="p">?</span><span class="nx">ltype</span><span class="p">,</span> <span class="nx">right</span> <span class="p">:</span> <span class="p">?</span><span class="nx">rtype</span><span class="p">):</span> <span class="p">(</span><span class="nx">ltype</span><span class="p">,</span> <span class="nx">rtype</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;\tIn our &#39;*&#39; overload!&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="s">&quot;a&quot;</span><span class="p">);</span> <span class="c1">// Uses our ``*`` operator.</span>
<span class="nx">writeln</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>   <span class="c1">// Uses the default ``*`` operator.</span>
</pre></div>
</div>
<p>Note: You could break everything if you get careless with your overloads.
This here will break everything. Don’t do it.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">+</span><span class="p">(</span><span class="nx">left</span><span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">right</span><span class="p">:</span> <span class="kt">int</span><span class="p">):</span> <span class="kt">int</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">left</span> <span class="o">-</span> <span class="nx">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="iterators">
<h2>Iterators<a class="headerlink" href="#iterators" title="Permalink to this headline">¶</a></h2>
<p>Iterators are sisters to the procedure, and almost everything about
procedures also applies to iterators. However, instead of returning a single
value, iterators may yield multiple values to a loop.</p>
<p>This is useful when a complicated set or order of iterations is needed, as
it allows the code defining the iterations to be separate from the loop
body.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">iter</span> <span class="nf">oddsThenEvens</span><span class="p">(</span><span class="nx">N</span><span class="p">:</span> <span class="kt">int</span><span class="p">):</span> <span class="kt">int</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="nx">N</span> <span class="k">by</span> <span class="mi">2</span> <span class="k">do</span>
    <span class="k">yield</span> <span class="nx">i</span><span class="p">;</span> <span class="c1">// yield values instead of returning.</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">2</span><span class="o">..</span><span class="nx">N</span> <span class="k">by</span> <span class="mi">2</span> <span class="k">do</span>
    <span class="k">yield</span> <span class="nx">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">oddsThenEvens</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">do</span> <span class="nx">write</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Iterators can also yield conditionally, the result of which can be nothing</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">iter</span> <span class="nf">absolutelyNothing</span><span class="p">(</span><span class="nx">N</span><span class="p">):</span> <span class="kt">int</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="nx">N</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">N</span> <span class="o">&lt;</span> <span class="nx">i</span> <span class="p">{</span> <span class="c1">// Always false</span>
      <span class="k">yield</span> <span class="nx">i</span><span class="p">;</span>     <span class="c1">// Yield statement never happens</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">absolutelyNothing</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Woa there! absolutelyNothing yielded &quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can zipper together two or more iterators (who have the same number
of iterations) using <code class="docutils literal notranslate"><span class="pre">zip()</span></code> to create a single zipped iterator, where each
iteration of the zipped iterator yields a tuple of one value yielded
from each iterator.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="nx">positive</span><span class="p">,</span> <span class="nx">negative</span><span class="p">)</span> <span class="kd">in</span> <span class="k">zip</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="o">..-</span><span class="mi">1</span><span class="p">)</span> <span class="k">do</span>
  <span class="nx">writeln</span><span class="p">((</span><span class="nx">positive</span><span class="p">,</span> <span class="nx">negative</span><span class="p">));</span>
</pre></div>
</div>
<p>Zipper iteration is quite important in the assignment of arrays,
slices of arrays, and array/loop expressions.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">fromThatArray</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">..#</span><span class="mi">5</span><span class="p">]</span> <span class="kt">int</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">toThisArray</span> <span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="o">..#</span><span class="mi">5</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>
</pre></div>
</div>
<p>Some zipper operations implement other operations.
The first statement and the loop are equivalent.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">toThisArray</span> <span class="o">=</span> <span class="nx">fromThatArray</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="kd">in</span> <span class="k">zip</span><span class="p">(</span><span class="nx">toThisArray</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span> <span class="nx">fromThatArray</span><span class="p">.</span><span class="k">domain</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">toThisArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fromThatArray</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These two chunks are also equivalent.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">toThisArray</span> <span class="o">=</span> <span class="p">[</span><span class="nx">j</span> <span class="kd">in</span> <span class="o">-</span><span class="mi">100</span><span class="o">..#</span><span class="mi">5</span><span class="p">]</span> <span class="nx">j</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">toThisArray</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">)</span> <span class="kd">in</span> <span class="k">zip</span><span class="p">(</span><span class="nx">toThisArray</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="o">..#</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">toThisArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">j</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">toThisArray</span><span class="p">);</span>
</pre></div>
</div>
<p>This is very important in understanding why this statement exhibits a runtime error.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">iterArray</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">]</span> <span class="kt">int</span> <span class="o">=</span> <span class="p">[</span><span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="nx">i</span><span class="p">;</span>
</pre></div>
</div>
<p>Even though the domain of the array and the loop-expression are
the same size, the body of the expression can be thought of as an iterator.
Because iterators can yield nothing, that iterator yields a different number
of things than the domain of the array or loop, which is not allowed.</p>
</div>
<div class="section" id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<p>Classes are similar to those in C++ and Java, allocated on the heap.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span> <span class="p">{</span>
</pre></div>
</div>
<p>Member variables</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">memberInt</span> <span class="p">:</span> <span class="kt">int</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">memberBool</span> <span class="p">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div>
</div>
<p>By default, any class that doesn’t define an initializer gets a
compiler-generated initializer, with one argument per field and
the field’s initial value as the argument’s default value.
Alternatively, the user can define initializers manually as shown
in the following commented-out routine:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="c1">// proc init(val : real) {</span>
<span class="c1">//   this.memberInt = ceil(val): int;</span>
<span class="c1">// }</span>
</pre></div>
</div>
<p>Explicitly defined deinitializer.
If we did not write one, we would get the compiler-generated deinitializer,
which has an empty body.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">deinit</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;MyClass deinitializer called &quot;</span><span class="p">,</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">memberInt</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">memberBool</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Class methods.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span>  <span class="k">proc</span> <span class="nf">setMemberInt</span><span class="p">(</span><span class="nx">val</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">memberInt</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">proc</span> <span class="nf">setMemberBool</span><span class="p">(</span><span class="nx">val</span><span class="p">:</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">memberBool</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">proc</span> <span class="nf">getMemberInt</span><span class="p">():</span> <span class="kt">int</span><span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">memberInt</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">proc</span> <span class="nf">getMemberBool</span><span class="p">():</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">memberBool</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="c1">// end MyClass</span>
</pre></div>
</div>
<p>Call compiler-generated initializer, using default value for memberBool.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="kd">var</span> <span class="nx">myObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
      <span class="nx">myObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="nx">memberInt</span> <span class="o">=</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">// Equivalent</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">myObject</span><span class="p">.</span><span class="nx">getMemberInt</span><span class="p">());</span>

  <span class="c1">// Same, but provide a memberBool value explicitly.</span>
  <span class="kd">var</span> <span class="nx">myDiffObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="nx">myDiffObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="nx">memberInt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="nx">memberBool</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">// Equivalent</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">myDiffObject</span><span class="p">);</span>

  <span class="c1">// Similar, but rely on the default value of memberInt, passing in memberBool.</span>
  <span class="kd">var</span> <span class="nx">myThirdObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="nx">memberBool</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">myThirdObject</span><span class="p">);</span>

  <span class="c1">// If the user-defined initializer above had been uncommented, we could</span>
  <span class="c1">// make the following calls:</span>
  <span class="c1">//</span>
</pre></div>
</div>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="c1">// var myOtherObject = new MyClass(1.95);</span>
<span class="c1">//     myOtherObject = new MyClass(val = 1.95);</span>
<span class="c1">// writeln(myOtherObject.getMemberInt());</span>
</pre></div>
</div>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span>  <span class="c1">// We can define an operator on our class as well, but</span>
  <span class="c1">// the definition has to be outside the class definition.</span>
  <span class="k">proc</span> <span class="nf">+</span><span class="p">(</span><span class="nx">A</span> <span class="p">:</span> <span class="nx">MyClass</span><span class="p">,</span> <span class="nx">B</span> <span class="p">:</span> <span class="nx">MyClass</span><span class="p">)</span> <span class="p">:</span> <span class="k">owned</span> <span class="nx">MyClass</span> <span class="p">{</span>
    <span class="k">return</span>
      <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="nx">memberInt</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">getMemberInt</span><span class="p">()</span> <span class="o">+</span> <span class="nx">B</span><span class="p">.</span><span class="nx">getMemberInt</span><span class="p">(),</span>
                  <span class="nx">memberBool</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">getMemberBool</span><span class="p">()</span> <span class="o">||</span> <span class="nx">B</span><span class="p">.</span><span class="nx">getMemberBool</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">plusObject</span> <span class="o">=</span> <span class="nx">myObject</span> <span class="o">+</span> <span class="nx">myDiffObject</span><span class="p">;</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">plusObject</span><span class="p">);</span>

  <span class="c1">// Destruction of an object: calls the deinit() routine and frees its memory.</span>
  <span class="c1">// ``unmanaged`` objects should have ``delete`` called on them.</span>
  <span class="c1">// ``owned`` objects (the default) are destroyed when they go out of scope.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Classes can inherit from one or more parent classes</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyChildClass</span> <span class="p">:</span> <span class="nx">MyClass</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">memberComplex</span><span class="p">:</span> <span class="kt">complex</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here’s an example of generic classes.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GenericClass</span> <span class="p">{</span>
  <span class="kd">type</span> <span class="nx">classType</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">classDomain</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">classArray</span><span class="p">:</span> <span class="p">[</span><span class="nx">classDomain</span><span class="p">]</span> <span class="nx">classType</span><span class="p">;</span>
</pre></div>
</div>
<p>Explicit initializer.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">init</span><span class="p">(</span><span class="kd">type</span> <span class="nx">classType</span><span class="p">,</span> <span class="nx">elements</span> <span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">classType</span> <span class="o">=</span> <span class="nx">classType</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">classDomain</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="nx">elements</span><span class="p">};</span>
  <span class="c1">// all generic and const fields must be initialized in &quot;phase 1&quot; prior</span>
  <span class="c1">// to a call to the superclass initializer.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Copy-style initializer.
Note: We include a type argument whose default is the type of the first
argument.  This lets our initializer copy classes of different
types and cast on the fly.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">init</span><span class="p">(</span><span class="nx">other</span> <span class="p">:</span> <span class="nx">GenericClass</span><span class="p">(?),</span>
          <span class="kd">type</span> <span class="nx">classType</span> <span class="o">=</span> <span class="nx">other</span><span class="p">.</span><span class="nx">classType</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">classType</span> <span class="o">=</span> <span class="nx">classType</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">classDomain</span> <span class="o">=</span> <span class="nx">other</span><span class="p">.</span><span class="nx">classDomain</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">classArray</span> <span class="o">=</span> <span class="k">for</span> <span class="nx">o</span> <span class="kd">in</span> <span class="nx">other</span> <span class="k">do</span> <span class="nx">o</span><span class="p">:</span> <span class="nx">classType</span><span class="p">;</span>  <span class="c1">// copy and cast</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Define bracket notation on a GenericClass
object so it can behave like a normal array
i.e. <code class="docutils literal notranslate"><span class="pre">objVar[i]</span></code> or <code class="docutils literal notranslate"><span class="pre">objVar(i)</span></code></p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">this</span><span class="p">(</span><span class="nx">i</span> <span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">ref</span> <span class="p">:</span> <span class="nx">classType</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">classArray</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Define an implicit iterator for the class
to yield values from the array to a loop
i.e. <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">objVar</span> <span class="pre">do</span> <span class="pre">...</span></code></p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span>  <span class="k">iter</span> <span class="nf">these</span><span class="p">()</span> <span class="kd">ref</span> <span class="p">:</span> <span class="nx">classType</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">classDomain</span> <span class="k">do</span>
      <span class="k">yield</span> <span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="c1">// end GenericClass</span>
</pre></div>
</div>
<p>Allocate an owned instance of our class</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">realList</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GenericClass</span><span class="p">(</span><span class="kt">real</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<p>We can assign to the member array of the object using the bracket
notation that we defined.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">realList</span><span class="p">.</span><span class="nx">classDomain</span> <span class="k">do</span> <span class="nx">realList</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">;</span>
</pre></div>
</div>
<p>We can iterate over the values in our list with the iterator
we defined.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">value</span> <span class="kd">in</span> <span class="nx">realList</span> <span class="k">do</span> <span class="nx">write</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Make a copy of realList using the copy initializer.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">copyList</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GenericClass</span><span class="p">(</span><span class="nx">realList</span><span class="p">);</span>
<span class="k">for</span> <span class="nx">value</span> <span class="kd">in</span> <span class="nx">copyList</span> <span class="k">do</span> <span class="nx">write</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Make a copy of realList and change the type, also using the copy initializer.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">copyNewTypeList</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GenericClass</span><span class="p">(</span><span class="nx">realList</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">for</span> <span class="nx">value</span> <span class="kd">in</span> <span class="nx">copyNewTypeList</span> <span class="k">do</span> <span class="nx">write</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h2>
<p>Modules are Chapel’s way of managing name spaces.
The files containing these modules do not need to be named after the modules
(as in Java), but files implicitly name modules.
For example, this file implicitly names the <code class="docutils literal notranslate"><span class="pre">learnChapelInYMinutes</span></code> module</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">OurModule</span> <span class="p">{</span>
</pre></div>
</div>
<p>We can use modules inside of other modules.
Time is one of the standard modules.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Time</span><span class="p">;</span>
</pre></div>
</div>
<p>We’ll use this procedure in the parallelism section.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">countdown</span><span class="p">(</span><span class="nx">seconds</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="nx">seconds</span> <span class="k">by</span> <span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="nx">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is possible to create arbitrarily deep module nests.
i.e. submodules of OurModule</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span>  <span class="k">module</span> <span class="nc">ChildModule</span> <span class="p">{</span>
    <span class="k">proc</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;ChildModule.foo()&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">module</span> <span class="nc">SiblingModule</span> <span class="p">{</span>
    <span class="k">proc</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;SiblingModule.foo()&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="c1">// end OurModule</span>
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">OurModule</span></code> also uses all the modules it uses.
Since <code class="docutils literal notranslate"><span class="pre">OurModule</span></code> uses <code class="docutils literal notranslate"><span class="pre">Time</span></code>, we also use <code class="docutils literal notranslate"><span class="pre">Time</span></code>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">OurModule</span><span class="p">;</span>
</pre></div>
</div>
<p>At this point we have not used <code class="docutils literal notranslate"><span class="pre">ChildModule</span></code> or <code class="docutils literal notranslate"><span class="pre">SiblingModule</span></code> so
their symbols (i.e. <code class="docutils literal notranslate"><span class="pre">foo</span></code>) are not available to us. However, the module
names are available, and we can explicitly call <code class="docutils literal notranslate"><span class="pre">foo()</span></code> through them.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">SiblingModule</span><span class="p">.</span><span class="nx">foo</span><span class="p">();</span>
<span class="nx">OurModule</span><span class="p">.</span><span class="nx">ChildModule</span><span class="p">.</span><span class="nx">foo</span><span class="p">();</span>
</pre></div>
</div>
<p>Now we use <code class="docutils literal notranslate"><span class="pre">ChildModule</span></code>, enabling unqualified calls.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">ChildModule</span><span class="p">;</span>
<span class="nx">foo</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="parallelism">
<h2>Parallelism<a class="headerlink" href="#parallelism" title="Permalink to this headline">¶</a></h2>
<p>In other languages, parallelism is typically done with
complicated libraries and strange class structure hierarchies.
Chapel has it baked right into the language.</p>
<p>We can declare a main procedure, but all the code above main still gets
executed.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;PARALLELISM START&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">begin</span></code> statement will spin the body of that statement off
into one new task.
A <code class="docutils literal notranslate"><span class="pre">sync</span></code> statement will ensure that the progress of the main
task will not progress until the children have synced back up.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">sync</span> <span class="p">{</span>
  <span class="k">begin</span> <span class="p">{</span> <span class="c1">// Start of new task&#39;s body</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">1000</span> <span class="k">do</span> <span class="nx">a</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Done: &quot;</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
  <span class="p">}</span> <span class="c1">// End of new tasks body</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;spun off a task!&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Back together&quot;</span><span class="p">);</span>

<span class="k">proc</span> <span class="nf">printFibb</span><span class="p">(</span><span class="nx">n</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;fibonacci(&quot;</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="s">&quot;) = &quot;</span><span class="p">,</span> <span class="nx">fibonacci</span><span class="p">(</span><span class="nx">n</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">cobegin</span></code> statement will spin each statement of the body into one new
task. Notice here that the prints from each statement may happen in any
order.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">cobegin</span> <span class="p">{</span>
  <span class="nx">printFibb</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span> <span class="c1">// new task</span>
  <span class="nx">printFibb</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// new task</span>
  <span class="nx">printFibb</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>  <span class="c1">// new task</span>
  <span class="p">{</span>
    <span class="c1">// This is a nested statement body and thus is a single statement</span>
    <span class="c1">// to the parent statement, executed by a single task.</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;this gets&quot;</span><span class="p">);</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;executed as&quot;</span><span class="p">);</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;a whole&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">coforall</span></code> loop will create a new task for EACH iteration.
Again we see that prints happen in any order.
NOTE: <code class="docutils literal notranslate"><span class="pre">coforall</span></code> should be used only for creating tasks!
Using it to iterating over a structure is very a bad idea!</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">num_tasks</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// Number of tasks we want</span>
<span class="k">coforall</span> <span class="nx">taskID</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="nx">num_tasks</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Hello from task# &quot;</span><span class="p">,</span> <span class="nx">taskID</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">forall</span></code> loops are another parallel loop, but only create a smaller number
of tasks, specifically <code class="docutils literal notranslate"><span class="pre">--dataParTasksPerLocale=</span></code> number of tasks.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">forall</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100</span> <span class="p">{</span>
  <span class="nx">write</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Here we see that there are sections that are in order, followed by
a section that would not follow (e.g. 1, 2, 3, 7, 8, 9, 4, 5, 6,).
This is because each task is taking on a chunk of the range 1..10
(1..3, 4..6, or 7..9) doing that chunk serially, but each task happens
in parallel. Your results may depend on your machine and configuration</p>
<p>For both the <code class="docutils literal notranslate"><span class="pre">forall</span></code> and <code class="docutils literal notranslate"><span class="pre">coforall</span></code> loops, the execution of the
parent task will not continue until all the children sync up.</p>
<p><code class="docutils literal notranslate"><span class="pre">forall</span></code> loops are particularly useful for parallel iteration over arrays.
Lets run an experiment to see how much faster a parallel loop is</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Time</span><span class="p">;</span> <span class="c1">// Import the Time module to use Timer objects</span>
<span class="kd">var</span> <span class="nx">timer</span><span class="p">:</span> <span class="nx">Timer</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">myBigArray</span><span class="p">:</span> <span class="p">[{</span><span class="mi">1</span><span class="o">..</span><span class="mi">4000</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="mi">4000</span><span class="p">}]</span> <span class="kt">real</span><span class="p">;</span> <span class="c1">// Large array we will write into</span>
</pre></div>
</div>
<p>Serial Experiment:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">timer</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span> <span class="c1">// Start timer</span>
<span class="k">for</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="kd">in</span> <span class="nx">myBigArray</span><span class="p">.</span><span class="k">domain</span> <span class="p">{</span> <span class="c1">// Serial iteration</span>
  <span class="nx">myBigArray</span><span class="p">[</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">:</span><span class="kt">real</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">y</span><span class="p">:</span><span class="kt">real</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">timer</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span> <span class="c1">// Stop timer</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Serial: &quot;</span><span class="p">,</span> <span class="nx">timer</span><span class="p">.</span><span class="nx">elapsed</span><span class="p">());</span> <span class="c1">// Print elapsed time</span>
<span class="nx">timer</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span> <span class="c1">// Clear timer for parallel loop</span>
</pre></div>
</div>
<p>Parallel Experiment:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">timer</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span> <span class="c1">// start timer</span>
<span class="k">forall</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="kd">in</span> <span class="nx">myBigArray</span><span class="p">.</span><span class="k">domain</span> <span class="p">{</span> <span class="c1">// Parallel iteration</span>
  <span class="nx">myBigArray</span><span class="p">[</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">:</span><span class="kt">real</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">y</span><span class="p">:</span><span class="kt">real</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">timer</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span> <span class="c1">// Stop timer</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Parallel: &quot;</span><span class="p">,</span> <span class="nx">timer</span><span class="p">.</span><span class="nx">elapsed</span><span class="p">());</span> <span class="c1">// Print elapsed time</span>
<span class="nx">timer</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
</pre></div>
</div>
<p>You may have noticed that (depending on how many cores you have)
the parallel loop went faster than the serial loop.</p>
<p>The bracket style loop-expression described
much earlier implicitly uses a <code class="docutils literal notranslate"><span class="pre">forall</span></code> loop.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nx">val</span> <span class="kd">in</span> <span class="nx">myBigArray</span><span class="p">]</span> <span class="nx">val</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">val</span><span class="p">;</span> <span class="c1">// Parallel operation</span>
</pre></div>
</div>
<p>Atomic variables, common to many languages, are ones whose operations
occur uninterrupted. Multiple threads can therefore modify atomic
variables and can know that their values are safe.
Chapel atomic variables can be of type <code class="docutils literal notranslate"><span class="pre">bool</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>,
<code class="docutils literal notranslate"><span class="pre">uint</span></code>, and <code class="docutils literal notranslate"><span class="pre">real</span></code>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">uranium</span><span class="p">:</span> <span class="k">atomic</span> <span class="kt">int</span><span class="p">;</span>
<span class="nx">uranium</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="mi">238</span><span class="p">);</span>      <span class="c1">// atomically write a variable</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">uranium</span><span class="p">.</span><span class="nx">read</span><span class="p">());</span> <span class="c1">// atomically read a variable</span>
</pre></div>
</div>
<p>Atomic operations are described as functions, so you can define your own.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">uranium</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// atomically subtract a variable</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">uranium</span><span class="p">.</span><span class="nx">read</span><span class="p">());</span>

<span class="kd">var</span> <span class="nx">replaceWith</span> <span class="o">=</span> <span class="mi">239</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">was</span> <span class="o">=</span> <span class="nx">uranium</span><span class="p">.</span><span class="nx">exchange</span><span class="p">(</span><span class="nx">replaceWith</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;uranium was &quot;</span><span class="p">,</span> <span class="nx">was</span><span class="p">,</span> <span class="s">&quot; but is now &quot;</span><span class="p">,</span> <span class="nx">replaceWith</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">isEqualTo</span> <span class="o">=</span> <span class="mi">235</span><span class="p">;</span>
<span class="k">if</span> <span class="nx">uranium</span><span class="p">.</span><span class="nx">compareAndSwap</span><span class="p">(</span><span class="nx">isEqualTo</span><span class="p">,</span> <span class="nx">replaceWith</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;uranium was equal to &quot;</span><span class="p">,</span> <span class="nx">isEqualTo</span><span class="p">,</span>
           <span class="s">&quot; so replaced value with &quot;</span><span class="p">,</span> <span class="nx">replaceWith</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;uranium was not equal to &quot;</span><span class="p">,</span> <span class="nx">isEqualTo</span><span class="p">,</span>
           <span class="s">&quot; so value stays the same...  whatever it was&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sync</span> <span class="p">{</span>
  <span class="k">begin</span> <span class="p">{</span> <span class="c1">// Reader task</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Reader: waiting for uranium to be &quot;</span><span class="p">,</span> <span class="nx">isEqualTo</span><span class="p">);</span>
    <span class="nx">uranium</span><span class="p">.</span><span class="nx">waitFor</span><span class="p">(</span><span class="nx">isEqualTo</span><span class="p">);</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Reader: uranium was set (by someone) to &quot;</span><span class="p">,</span> <span class="nx">isEqualTo</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">begin</span> <span class="p">{</span> <span class="c1">// Writer task</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Writer: will set uranium to the value &quot;</span><span class="p">,</span> <span class="nx">isEqualTo</span><span class="p">,</span> <span class="s">&quot; in...&quot;</span><span class="p">);</span>
    <span class="nx">countdown</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="nx">uranium</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">isEqualTo</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sync</span></code> variables have two states: empty and full.
If you read an empty variable or write a full variable, you are waited
until the variable is full or empty again.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">someSyncVar$</span><span class="p">:</span> <span class="k">sync</span> <span class="kt">int</span><span class="p">;</span> <span class="c1">// varName$ is a convention not a law.</span>
<span class="k">sync</span> <span class="p">{</span>
  <span class="k">begin</span> <span class="p">{</span> <span class="c1">// Reader task</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Reader: waiting to read.&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">read_sync</span> <span class="o">=</span> <span class="nx">someSyncVar$</span><span class="p">;</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Reader: value is &quot;</span><span class="p">,</span> <span class="nx">read_sync</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">begin</span> <span class="p">{</span> <span class="c1">// Writer task</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Writer: will write in...&quot;</span><span class="p">);</span>
    <span class="nx">countdown</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="nx">someSyncVar$</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">single</span></code> vars can only be written once. A read on an unwritten <code class="docutils literal notranslate"><span class="pre">single</span></code>
results in a wait, but when the variable has a value it can be read indefinitely.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">someSingleVar$</span><span class="p">:</span> <span class="k">single</span> <span class="kt">int</span><span class="p">;</span> <span class="c1">// varName$ is a convention not a law.</span>
<span class="k">sync</span> <span class="p">{</span>
  <span class="k">begin</span> <span class="p">{</span> <span class="c1">// Reader task</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Reader: waiting to read.&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">5</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">read_single</span> <span class="o">=</span> <span class="nx">someSingleVar$</span><span class="p">;</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Reader: iteration &quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span><span class="s">&quot;, and the value is &quot;</span><span class="p">,</span> <span class="nx">read_single</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">begin</span> <span class="p">{</span> <span class="c1">// Writer task</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Writer: will write in...&quot;</span><span class="p">);</span>
    <span class="nx">countdown</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="nx">someSingleVar$</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// first and only write ever.</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here’s an example using atomics and a <code class="docutils literal notranslate"><span class="pre">sync</span></code> variable to create a
count-down mutex (also known as a multiplexer).</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">count</span><span class="p">:</span> <span class="k">atomic</span> <span class="kt">int</span><span class="p">;</span> <span class="c1">// our counter</span>
<span class="kd">var</span> <span class="nx">lock$</span><span class="p">:</span> <span class="k">sync</span> <span class="kt">bool</span><span class="p">;</span>   <span class="c1">// the mutex lock</span>

<span class="nx">count</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>       <span class="c1">// Only let two tasks in at a time.</span>
<span class="nx">lock$</span><span class="p">.</span><span class="nx">writeXF</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>  <span class="c1">// Set lock$ to full (unlocked)</span>
<span class="c1">// Note: The value doesn&#39;t actually matter, just the state</span>
<span class="c1">// (full:unlocked / empty:locked)</span>
<span class="c1">// Also, writeXF() fills (F) the sync var regardless of its state (X)</span>

<span class="k">coforall</span> <span class="nx">task</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">5</span> <span class="p">{</span> <span class="c1">// Generate tasks</span>
  <span class="c1">// Create a barrier</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="nx">lock$</span><span class="p">;</span>                 <span class="c1">// Read lock$ (wait)</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">count</span><span class="p">.</span><span class="nx">read</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Keep waiting until a spot opens up</span>

  <span class="nx">count</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>          <span class="c1">// decrement the counter</span>
  <span class="nx">lock$</span><span class="p">.</span><span class="nx">writeXF</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="c1">// Set lock$ to full (signal)</span>

  <span class="c1">// Actual &#39;work&#39;</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Task #&quot;</span><span class="p">,</span> <span class="nx">task</span><span class="p">,</span> <span class="s">&quot; doing work.&quot;</span><span class="p">);</span>
  <span class="nx">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

  <span class="nx">count</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>        <span class="c1">// Increment the counter</span>
  <span class="nx">lock$</span><span class="p">.</span><span class="nx">writeXF</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="c1">// Set lock$ to full (signal)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can define the operations <code class="docutils literal notranslate"><span class="pre">+</span> <span class="pre">*</span> <span class="pre">&amp;</span> <span class="pre">|</span> <span class="pre">^</span> <span class="pre">&amp;&amp;</span> <span class="pre">||</span> <span class="pre">min</span> <span class="pre">max</span> <span class="pre">minloc</span> <span class="pre">maxloc</span></code>
over an entire array using scans and reductions.
Reductions apply the operation over the entire array and
result in a scalar value.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">listOfValues</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">]</span> <span class="kt">int</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">57</span><span class="p">,</span><span class="mi">354</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">456</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">678</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">sumOfValues</span> <span class="o">=</span> <span class="o">+</span> <span class="k">reduce</span> <span class="nx">listOfValues</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">maxValue</span> <span class="o">=</span> <span class="nx">max</span> <span class="k">reduce</span> <span class="nx">listOfValues</span><span class="p">;</span> <span class="c1">// &#39;max&#39; give just max value</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">maxloc</span></code> gives max value and index of the max value.
Note: We have to zip the array and domain together with the zip iterator.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="p">(</span><span class="nx">theMaxValue</span><span class="p">,</span> <span class="nx">idxOfMax</span><span class="p">)</span> <span class="o">=</span> <span class="nx">maxloc</span> <span class="k">reduce</span> <span class="k">zip</span><span class="p">(</span><span class="nx">listOfValues</span><span class="p">,</span>
                                                <span class="nx">listOfValues</span><span class="p">.</span><span class="k">domain</span><span class="p">);</span>

<span class="nx">writeln</span><span class="p">((</span><span class="nx">sumOfValues</span><span class="p">,</span> <span class="nx">maxValue</span><span class="p">,</span> <span class="nx">idxOfMax</span><span class="p">,</span> <span class="nx">listOfValues</span><span class="p">[</span><span class="nx">idxOfMax</span><span class="p">]));</span>
</pre></div>
</div>
<p>Scans apply the operation incrementally and return an array with the
values of the operation at that index as it progressed through the
array from <code class="docutils literal notranslate"><span class="pre">array.domain.low</span></code> to <code class="docutils literal notranslate"><span class="pre">array.domain.high</span></code>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span>  <span class="kd">var</span> <span class="nx">runningSumOfValues</span> <span class="o">=</span> <span class="o">+</span> <span class="k">scan</span> <span class="nx">listOfValues</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">maxScan</span> <span class="o">=</span> <span class="nx">max</span> <span class="k">scan</span> <span class="nx">listOfValues</span><span class="p">;</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">runningSumOfValues</span><span class="p">);</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">maxScan</span><span class="p">);</span>
<span class="p">}</span> <span class="c1">// end main()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../language/spec/index.html" class="btn btn-neutral float-right" title="Chapel Language Specification" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="chpldoc.doc.html" class="btn btn-neutral float-left" title="chpldoc" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>