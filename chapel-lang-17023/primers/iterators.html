

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Iterators &mdash; Chapel Documentation 1.24</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Parallel Iterators" href="parIters.html" />
    <link rel="prev" title="Error Handling" href="errorHandling.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.24
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.24";
$pagename = "primers/iterators";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Primers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#language-basics">Language Basics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#iterators">Iterators</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Iterators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fibonacci">fibonacci</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multiloop">multiloop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#postorder">postorder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iterators-in-parallel">Iterators in parallel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parIters.html">Parallel Iterators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#task-parallelism">Task Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#locality">Locality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-parallelism">Data Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#library-utilities">Library Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#numerical-libraries">Numerical Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tools">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#language-overview">Language Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mason-packages.html">Mason Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Primers</a> &raquo;</li>
        
      <li>Iterators</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/primers/iterators.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="iterators">
<span id="primers-iterators"></span><h1>Iterators<a class="headerlink" href="#iterators" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/chapel-lang/chapel/blob/master/test/release/examples/primers/iterators.chpl">View iterators.chpl on GitHub</a></p>
<p>This primer contains several examples of iterators:</p>
<blockquote>
<div><ul class="simple">
<li><p>an iterator to generate the Fibonacci numbers,</p></li>
<li><p>an iterator defined by multiple loops</p></li>
<li><p>and a recursive iterator over a tree.</p></li>
</ul>
</div></blockquote>
<p>It also contains examples of the two kinds of parallel iteration:</p>
<blockquote>
<div><ul class="simple">
<li><p>data-parallel (<code class="docutils literal notranslate"><span class="pre">forall</span></code>), and</p></li>
<li><p>task-parallel (<code class="docutils literal notranslate"><span class="pre">coforall</span></code>).</p></li>
</ul>
</div></blockquote>
<div class="section" id="fibonacci">
<h2>fibonacci<a class="headerlink" href="#fibonacci" title="Permalink to this headline">¶</a></h2>
<p>Generates the first <code class="docutils literal notranslate"><span class="pre">n</span></code> Fibonacci numbers.</p>
<p>The state of this iterator is stored in the tuple <code class="docutils literal notranslate"><span class="pre">(current,</span> <span class="pre">next)</span></code>.
Each time the yield statement is reached, it yields, or generates,
the current Fibonacci number. It then updates the state to the next one.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">iter</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nx">n</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="nx">n</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nx">current</span><span class="p">;</span>
    <span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nx">next</span><span class="p">,</span> <span class="nx">current</span> <span class="o">+</span> <span class="nx">next</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An iterator is typically invoked in a loop. Whenever an iterator’s yield
statement is executed, the loop’s index variable is initialized with the
yielded value and the loop body is executed for a single iteration before
returning to the iterator.</p>
<p>When the iterator completes or encounters a return statement,
the loop terminates.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">write</span><span class="p">(</span><span class="s">&quot;The first few Fibonacci numbers are: &quot;</span><span class="p">);</span>

<span class="k">for</span> <span class="nx">indexVar</span> <span class="kd">in</span> <span class="nx">fibonacci</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">do</span>
  <span class="nx">write</span><span class="p">(</span><span class="nx">indexVar</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>

<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;...&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>This example uses zipper iteration to iterate over the unbounded range <code class="docutils literal notranslate"><span class="pre">1..</span></code>
and the fibonacci iterator with <code class="docutils literal notranslate"><span class="pre">n</span></code> set to ten. Ranges, as well as arrays
and domains, can be used as iterators in loops.</p>
<p>Zipper iteration means that each iterator is advanced to its next yield
and the two yielded values are combined into a tuple.</p>
<p>A zippered loop can have a single index variable, which will be a tuple,
or a tuple of variables like <code class="docutils literal notranslate"><span class="pre">(i,</span> <span class="pre">j)</span></code>, each of which is initialized
with the value yielded by the corresponding iterator.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Fibonacci Numbers&quot;</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">)</span> <span class="kd">in</span> <span class="k">zip</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="p">,</span> <span class="nx">fibonacci</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">write</span><span class="p">(</span><span class="s">&quot;The &quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>

  <span class="k">select</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">when</span> <span class="mi">1</span> <span class="k">do</span> <span class="nx">write</span><span class="p">(</span><span class="s">&quot;st&quot;</span><span class="p">);</span>
    <span class="k">when</span> <span class="mi">2</span> <span class="k">do</span> <span class="nx">write</span><span class="p">(</span><span class="s">&quot;nd&quot;</span><span class="p">);</span>
    <span class="k">when</span> <span class="mi">3</span> <span class="k">do</span> <span class="nx">write</span><span class="p">(</span><span class="s">&quot;rd&quot;</span><span class="p">);</span>
    <span class="k">otherwise</span> <span class="nx">write</span><span class="p">(</span><span class="s">&quot;th&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot; Fibonacci number is &quot;</span><span class="p">,</span> <span class="nx">j</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="multiloop">
<h2>multiloop<a class="headerlink" href="#multiloop" title="Permalink to this headline">¶</a></h2>
<p>Generate the outer (Cartesian) product of indices in two ranges
and yield them as tuples.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">iter</span> <span class="nf">multiloop</span><span class="p">(</span><span class="nx">n</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="nx">n</span> <span class="k">do</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="nx">n</span> <span class="k">do</span>
      <span class="k">yield</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Below is an example of promotion.
In this case, promotion means that a procedure which normally takes a
single argument will be repeated for each value that the iterator returns.</p>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">writeln()</span></code> is called with each value returned by the
<code class="docutils literal notranslate"><span class="pre">multiloop()</span></code> iterator.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Multiloop Tuples&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">multiloop</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="postorder">
<h2>postorder<a class="headerlink" href="#postorder" title="Permalink to this headline">¶</a></h2>
<p>Iterate over <code class="docutils literal notranslate"><span class="pre">Tree</span></code> in postorder using recursion.</p>
<p>Each yield statement returns a node, or equivalently the subtree
rooted at that node.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Tree</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">data</span><span class="p">:</span> <span class="kt">string</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">:</span> <span class="k">owned</span> <span class="nx">Tree</span><span class="p">?;</span>
<span class="p">}</span>

<span class="k">iter</span> <span class="nf">postorder</span><span class="p">(</span><span class="nx">tree</span><span class="p">:</span> <span class="k">borrowed</span> <span class="nx">Tree</span><span class="p">?):</span> <span class="k">borrowed</span> <span class="nx">Tree</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">tree</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">tree</span><span class="o">!</span><span class="p">.</span><span class="nx">left</span> <span class="p">{</span>
      <span class="c1">// Call the iterator recursively on the left subtree and expand.</span>
      <span class="k">for</span> <span class="nx">child</span> <span class="kd">in</span> <span class="nx">postorder</span><span class="p">(</span><span class="nx">tree</span><span class="o">!</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="k">do</span>
        <span class="k">yield</span> <span class="nx">child</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="nx">tree</span><span class="o">!</span><span class="p">.</span><span class="nx">right</span> <span class="p">{</span>
      <span class="c1">// Call the iterator recursively on the right subtree and expand.</span>
      <span class="k">for</span> <span class="nx">child</span> <span class="kd">in</span> <span class="nx">postorder</span><span class="p">(</span><span class="nx">tree</span><span class="o">!</span><span class="p">.</span><span class="nx">right</span><span class="p">)</span> <span class="k">do</span>
        <span class="k">yield</span> <span class="nx">child</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Finally, yield the node itself.</span>
    <span class="k">yield</span> <span class="nx">tree</span><span class="o">!</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Initialize a <code class="docutils literal notranslate"><span class="pre">Tree</span></code> instance to:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  a
 / \
b   c
   / \
  d   e
</pre></div>
</div>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">tree</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Tree</span><span class="p">(</span> <span class="s">&quot;a&quot;</span><span class="p">,</span>
  <span class="k">new</span> <span class="nx">Tree</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">Tree</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">Tree</span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">),</span>
    <span class="k">new</span> <span class="nx">Tree</span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">)));</span>
</pre></div>
</div>
<p>This method uses the postorder iterator to print out each node.
It uses the “first” flag to avoid printing a leading space.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">Tree.writeThis</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="k">for</span> <span class="nx">node</span> <span class="kd">in</span> <span class="nx">postorder</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">first</span> <span class="k">then</span>
      <span class="nx">first</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="nx">x</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">);</span>

    <span class="nx">x</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Output the data in the tree using the postorder iterator.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Tree Data&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">tree</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="iterators-in-parallel">
<h2>Iterators in parallel<a class="headerlink" href="#iterators-in-parallel" title="Permalink to this headline">¶</a></h2>
<p>When invoked in a forall loop (or semantically equivalent context),
the iterator is required to create parallel tasks and assign work to
them.  Such iterators are a fairly big topic and are described in
detail in the <a class="reference internal" href="parIters.html#primers-pariters"><span class="std std-ref">Parallel Iterators primer</span></a>.</p>
<p>The coforall loop uses the serial iterator to spawn a separate task
for each of the values it yields. If you use coforall, you are asserting
that the manipulations done with each yielded value can be done in parallel.
All of the spawned tasks will complete before execution continues
at the end of the coforall statement body.</p>
<p>This code decorates each node in the tree in parallel, using a coforall.
Then it writes out the resulting tree data using a postorder traversal.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">decorate</span><span class="p">(</span><span class="nx">s</span><span class="p">:</span><span class="kt">string</span><span class="p">)</span> <span class="k">return</span> <span class="s">&quot;node_&quot;</span> <span class="o">+</span> <span class="nx">s</span><span class="p">;</span>

<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Task parallel iteration&quot;</span><span class="p">);</span>

<span class="k">coforall</span> <span class="nx">node</span> <span class="kd">in</span> <span class="nx">postorder</span><span class="p">(</span><span class="nx">tree</span><span class="p">)</span> <span class="k">do</span>
  <span class="nx">node</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">decorate</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

<span class="nx">writeln</span><span class="p">(</span><span class="nx">tree</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parIters.html" class="btn btn-neutral float-right" title="Parallel Iterators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="errorHandling.html" class="btn btn-neutral float-left" title="Error Handling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>