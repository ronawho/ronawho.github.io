

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Replicated Distribution &mdash; Chapel Documentation 1.23</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="fileIO.chpl" href="fileIO.html" />
    <link rel="prev" title="Distributions" href="distributions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.23
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.23";
$pagename = "primers/replicated";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Primers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#language-basics">Language Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#iterators">Iterators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#task-parallelism">Task Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#locality">Locality</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#data-parallelism">Data Parallelism</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ranges.html">Ranges</a></li>
<li class="toctree-l3"><a class="reference internal" href="domains.html">Domains</a></li>
<li class="toctree-l3"><a class="reference internal" href="arrays.html">Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="slices.html">Slices</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse.html">Sparse Domains and Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="associative.html">Associative Domains and Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="reductions.html">Reductions</a></li>
<li class="toctree-l3"><a class="reference internal" href="distributions.html">Distributions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Replicated Distribution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preface">Preface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#replicated">Replicated</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#library-utilities">Library Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#numerical-libraries">Numerical Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tools">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#language-overview">Language Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Primers</a> &raquo;</li>
        
      <li>Replicated Distribution</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/primers/replicated.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="replicated-distribution">
<span id="primers-replicated"></span><h1>Replicated Distribution<a class="headerlink" href="#replicated-distribution" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/chapel-lang/chapel/blob/master/test/release/examples/primers/replicated.chpl">View replicated.chpl on GitHub</a></p>
<p>This primer demonstrates uses of the Replicated Distribution.
To use this distribution in a Chapel program, the following module must be
used:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">ReplicatedDist</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="preface">
<h2>Preface<a class="headerlink" href="#preface" title="Permalink to this headline">¶</a></h2>
<p>For this example, we’ll create a distributed domain and array
and then initialize it just to give a brief flavor of how the
distribution maps across locales. Running this example on 6
locales does a nice job of illustrating the distribution
characteristics.</p>
<p>Like other distributions, Replicated supports options to map to a different
virtual locale grid than the one used by default (a multidimensional
factoring of the built-in <code class="docutils literal notranslate"><span class="pre">Locales</span></code> array), as well as
to control the amount of parallelism used in data parallel
loops.  For more details, see the documentation on
<a class="reference internal" href="../modules/layoutdist.html#layouts-and-distributions"><span class="std std-ref">Standard Distributions</span></a>.</p>
<p>Make the program size configurable from the command line.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">config</span> <span class="kd">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</pre></div>
</div>
<p>Declare a 2-dimensional domain <code class="docutils literal notranslate"><span class="pre">Space</span></code> that we will later use to
initialize the distributed domains.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">Space</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="p">,</span> <span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="replicated">
<h2>Replicated<a class="headerlink" href="#replicated" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Replicated</span></code> distribution is different from other distributions:
each of the original domain’s indices is replicated onto
each locale, as are the corresponding array elements.  For example,
a domain <code class="docutils literal notranslate"><span class="pre">{1..3}</span></code> distributed using <code class="docutils literal notranslate"><span class="pre">Replicated</span></code> will store
three indices per locale that the distribution is targeting (by
default, all locales).  Similarly, an array declared over that
domain will store three elements per locale.  Each locale’s copy of
the domain or array is known as its <em>replicand</em>.</p>
<p>Consistency among these array replicands is NOT maintained
automatically; users who want a replicated array to store the same
values on every target locale will have to manage that consistency
themselves.</p>
<p>In general, operations on replicated domains and arrays only refer
the local replicand.  The primary exception to this rule is the
re-assignment of a replicated domain’s indices.  In this case, the
copy of the domain on each locale will be updated (and any arrays
over the domain will be reallocated on each locale).</p>
<p>Here’s a declaration of a replicated domain and array:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">ReplicatedSpace</span> <span class="o">=</span> <span class="nx">Space</span> <span class="k">dmapped</span> <span class="nx">Replicated</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">RA</span><span class="p">:</span> <span class="p">[</span><span class="nx">ReplicatedSpace</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>
</pre></div>
</div>
<p>Queries about the size of a replicated domain or array will return
the size per locale:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Replicated Array has &quot;</span><span class="p">,</span> <span class="nx">RA</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span> <span class="s">&quot; elements per locale&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The following loop-based assignment to <cite>RA</cite> only affects the copy
of ‘RA’ on the locale on which it’s running (the last locale, in
this example).  All other copies will remain in their
default-initialized form.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="nx">numLocales</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">do</span>
  <span class="k">forall</span> <span class="nx">ra</span> <span class="kd">in</span> <span class="nx">RA</span> <span class="k">do</span>
    <span class="nx">ra</span> <span class="o">=</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</pre></div>
</div>
<p>Similarly, when reading the array, only the local copy will be
accessed.  Thus, when running on more than one locale, the
following writeln() will not see the modification performed by the
loop above since the two statements are executed on distinct locales:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Locale 0&#39;s copy of RA is:\n&quot;</span><span class="p">,</span> <span class="nx">RA</span><span class="p">);</span>
</pre></div>
</div>
<p>To access the replicands owned by other locales, we can use the
replicand method, which takes a locale as an argument and returns the
array local to that locale:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Locale &quot;</span><span class="p">,</span> <span class="nx">numLocales</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;&#39;s copy of RA is:\n&quot;</span><span class="p">,</span>
         <span class="nx">RA</span><span class="p">.</span><span class="nx">replicand</span><span class="p">(</span><span class="nx">Locales</span><span class="p">[</span><span class="nx">numLocales</span><span class="o">-</span><span class="mi">1</span><span class="p">]));</span>
</pre></div>
</div>
<p>Alternatively, we can print the replicated array from that locale:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="nx">numLocales</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">do</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Locale &quot;</span><span class="p">,</span> <span class="nx">numLocales</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;&#39;s copy of RA is:\n&quot;</span><span class="p">,</span> <span class="nx">RA</span><span class="p">);</span>
</pre></div>
</div>
<p>In order to see the replicands owned by all the locales, let’s
define and call a little utility function:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">writeReplicands</span><span class="p">(</span><span class="nx">X</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">loc</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="p">{</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="nx">loc</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">);</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="nx">X</span><span class="p">.</span><span class="nx">replicand</span><span class="p">(</span><span class="nx">loc</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Replicated Array Index Map&quot;</span><span class="p">);</span>
<span class="nx">writeReplicands</span><span class="p">(</span><span class="nx">RA</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Whole-array assignment is similarly local only to the current
locale’s copy of the array:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">A</span><span class="p">:</span> <span class="p">[</span><span class="nx">Space</span><span class="p">]</span> <span class="kt">int</span> <span class="o">=</span> <span class="p">[(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="kd">in</span> <span class="nx">Space</span><span class="p">]</span> <span class="nx">i</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="nx">j</span><span class="p">;</span>
<span class="nx">RA</span> <span class="o">=</span> <span class="nx">A</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Replicated Array after whole-array assignment:&quot;</span><span class="p">);</span>
<span class="nx">writeReplicands</span><span class="p">(</span><span class="nx">RA</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Here, we have each locale update its own copy of <cite>RA</cite> to store its
locale ID, which results in a modification to each replicand:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">coforall</span> <span class="nx">loc</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="k">do</span> <span class="k">on</span> <span class="nx">loc</span> <span class="k">do</span>
  <span class="nx">RA</span> <span class="o">=</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Replicated Array after assigning on each locale:&quot;</span><span class="p">);</span>
<span class="nx">writeReplicands</span><span class="p">(</span><span class="nx">RA</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>The following examples simply demonstrate that only the local
replicand is accessed when an individual element is read…</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">do</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;on &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">,</span> <span class="s">&quot;: &quot;</span><span class="p">,</span> <span class="nx">RA</span><span class="p">(</span><span class="nx">Space</span><span class="p">.</span><span class="nx">low</span><span class="p">));</span>
<span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="nx">LocaleSpace</span><span class="p">.</span><span class="nx">high</span><span class="p">]</span> <span class="k">do</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;on &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">,</span> <span class="s">&quot;: &quot;</span><span class="p">,</span> <span class="nx">RA</span><span class="p">(</span><span class="nx">Space</span><span class="p">.</span><span class="nx">low</span><span class="p">));</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>…or written:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="nx">LocaleSpace</span><span class="p">.</span><span class="nx">high</span><span class="p">]</span> <span class="k">do</span>
  <span class="nx">RA</span><span class="p">(</span><span class="nx">Space</span><span class="p">.</span><span class="nx">low</span><span class="p">)</span> <span class="o">=</span> <span class="mi">7777</span><span class="p">;</span>

<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Replicated Array after being indexed into&quot;</span><span class="p">);</span>
<span class="nx">writeReplicands</span><span class="p">(</span><span class="nx">RA</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>…or the whole array is read:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="nx">LocaleSpace</span><span class="p">.</span><span class="nx">high</span><span class="p">]</span> <span class="k">do</span>
  <span class="nx">A</span> <span class="o">=</span> <span class="nx">RA</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Non-Replicated Array after assignment from Replicated Array + 4&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">A</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="fileIO.html" class="btn btn-neutral float-right" title="fileIO.chpl" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="distributions.html" class="btn btn-neutral float-left" title="Distributions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>