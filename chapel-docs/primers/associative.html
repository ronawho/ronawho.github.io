

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Associative Domains and Arrays &mdash; Chapel Documentation 1.23</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reductions" href="reductions.html" />
    <link rel="prev" title="Sparse Domains and Arrays" href="sparse.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.23
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.23";
$pagename = "primers/associative";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Primers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#language-basics">Language Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#iterators">Iterators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#task-parallelism">Task Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#locality">Locality</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#data-parallelism">Data Parallelism</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ranges.html">Ranges</a></li>
<li class="toctree-l3"><a class="reference internal" href="domains.html">Domains</a></li>
<li class="toctree-l3"><a class="reference internal" href="arrays.html">Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="slices.html">Slices</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse.html">Sparse Domains and Arrays</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Associative Domains and Arrays</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#associative-domains">Associative Domains</a></li>
<li class="toctree-l4"><a class="reference internal" href="#associative-arrays">Associative Arrays</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-operations">Set Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#future-directions">Future Directions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reductions.html">Reductions</a></li>
<li class="toctree-l3"><a class="reference internal" href="distributions.html">Distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="replicated.html">Replicated Distribution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#library-utilities">Library Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#numerical-libraries">Numerical Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tools">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#language-overview">Language Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Primers</a> &raquo;</li>
        
      <li>Associative Domains and Arrays</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/primers/associative.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="associative-domains-and-arrays">
<span id="primers-associative"></span><h1>Associative Domains and Arrays<a class="headerlink" href="#associative-domains-and-arrays" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/chapel-lang/chapel/blob/master/test/release/examples/primers/associative.chpl">View associative.chpl on GitHub</a></p>
<p>This is a tutorial on Chapel’s associative domains and arrays.</p>
<p>It may be beneficial to read the <a class="reference internal" href="arrays.html#primers-arrays"><span class="std std-ref">arrays.chpl</span></a> and
<a class="reference internal" href="domains.html#primers-domains"><span class="std std-ref">domains.chpl</span></a> primers before proceeding if you’re not
already familiar with Chapel’s domains and arrays.</p>
<div class="section" id="associative-domains">
<h2>Associative Domains<a class="headerlink" href="#associative-domains" title="Permalink to this headline">¶</a></h2>
<p>Associative domains are commonly used to represent arbitrary sets, or to
represent the set of keys for a dictionary/hash table.</p>
<p>The current implementation supports most Chapel types, and will eventually
support any language-defined type.</p>
<p>The following block contains some examples of associative domains with
various index types.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="kd">var</span> <span class="nx">A</span> <span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>     <span class="c1">// a domain (set) whose indices are integers</span>
  <span class="kd">var</span> <span class="nx">B</span> <span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="kt">string</span><span class="p">);</span>  <span class="c1">// a domain (set) whose indices are strings</span>
  <span class="kd">var</span> <span class="nx">C</span> <span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="kt">real</span><span class="p">);</span>    <span class="c1">// a domain (set) whose indices are reals</span>

  <span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="p">:</span> <span class="kt">int</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">//</span>
  <span class="c1">// A domain whose indices are classes of type &#39;X&#39;. The indices are hashed by</span>
  <span class="c1">// identity.</span>
  <span class="c1">//</span>
  <span class="kd">var</span> <span class="nx">D</span> <span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="k">borrowed</span> <span class="nx">X</span><span class="p">);</span>

  <span class="k">record</span> <span class="nc">Y</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">y</span> <span class="p">:</span> <span class="kt">real</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">//</span>
  <span class="c1">// A domain whose indices are records of type &#39;Y&#39;. The indices are hashed by</span>
  <span class="c1">// value.</span>
  <span class="c1">//</span>
  <span class="kd">var</span> <span class="nx">E</span> <span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="nx">Y</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Below, <code class="docutils literal notranslate"><span class="pre">Names</span></code> is an associative domain of strings.  Associative domains
start out empty (no indices).</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Names</span><span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="kt">string</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;An empty associative domain: &quot;</span><span class="p">,</span> <span class="nx">Names</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">size</span></code> method to confirm the emptiness of the <code class="docutils literal notranslate"><span class="pre">Names</span></code> domain.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;The initial size of the &#39;Names&#39; domain is &quot;</span><span class="p">,</span> <span class="nx">Names</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>We can also use the domain-literal syntax to create an associative domain.</p>
<p>Below, <code class="docutils literal notranslate"><span class="pre">Days</span></code> is an associative domain of strings.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Days</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Sunday&quot;</span><span class="p">,</span> <span class="s">&quot;Wednesday&quot;</span><span class="p">,</span> <span class="s">&quot;Saturday&quot;</span><span class="p">};</span>
</pre></div>
</div>
<p>This declaration of <code class="docutils literal notranslate"><span class="pre">Days</span></code> relies on Chapel’s type inference, and is
equivalent to</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Days</span> <span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Sunday&quot;</span><span class="p">,</span> <span class="s">&quot;Wednesday&quot;</span><span class="p">,</span> <span class="s">&quot;Saturday&quot;</span><span class="p">};</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">+=</span></code> operator can be used to add indices to an associative domain.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">Names</span> <span class="o">+=</span> <span class="s">&quot;Alice&quot;</span><span class="p">;</span>
<span class="nx">Names</span> <span class="o">+=</span> <span class="s">&quot;Bob&quot;</span><span class="p">;</span>
<span class="nx">Names</span> <span class="o">+=</span> <span class="s">&quot;Clark&quot;</span><span class="p">;</span>
<span class="nx">Names</span> <span class="o">+=</span> <span class="s">&quot;Dana&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">add</span></code> method is equivalent to <code class="docutils literal notranslate"><span class="pre">+=</span></code></p>
<p>The order in which indices are printed is not guaranteed for associative
domains.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">Names</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s">&quot;Ellen&quot;</span><span class="p">);</span>
<span class="nx">Names</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s">&quot;Frank&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;A populated associative domain of strings: &quot;</span><span class="p">,</span> <span class="nx">Names</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Associative domains cannot contain duplicate indices.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">PreviousNamesSize</span> <span class="o">=</span> <span class="nx">Names</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
<span class="nx">Names</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="nx">Names</span><span class="p">.</span><span class="nx">size</span> <span class="o">!=</span> <span class="nx">PreviousNamesSize</span> <span class="k">then</span>
  <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;Error: Added duplicate index, but size of domain changed&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Below we can add an array of strings with the <code class="docutils literal notranslate"><span class="pre">+=</span></code> or <code class="docutils literal notranslate"><span class="pre">add</span></code> operators
because of Chapel’s standard function promotion semantics. For the
<code class="docutils literal notranslate"><span class="pre">ColorSet</span></code> domain, those functions take string arguments. Because
<code class="docutils literal notranslate"><span class="pre">PrimaryColors</span></code> is a collection of strings Chapel promotes the routine,
calling it for each string represented in the array.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">PrimaryColors</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">]</span> <span class="kt">string</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Red&quot;</span><span class="p">,</span> <span class="s">&quot;Green&quot;</span><span class="p">,</span> <span class="s">&quot;Blue&quot;</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">ColorSet</span> <span class="p">:</span> <span class="k">domain</span><span class="p">(</span><span class="kt">string</span><span class="p">);</span>
<span class="nx">ColorSet</span> <span class="o">+=</span> <span class="nx">PrimaryColors</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-=</span></code> operator is used to remove indices from an associative domain.
The <code class="docutils literal notranslate"><span class="pre">remove</span></code> method performs the same function.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">Names</span> <span class="o">-=</span> <span class="s">&quot;Bob&quot;</span><span class="p">;</span>
<span class="nx">Names</span> <span class="o">+=</span> <span class="s">&quot;Robert&quot;</span><span class="p">;</span>
<span class="nx">Names</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s">&quot;Frank&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Removed &#39;Bob&#39; and &#39;Frank&#39;, added &#39;Robert&#39;: &quot;</span><span class="p">,</span> <span class="nx">Names</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>If we want to check that “Bob” and “Frank” were indeed removed we can use the
<code class="docutils literal notranslate"><span class="pre">contains</span></code> function, which returns a boolean.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nx">Names</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">)</span> <span class="k">then</span>
  <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;Error: Bob should have been removed!&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="nx">Names</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s">&quot;Frank&quot;</span><span class="p">)</span> <span class="k">then</span>
  <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;Error: Frank should have been removed!&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="associative-arrays">
<h2>Associative Arrays<a class="headerlink" href="#associative-arrays" title="Permalink to this headline">¶</a></h2>
<p>Like all other domains, we can use associative domains to define an array.
<code class="docutils literal notranslate"><span class="pre">Scores</span></code> is the Chapel-equivalent of a “map”, “dictionary”, or “hash
table” found in other languages. Where <code class="docutils literal notranslate"><span class="pre">Names</span></code> provides the keys,
<code class="docutils literal notranslate"><span class="pre">Scores</span></code> provides the values.</p>
<p>Scores: an associative array mapping strings to integers.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Scores</span> <span class="p">:</span> <span class="p">[</span><span class="nx">Names</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>
</pre></div>
</div>
<p>Like other arrays, we can initialize associative array elements to have
an initial value.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">HoursInDay</span> <span class="p">:</span> <span class="p">[</span><span class="nx">Days</span><span class="p">]</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
<span class="k">for</span> <span class="nx">hours</span> <span class="kd">in</span> <span class="nx">HoursInDay</span> <span class="k">do</span>
  <span class="k">if</span> <span class="nx">hours</span> <span class="o">!=</span> <span class="mi">24</span> <span class="k">then</span>
    <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;HoursInDay&#39;s values should have all been initialized to &#39;24&#39;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>We could also use the array-literal syntax to create an associative
array.</p>
<p>Below, <code class="docutils literal notranslate"><span class="pre">DaysInMonth</span></code> is an associative array mapping strings to integers.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">DaysInMonth</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;June&quot;</span> <span class="o">=&gt;</span> <span class="mi">30</span><span class="p">,</span> <span class="s">&quot;January&quot;</span> <span class="o">=&gt;</span> <span class="mi">31</span><span class="p">,</span> <span class="s">&quot;September&quot;</span> <span class="o">=&gt;</span> <span class="mi">30</span><span class="p">];</span>
</pre></div>
</div>
<p>All array elements are initialized to the default value for that type.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Our &#39;Scores&#39; associative array: &quot;</span><span class="p">,</span> <span class="nx">Scores</span><span class="p">);</span>
</pre></div>
</div>
<p>Printing an array only prints its values. Let’s write a function that
prints our associative array in a more human-readable format.</p>
<p>Given an array, print in the following format:
[ idx =&gt; val, … ]</p>
<p>We’ll use the <code class="docutils literal notranslate"><span class="pre">sorted</span></code> iterator to print in a consistent order. Otherwise,
the order in which indices are yielded is nondeterministic.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">prettyPrint</span><span class="p">(</span><span class="nx">arr</span> <span class="p">:</span> <span class="p">[?</span><span class="nx">dom</span><span class="p">])</span> <span class="p">{</span>
  <span class="nx">write</span><span class="p">(</span><span class="s">&quot;[ &quot;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">for</span> <span class="nx">k</span> <span class="kd">in</span> <span class="nx">dom</span><span class="p">.</span><span class="nx">sorted</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">first</span> <span class="p">{</span>
      <span class="nx">write</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="s">&quot; =&gt; &quot;</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">write</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="s">&quot; =&gt; &quot;</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
      <span class="nx">first</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot; ]&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using our new routine, print our array.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">write</span><span class="p">(</span><span class="s">&quot;Our &#39;Scores&#39; array, pretty-printed: &quot;</span><span class="p">);</span>
<span class="nx">prettyPrint</span><span class="p">(</span><span class="nx">Scores</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Let’s initialize our <code class="docutils literal notranslate"><span class="pre">Scores</span></code> array.</p>
<p>Traditional array operations like whole-array assignment and indexing
are supported for associative arrays.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">Scores</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="c1">// every value in &#39;Scores&#39; is now &#39;100&#39;.</span>

<span class="nx">Scores</span><span class="p">[</span><span class="s">&quot;Robert&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span><span class="p">;</span>
<span class="nx">Scores</span><span class="p">[</span><span class="s">&quot;Alice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="nx">Scores</span><span class="p">[</span><span class="s">&quot;Dana&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">91</span><span class="p">;</span>
<span class="nx">write</span><span class="p">(</span><span class="s">&quot;Our &#39;Scores&#39; array initialized with some values: &quot;</span><span class="p">);</span>
<span class="nx">prettyPrint</span><span class="p">(</span><span class="nx">Scores</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Like other Chapel arrays, we can use reductions.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;The average score is &quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">+</span> <span class="k">reduce</span> <span class="nx">Scores</span><span class="p">)</span> <span class="o">/</span> <span class="nx">Scores</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Because Chapel arrays are updated when their domain is changed, we can
add indices after the array is declared. When we add an index to the
defining domain, the array is extended to support an element for that index.
The new element is initialized to the default value of its type.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">Names</span> <span class="o">+=</span> <span class="s">&quot;John&quot;</span><span class="p">;</span>
<span class="nx">Names</span> <span class="o">+=</span> <span class="s">&quot;Gary&quot;</span><span class="p">;</span>

<span class="k">if</span> <span class="nx">Scores</span><span class="p">[</span><span class="s">&quot;John&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">then</span>
  <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;Scores[\&quot;John\&quot;] should have been initialized to 0.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Once added to the <code class="docutils literal notranslate"><span class="pre">Names</span></code> domain, we can use it like any other index in
the array.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">Scores</span><span class="p">[</span><span class="s">&quot;John&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">76</span><span class="p">;</span>
<span class="nx">Scores</span><span class="p">[</span><span class="s">&quot;Gary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="nx">write</span><span class="p">(</span><span class="s">&quot;Our updated &#39;Scores&#39; array after adding some more names: &quot;</span><span class="p">);</span>
<span class="nx">prettyPrint</span><span class="p">(</span><span class="nx">Scores</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>The first line of code in the previous block is equivalent to:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">Names</span> <span class="o">+=</span> <span class="s">&quot;Gary&quot;</span><span class="p">;</span>
<span class="nx">Scores</span><span class="p">[</span><span class="s">&quot;Gary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<p>We can also verify that the underlying <code class="docutils literal notranslate"><span class="pre">Names</span></code> domain was modified:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">!</span><span class="nx">Names</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s">&quot;Gary&quot;</span><span class="p">)</span> <span class="k">then</span>
  <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;Error: &#39;Gary&#39; should be present in the &#39;Names&#39; domain&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>If we were to define another array with <code class="docutils literal notranslate"><span class="pre">Names</span></code> as the backing domain,
then we could no longer use this convenient feature.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Ages</span> <span class="p">:</span> <span class="p">[</span><span class="nx">Names</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>
</pre></div>
</div>
<p>Here, since <code class="docutils literal notranslate"><span class="pre">Ages</span></code> and <code class="docutils literal notranslate"><span class="pre">Scores</span></code> are backed by the same associative
domain, we can no longer write something like</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">Ages</span><span class="p">[</span><span class="s">&quot;Mark&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span><span class="p">;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">Score</span><span class="p">[</span><span class="s">&quot;Sam&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</pre></div>
</div>
<p>since “Mark” or “Sam” are not valid indices in the <code class="docutils literal notranslate"><span class="pre">Names</span></code> domain.</p>
<p>This restriction exists because Chapel binds arrays to their domains for
their lifetime to support semantic reasoning by the compiler and users.
Extending the array via indexing will modify its domain, which would in
turn modify the keys and values of any other arrays sharing that domain.</p>
<p>We consider this behavior to be too surprising to support (“I modified
<code class="docutils literal notranslate"><span class="pre">Ages</span></code>, why did <code class="docutils literal notranslate"><span class="pre">Scores</span></code> change as well?”). Thus, to extend an array which
shares its domain, the user is required to modify the domain directly.
By modifying such a domain, it should be less surprising that arrays
bound to that domain are affected.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">Names</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s">&quot;Mark&quot;</span><span class="p">);</span>
<span class="nx">Ages</span><span class="p">[</span><span class="s">&quot;Mark&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span><span class="p">;</span>
<span class="nx">Scores</span><span class="p">[</span><span class="s">&quot;Mark&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">81</span><span class="p">;</span>
</pre></div>
</div>
<p>The program will still halt with an out-of-bounds error if one tries to
access an index not in the domain:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="nx">Scores</span><span class="p">[</span><span class="s">&quot;Sally&quot;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="set-operations">
<h2>Set Operations<a class="headerlink" href="#set-operations" title="Permalink to this headline">¶</a></h2>
<p>Set operations are available on associative domains and arrays.</p>
<dl class="docutils">
<dt>The supported set operations are:</dt>
<dd><ul class="first last simple">
<li>Union (<code class="docutils literal notranslate"><span class="pre">|</span></code> or <code class="docutils literal notranslate"><span class="pre">+</span></code>)</li>
<li>Intersection (<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>)</li>
<li>Difference (<code class="docutils literal notranslate"><span class="pre">-</span></code>)</li>
<li>Symmetric Difference (<code class="docutils literal notranslate"><span class="pre">^</span></code>)</li>
</ul>
</dd>
<dt>For both associative domains and arrays, the <code class="docutils literal notranslate"><span class="pre">op=</span></code> variants are supported:</dt>
<dd><code class="docutils literal notranslate"><span class="pre">|=,</span> <span class="pre">+=,</span> <span class="pre">&amp;=,</span> <span class="pre">-=,</span> <span class="pre">and</span> <span class="pre">^=</span></code></dd>
</dl>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">primeDom</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">};</span>  <span class="c1">// some prime numbers</span>
<span class="kd">var</span> <span class="nx">fibDom</span>   <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">};</span> <span class="c1">// part of the Fibonacci sequence</span>

<span class="kd">var</span> <span class="nx">primeAndFib</span> <span class="o">=</span> <span class="nx">primeDom</span> <span class="o">&amp;</span> <span class="nx">fibDom</span><span class="p">;</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Some primes in the Fibonacci sequence: &quot;</span><span class="p">,</span> <span class="nx">primeAndFib</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Some primes not in the Fibonacci sequence: &quot;</span><span class="p">,</span> <span class="nx">primeDom</span> <span class="o">-</span> <span class="nx">primeAndFib</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">Women</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Alice&quot;</span><span class="p">,</span> <span class="s">&quot;Dana&quot;</span><span class="p">,</span> <span class="s">&quot;Ellen&quot;</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">Men</span> <span class="o">=</span> <span class="nx">Names</span> <span class="o">-</span> <span class="nx">Women</span><span class="p">;</span>

<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Women = &quot;</span><span class="p">,</span> <span class="nx">Women</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Men = &quot;</span><span class="p">,</span> <span class="nx">Men</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">Men</span> <span class="o">|</span> <span class="nx">Women</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">Names</span> <span class="k">then</span>
  <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;The union of the &#39;Men&#39; and &#39;Women&#39; sets should be equivalent to &#39;Names&#39;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Special rules exist for associative array set operations.</p>
<p>If performing a union on two associative arrays with overlapping indices,
the value of the second array takes precedence.</p>
<p>For the <code class="docutils literal notranslate"><span class="pre">op=</span></code> variants on associative arrays, the array must not share its
domain with another array.</p>
</div>
<div class="section" id="future-directions">
<h2>Future Directions<a class="headerlink" href="#future-directions" title="Permalink to this headline">¶</a></h2>
<p>Today, associative domains cannot be distributed across multiple
locales.  A prototype domain map for this exists, and the effort to make
it a polished feature could be accelerated with sufficient user
interest.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reductions.html" class="btn btn-neutral float-right" title="Reductions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sparse.html" class="btn btn-neutral float-left" title="Sparse Domains and Arrays" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>