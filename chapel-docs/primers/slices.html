

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Slices &mdash; Chapel Documentation 1.23</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sparse Domains and Arrays" href="sparse.html" />
    <link rel="prev" title="Arrays" href="arrays.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.23
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.23";
$pagename = "primers/slices";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Primers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#language-basics">Language Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#iterators">Iterators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#task-parallelism">Task Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#locality">Locality</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#data-parallelism">Data Parallelism</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ranges.html">Ranges</a></li>
<li class="toctree-l3"><a class="reference internal" href="domains.html">Domains</a></li>
<li class="toctree-l3"><a class="reference internal" href="arrays.html">Arrays</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Slices</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse.html">Sparse Domains and Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="associative.html">Associative Domains and Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="reductions.html">Reductions</a></li>
<li class="toctree-l3"><a class="reference internal" href="distributions.html">Distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="replicated.html">Replicated Distribution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#library-utilities">Library Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#numerical-libraries">Numerical Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tools">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#language-overview">Language Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Primers</a> &raquo;</li>
        
      <li>Slices</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/primers/slices.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="slices">
<span id="primers-slices"></span><h1>Slices<a class="headerlink" href="#slices" title="Permalink to this headline">Â¶</a></h1>
<p><a class="reference external" href="https://github.com/chapel-lang/chapel/blob/master/test/release/examples/primers/slices.chpl">View slices.chpl on GitHub</a></p>
<p>This example program demonstrates the use of array slicing and
reindexing.</p>
<p>In this program, diagonal blocks (or slices) of <code class="docutils literal notranslate"><span class="pre">A</span></code> are initialized
according to the row indices of the diagonal block.</p>
<p><code class="docutils literal notranslate"><span class="pre">(i,j)</span> <span class="pre">=</span> <span class="pre">i</span></code>, for all <code class="docutils literal notranslate"><span class="pre">(i,j)</span></code> in diagonal blocks</p>
<p>If the block has been reindexed, then each diagonal block is
initialized with the same values.  If the block has not been
reindexed, then the block has the same indices as the full array,
so each diagonal block is initialized with different values.</p>
<p>(Incomplete diagonal blocks are not initialized.  If <code class="docutils literal notranslate"><span class="pre">blk</span></code> does not
divide into <code class="docutils literal notranslate"><span class="pre">n</span></code> evenly, the last diagonal block of <code class="docutils literal notranslate"><span class="pre">A</span></code> will be
uninitialized.)</p>
<p>Three different cases are given, to show different ways of slicing
arrays, with and without reindexing.  Array aliases are declared
for the diagonal blocks in two of the three cases.  One of these
array aliases uses reindexing of the domain of the array alias.
The initialization of the blocks is handled in either <code class="docutils literal notranslate"><span class="pre">initBlock</span></code>
or <code class="docutils literal notranslate"><span class="pre">initBlock2</span></code>.  The procedure <code class="docutils literal notranslate"><span class="pre">initBlock</span></code> does not reindex
the domain of the input array while <code class="docutils literal notranslate"><span class="pre">initBlock2</span></code> does.</p>
<p>Configuration variables for <code class="docutils literal notranslate"><span class="pre">n</span></code> and <code class="docutils literal notranslate"><span class="pre">blk</span></code> where the array <code class="docutils literal notranslate"><span class="pre">A</span></code>
is <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">*</span> <span class="pre">n</span></code> and <code class="docutils literal notranslate"><span class="pre">blk</span></code> is the size of the diagonal subblock.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">config</span> <span class="kd">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
             <span class="nx">blk</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">proc</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</pre></div>
</div>
<p>Variable declarations for the range <code class="docutils literal notranslate"><span class="pre">vec</span></code>, and for the domain <code class="docutils literal notranslate"><span class="pre">D</span></code>
and array <code class="docutils literal notranslate"><span class="pre">A</span></code>.  <code class="docutils literal notranslate"><span class="pre">vec</span></code> is used to define the ranges of each dimension
of <code class="docutils literal notranslate"><span class="pre">D</span></code> and it is later used in the iterator for the for loop statements
which call the init procedure for each diagonal block of <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">vec</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">D</span> <span class="o">=</span> <span class="p">{</span><span class="nx">vec</span><span class="p">,</span><span class="nx">vec</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">A</span><span class="p">:[</span><span class="nx">D</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">D0</span></code> is a domain which is used to reindex the diagonal blocks of <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">D0</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="nx">blk</span><span class="p">,</span> <span class="mi">1</span><span class="o">..</span><span class="nx">blk</span><span class="p">};</span>
</pre></div>
</div>
<p>Each of the following three for loop statements uses the
iterator <code class="docutils literal notranslate"><span class="pre">blockIter</span></code> to yield a range <code class="docutils literal notranslate"><span class="pre">subvec</span></code> that is then
used to define <code class="docutils literal notranslate"><span class="pre">subvec</span> <span class="pre">*</span> <span class="pre">subvec</span></code> blocks along the diagonal of <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p>
<p>Case 1:  No reindexing of the diagonal blocks.
The array slice is sent directly to <code class="docutils literal notranslate"><span class="pre">initBlock</span></code>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Initializing the diagonal blocks of A.&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;No reindexing of diagonal blocks.&quot;</span><span class="p">);</span>
<span class="k">for</span> <span class="nx">subvec</span> <span class="kd">in</span> <span class="nx">blockIter</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span><span class="nx">blk</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">initBlock</span><span class="p">(</span><span class="nx">A</span><span class="p">[</span><span class="nx">subvec</span><span class="p">,</span><span class="nx">subvec</span><span class="p">]);</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">(</span><span class="nx">A</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">A</span></code> is reset to zero between each case.  (This step is not
necessary, but done to show that each case starts with a zero array.)</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Case 2:  An array alias with reindexing is used to point to each
diagonal block, and that array alias is sent to <code class="docutils literal notranslate"><span class="pre">initBlock</span></code>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Initializing the diagonal blocks of A.&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Reindexing of each diagonal block in alias declaration. &quot;</span><span class="p">);</span>
<span class="k">for</span> <span class="nx">subvec</span> <span class="kd">in</span> <span class="nx">blockIter</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span><span class="nx">blk</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">ref</span> <span class="nx">Ablock</span> <span class="o">=</span> <span class="nx">A</span><span class="p">[</span><span class="nx">subvec</span><span class="p">,</span><span class="nx">subvec</span><span class="p">].</span><span class="nx">reindex</span><span class="p">(</span><span class="nx">D0</span><span class="p">);</span>
  <span class="nx">initBlock</span><span class="p">(</span><span class="nx">Ablock</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">(</span><span class="nx">A</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>

<span class="nx">A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Case 3: An array alias is used to point to each diagonal block
and is reindexed to use 1-based indexing in order to meet the
requirements of the <code class="docutils literal notranslate"><span class="pre">initBlock2()</span></code> routine.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Initializing the diagonal blocks of A.&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Reindexing of array argument in init procedure definition. &quot;</span><span class="p">);</span>
<span class="k">for</span> <span class="nx">subvec</span> <span class="kd">in</span> <span class="nx">blockIter</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span><span class="nx">blk</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">ref</span> <span class="nx">Ablock</span> <span class="o">=</span> <span class="nx">A</span><span class="p">[</span><span class="nx">subvec</span><span class="p">,</span><span class="nx">subvec</span><span class="p">].</span><span class="nx">reindex</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="nx">blk</span><span class="p">,</span> <span class="mi">1</span><span class="o">..</span><span class="nx">blk</span><span class="p">);</span>
  <span class="nx">initBlock2</span><span class="p">(</span><span class="nx">Ablock</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">(</span><span class="nx">A</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="p">}</span> <span class="c1">// main()</span>
</pre></div>
</div>
<p>The iterator <code class="docutils literal notranslate"><span class="pre">blockIter</span></code> yields a range that defines a subset
of <code class="docutils literal notranslate"><span class="pre">vec</span></code>, which is always of length <code class="docutils literal notranslate"><span class="pre">blk</span></code>.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">iter</span> <span class="nf">blockIter</span><span class="p">(</span><span class="nx">vec</span><span class="p">:</span><span class="kt">range</span><span class="p">,</span><span class="nx">blk</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">vec</span> <span class="k">by</span> <span class="nx">blk</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">blk</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">high</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">yield</span> <span class="nx">i</span><span class="o">..</span><span class="nx">i</span><span class="o">+</span><span class="nx">blk</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This procedure sets each element of <code class="docutils literal notranslate"><span class="pre">A</span></code> to be the value of its
row index.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">initBlock</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="kd">in</span> <span class="nx">A</span><span class="p">.</span><span class="k">domain</span> <span class="p">{</span>
    <span class="nx">A</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This procedure requires the domain of the array argument to
be <code class="docutils literal notranslate"><span class="pre">{1..blk,1..blk}</span></code>.  It sets each element of <code class="docutils literal notranslate"><span class="pre">A</span></code> to be
the value of its row index.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">initBlock2</span><span class="p">(</span><span class="nx">A</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="nx">blk</span><span class="p">,</span><span class="mi">1</span><span class="o">..</span><span class="nx">blk</span><span class="p">])</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="kd">in</span> <span class="nx">A</span><span class="p">.</span><span class="k">domain</span> <span class="p">{</span>
    <span class="nx">A</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sparse.html" class="btn btn-neutral float-right" title="Sparse Domains and Arrays" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="arrays.html" class="btn btn-neutral float-left" title="Arrays" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>