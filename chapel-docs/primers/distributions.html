

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Distributions &mdash; Chapel Documentation 1.23</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Replicated Distribution" href="replicated.html" />
    <link rel="prev" title="Reductions" href="reductions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.23
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.23";
$pagename = "primers/distributions";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Primers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#language-basics">Language Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#iterators">Iterators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#task-parallelism">Task Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#locality">Locality</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#data-parallelism">Data Parallelism</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ranges.html">Ranges</a></li>
<li class="toctree-l3"><a class="reference internal" href="domains.html">Domains</a></li>
<li class="toctree-l3"><a class="reference internal" href="arrays.html">Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="slices.html">Slices</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse.html">Sparse Domains and Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="associative.html">Associative Domains and Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="reductions.html">Reductions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#block-and-distribution-basics">Block (and distribution basics)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cyclic">Cyclic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#block-cyclic">Block-Cyclic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#d-dimensional">2D Dimensional</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="replicated.html">Replicated Distribution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#library-utilities">Library Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#numerical-libraries">Numerical Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tools">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#language-overview">Language Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Primers</a> &raquo;</li>
        
      <li>Distributions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/primers/distributions.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="distributions">
<span id="primers-distributions"></span><h1>Distributions<a class="headerlink" href="#distributions" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/chapel-lang/chapel/blob/master/test/release/examples/primers/distributions.chpl">View distributions.chpl on GitHub</a></p>
<p>This primer demonstrates uses of some of Chapel’s standard
distributions.  To use these distributions in a Chapel program,
the respective module must be used:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">BlockDist</span><span class="p">,</span> <span class="nx">CyclicDist</span><span class="p">,</span> <span class="nx">BlockCycDist</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DimensionalDist2D</span><span class="p">,</span> <span class="nx">ReplicatedDim</span><span class="p">,</span> <span class="nx">BlockCycDim</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ReplicatedDist</span></code> is covered in the <a class="reference internal" href="replicated.html#primers-replicated"><span class="std std-ref">Replicated Distribution</span></a> primer.</p>
<p>For each distribution, we’ll create a distributed domain and array
and then initialize it just to give a brief flavor of how the
distribution maps across locales.  Running this example on 6
locales does a nice job of illustrating the distribution
characteristics.</p>
<p>All of these distributions support options to map to a different
virtual locale grid than the one used by default (a multidimensional
factoring of the built-in <code class="docutils literal notranslate"><span class="pre">Locales</span></code> array), as well as
to control the amount of parallelism used in data parallel
loops.  For more details, see the documentation on
<a class="reference internal" href="../modules/layoutdist.html#layouts-and-distributions"><span class="std std-ref">Standard Distributions</span></a>.</p>
<p>Make the program size configurable from the command line.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">config</span> <span class="kd">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</pre></div>
</div>
<p>Declare a 2-dimensional domain <code class="docutils literal notranslate"><span class="pre">Space</span></code> that we will later use to
initialize the distributed domains.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">Space</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="p">,</span> <span class="mi">1</span><span class="o">..</span><span class="nx">n</span><span class="p">};</span>
</pre></div>
</div>
<div class="section" id="block-and-distribution-basics">
<h2>Block (and distribution basics)<a class="headerlink" href="#block-and-distribution-basics" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Block</span></code> distribution distributes a bounding box from
n-dimensional space across the target locale array viewed as an
n-dimensional virtual locale grid.  The bounding box is blocked
into roughly equal portions across the locales.  Note that domains
declared over a Block distribution can also store indices outside
of the bounding box; the bounding box is merely used to compute
the blocking of space.</p>
<p>In this example, we declare a 2-dimensional Block-distributed
domain <code class="docutils literal notranslate"><span class="pre">BlockSpace</span></code> and a Block-distributed array <code class="docutils literal notranslate"><span class="pre">BA</span></code> declared over
the domain.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">BlockSpace</span> <span class="o">=</span> <span class="nx">Space</span> <span class="k">dmapped</span> <span class="nx">Block</span><span class="p">(</span><span class="nx">boundingBox</span><span class="o">=</span><span class="nx">Space</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">BA</span><span class="p">:</span> <span class="p">[</span><span class="nx">BlockSpace</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>
</pre></div>
</div>
<p>To illustrate how the index set is distributed across locales,
we’ll use a forall loop to initialize each array element to the
locale ID that stores that index/element/iteration.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">forall</span> <span class="nx">ba</span> <span class="kd">in</span> <span class="nx">BA</span> <span class="k">do</span>
  <span class="nx">ba</span> <span class="o">=</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">hasSingleLocalSubdomain</span></code> method on arrays will return true if the
index set for a locale can be represented by a single domain.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">!</span><span class="nx">BA</span><span class="p">.</span><span class="nx">hasSingleLocalSubdomain</span><span class="p">()</span> <span class="k">then</span>
  <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;For a Block distribution, the index set per locale should be \</span>
<span class="s">      represented by a single domain&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>If the distribution’s subdomains can be represented as single subdomain,
we can use <code class="docutils literal notranslate"><span class="pre">localSubdomain()</span></code> to get the index set for the
current locale.</p>
<p>Below, we’ll use the index set to confirm that the array elements have the
correct locale ID.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">L</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="p">{</span>
  <span class="k">on</span> <span class="nx">L</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">indices</span> <span class="o">=</span> <span class="nx">BA</span><span class="p">.</span><span class="nx">localSubdomain</span><span class="p">();</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">indices</span> <span class="p">{</span>
      <span class="k">if</span> <span class="nx">BA</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">id</span> <span class="k">then</span>
        <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;Error: incorrect locale id&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Output the Block-distributed array to visually see how the elements
are partitioned across the locales.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Block Array Index Map&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">BA</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Most of Chapel’s standard distributions support an optional
<code class="docutils literal notranslate"><span class="pre">targetLocales</span></code> argument that permits you to pass in your own
array of locales to be targeted.  In general, the targetLocales
argument should match the rank of the distribution.  So for
example, to <code class="docutils literal notranslate"><span class="pre">Block</span></code>-distribute a domain over a 2D <code class="docutils literal notranslate"><span class="pre">numLocales</span> <span class="pre">*</span> <span class="pre">1</span></code>
view of the locale set, one could do something like the following.</p>
<p>We start by creating our own <code class="docutils literal notranslate"><span class="pre">MyLocales</span></code> array of the locale values.
Here we use the standard array reshape function for convenience.
Generally, this array could be accessed/assigned like any other.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyLocaleView</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="o">..#</span><span class="nx">numLocales</span><span class="p">,</span> <span class="mi">1</span><span class="o">..</span><span class="mi">1</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">MyLocales</span><span class="p">:</span> <span class="p">[</span><span class="nx">MyLocaleView</span><span class="p">]</span> <span class="nx">locale</span> <span class="o">=</span> <span class="nx">reshape</span><span class="p">(</span><span class="nx">Locales</span><span class="p">,</span> <span class="nx">MyLocaleView</span><span class="p">);</span>
</pre></div>
</div>
<p>Then we declare a distributed domain/array that targets
this view of the locales:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">BlockSpace2</span> <span class="o">=</span> <span class="nx">Space</span> <span class="k">dmapped</span> <span class="nx">Block</span><span class="p">(</span><span class="nx">boundingBox</span><span class="o">=</span><span class="nx">Space</span><span class="p">,</span>
                                        <span class="nx">targetLocales</span><span class="o">=</span><span class="nx">MyLocales</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">BA2</span><span class="p">:</span> <span class="p">[</span><span class="nx">BlockSpace2</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>
</pre></div>
</div>
<p>Now we can do a similar computation as before to verify where
each array element ended up:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">forall</span> <span class="nx">ba</span> <span class="kd">in</span> <span class="nx">BA2</span> <span class="k">do</span>
  <span class="nx">ba</span> <span class="o">=</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Block Array Index Map&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">BA2</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">targetLocales</span></code> method available on an array to get
the locales array used as targets:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="nx">L</span><span class="p">,</span> <span class="nx">ML</span><span class="p">)</span> <span class="kd">in</span> <span class="k">zip</span><span class="p">(</span><span class="nx">BA2</span><span class="p">.</span><span class="nx">targetLocales</span><span class="p">(),</span> <span class="nx">MyLocales</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">if</span> <span class="nx">L</span> <span class="o">!=</span> <span class="nx">ML</span> <span class="k">then</span>
    <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;Error: BA2.targetLocales() should equal MyLocales&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="cyclic">
<h2>Cyclic<a class="headerlink" href="#cyclic" title="Permalink to this headline">¶</a></h2>
<p>Next, we’ll perform a similar computation for the <code class="docutils literal notranslate"><span class="pre">Cyclic</span></code> distribution.
Cyclic distributions start at a designated n-dimensional index and
distribute the n-dimensional space across an n-dimensional array
of locales in a round-robin fashion (in each dimension).  As with
the <code class="docutils literal notranslate"><span class="pre">Block</span></code> distribution, domains declared using the Cyclic distribution
may have lower indices than the distribution’s starting index.
The starting index should just be considered a parameterization of
how the distribution is defined.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">CyclicSpace</span> <span class="o">=</span> <span class="nx">Space</span> <span class="k">dmapped</span> <span class="nx">Cyclic</span><span class="p">(</span><span class="nx">startIdx</span><span class="o">=</span><span class="nx">Space</span><span class="p">.</span><span class="nx">low</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">CA</span><span class="p">:</span> <span class="p">[</span><span class="nx">CyclicSpace</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>

<span class="k">forall</span> <span class="nx">ca</span> <span class="kd">in</span> <span class="nx">CA</span> <span class="k">do</span>
  <span class="nx">ca</span> <span class="o">=</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Cyclic Array Index Map&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">CA</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>The domain returned by <code class="docutils literal notranslate"><span class="pre">localSubdomain</span></code> need not be a dense block, as is
the case for the <code class="docutils literal notranslate"><span class="pre">Cyclic</span></code> distribution.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">indices</span> <span class="o">=</span> <span class="nx">CA</span><span class="p">.</span><span class="nx">localSubdomain</span><span class="p">();</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">indices</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">CA</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">then</span>
      <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;Error: Cyclic array values on Locale 0 should be zero&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="block-cyclic">
<h2>Block-Cyclic<a class="headerlink" href="#block-cyclic" title="Permalink to this headline">¶</a></h2>
<p>Next, we’ll use a <code class="docutils literal notranslate"><span class="pre">BlockCyclic</span></code> distribution.  Block-Cyclic
distributions also deal out indices in a round-robin fashion,
but rather than dealing out singleton indices, they deal out blocks
of indices.  Thus, the <code class="docutils literal notranslate"><span class="pre">BlockCyclic</span></code> distribution is parameterized
by a starting index (as with <code class="docutils literal notranslate"><span class="pre">Cyclic</span></code>) and a block size (per
dimension) specifying how large the chunks to be dealt out are.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">BlkCycSpace</span> <span class="o">=</span> <span class="nx">Space</span> <span class="k">dmapped</span> <span class="nx">BlockCyclic</span><span class="p">(</span><span class="nx">startIdx</span><span class="o">=</span><span class="nx">Space</span><span class="p">.</span><span class="nx">low</span><span class="p">,</span>
                                              <span class="nx">blocksize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
<span class="kd">var</span> <span class="nx">BCA</span><span class="p">:</span> <span class="p">[</span><span class="nx">BlkCycSpace</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>

<span class="k">forall</span> <span class="nx">bca</span> <span class="kd">in</span> <span class="nx">BCA</span> <span class="k">do</span>
  <span class="nx">bca</span> <span class="o">=</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

<span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Block-Cyclic Array Index Map&quot;</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">(</span><span class="nx">BCA</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>A locale’s index set for a Block-Cyclic distribution cannot be represented
by a single subdomain.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nx">BCA</span><span class="p">.</span><span class="nx">hasSingleLocalSubdomain</span><span class="p">()</span> <span class="k">then</span>
  <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;A Block-Cyclic index set cannot be represented by a single subdomain&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>If the local index set cannot be represented by a single subdomain,
we can use the <code class="docutils literal notranslate"><span class="pre">localSubdomains</span></code> iterator to yield a number of domains
that represent the whole index set.</p>
<p>Let’s write a function that uses <code class="docutils literal notranslate"><span class="pre">localSubdomains</span></code> to verify the
correctness of the array values.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">verifyID</span><span class="p">(</span><span class="nx">Data</span><span class="p">:</span> <span class="p">[])</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">L</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="p">{</span>
    <span class="k">on</span> <span class="nx">L</span> <span class="p">{</span>
      <span class="k">for</span> <span class="nx">indices</span> <span class="kd">in</span> <span class="nx">Data</span><span class="p">.</span><span class="nx">localSubdomains</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="nx">indices</span> <span class="p">{</span>
          <span class="k">if</span> <span class="nx">Data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">id</span> <span class="k">then</span>
            <span class="nx">halt</span><span class="p">(</span><span class="s">&quot;Error: incorrect locale id&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">verifyID</span><span class="p">(</span><span class="nx">BCA</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">localSubdomains</span></code> iterator is also available on distributions that
can represent a locale’s index set with a single domain. This allows us to
write more general code that will work for all distributions.</p>
<p>This means that we can call the ‘verifyID’ function on any array, like the
‘BA’ array from earlier.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="nx">verifyID</span><span class="p">(</span><span class="nx">BA</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="d-dimensional">
<h2>2D Dimensional<a class="headerlink" href="#d-dimensional" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">DimensionalDist2D</span></code> distribution lets us build a 2D distribution
as a composition of specifiers for individual dimensions.
Under such a “dimensional” distribution each dimension is handled
independently of the other.</p>
<p>The dimension specifiers are similar to the corresponding multi-dimensional
distributions in constructor arguments and index-to-locale mapping rules.
However, instead of an array of locales, a specifier constructor
accepts just the number of locales that the indices in the corresponding
dimension will be distributed across.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DimensionalDist2D</span></code> constructor requires:
an <code class="docutils literal notranslate"><span class="pre">[0..nl1-1,</span> <span class="pre">0..nl2-1]</span></code> array of locales, where
<code class="docutils literal notranslate"><span class="pre">nl1</span></code> and <code class="docutils literal notranslate"><span class="pre">nl2</span></code> are the number of locales in each dimension, and
two dimension specifiers, created for <code class="docutils literal notranslate"><span class="pre">nl1</span></code> and <code class="docutils literal notranslate"><span class="pre">nl2</span></code> locale counts,
resp.</p>
<p>Presently, the following dimension specifiers are available
(shown here with their constructor arguments):</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ReplicatedDim(numLocales)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">BlockDim(numLocales,</span> <span class="pre">boundingBoxLow,</span> <span class="pre">boundingBoxHigh)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">BlockCyclicDim(lowIdx,</span> <span class="pre">blockSize,</span> <span class="pre">numLocales)</span></code></li>
</ul>
<p>The following example creates a dimensional distribution that
replicates over 2 locales (when available) in the first dimension
and distributes using block-cyclic distribution in the second dimension.
The example computes <code class="docutils literal notranslate"><span class="pre">nl1</span></code> and <code class="docutils literal notranslate"><span class="pre">nl2</span></code> and reshapes <code class="docutils literal notranslate"><span class="pre">MyLocales</span></code>
correspondingly.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="p">(</span><span class="nx">nl1</span><span class="p">,</span> <span class="nx">nl2</span><span class="p">)</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">numLocales</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">then</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">numLocales</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">MyLocaleView</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="o">..#</span><span class="nx">nl1</span><span class="p">,</span> <span class="mi">0</span><span class="o">..#</span><span class="nx">nl2</span><span class="p">};</span>
<span class="nx">MyLocales</span> <span class="o">=</span> <span class="nx">reshape</span><span class="p">(</span><span class="nx">Locales</span><span class="p">[</span><span class="mi">0</span><span class="o">..#</span><span class="nx">nl1</span><span class="o">*</span><span class="nx">nl2</span><span class="p">],</span> <span class="nx">MyLocaleView</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">DimReplicatedBlockcyclicSpace</span> <span class="o">=</span> <span class="nx">Space</span>
  <span class="k">dmapped</span> <span class="nx">DimensionalDist2D</span><span class="p">(</span><span class="nx">MyLocales</span><span class="p">,</span>
                            <span class="k">new</span> <span class="nx">ReplicatedDim</span><span class="p">(</span><span class="nx">numLocales</span> <span class="o">=</span> <span class="nx">nl1</span><span class="p">),</span>
                            <span class="k">new</span> <span class="nx">BlockCyclicDim</span><span class="p">(</span><span class="nx">numLocales</span> <span class="o">=</span> <span class="nx">nl2</span><span class="p">,</span>
                                               <span class="nx">lowIdx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">blockSize</span> <span class="o">=</span> <span class="mi">2</span><span class="p">));</span>

<span class="kd">var</span> <span class="nx">DRBA</span><span class="p">:</span> <span class="p">[</span><span class="nx">DimReplicatedBlockcyclicSpace</span><span class="p">]</span> <span class="kt">int</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ReplicatedDim</span></code> specifier always accesses the local replicand.
(This differs from how the <code class="docutils literal notranslate"><span class="pre">Replicated</span></code> distribution works.)</p>
<p>This example visits each replicand. The behavior is the same
regardless of the second index into <code class="docutils literal notranslate"><span class="pre">MyLocales</span></code> below.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">locId1</span> <span class="kd">in</span> <span class="mi">0</span><span class="o">..#</span><span class="nx">nl1</span> <span class="k">do</span> <span class="k">on</span> <span class="nx">MyLocales</span><span class="p">[</span><span class="nx">locId1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">{</span>

  <span class="k">forall</span> <span class="nx">drba</span> <span class="kd">in</span> <span class="nx">DRBA</span> <span class="k">do</span>
    <span class="nx">drba</span> <span class="o">=</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Dimensional2D(Replicated,BlockCyclic) Array Index Map&quot;</span><span class="p">,</span>
          <span class="s">&quot; from &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">);</span>

  <span class="c1">// Technicality: &#39;writeln(DRBA)&#39; would read DRBA always on Locale 0.</span>
  <span class="c1">// Since we want to see what DRBA contains on the current locale,</span>
  <span class="c1">// we use &#39;Helper&#39; that is mapped using the default distribution.</span>
  <span class="c1">// &#39;Helper = DRBA&#39; captures the view of DRBA on the current locale,</span>
  <span class="c1">// which we then print out.</span>

  <span class="kd">const</span> <span class="nx">Helper</span><span class="p">:</span> <span class="p">[</span><span class="nx">Space</span><span class="p">]</span> <span class="kt">int</span> <span class="o">=</span> <span class="nx">DRBA</span><span class="p">;</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="nx">Helper</span><span class="p">);</span>
  <span class="nx">writeln</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="replicated.html" class="btn btn-neutral float-right" title="Replicated Distribution" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="reductions.html" class="btn btn-neutral float-left" title="Reductions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>