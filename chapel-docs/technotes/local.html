

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The ‘local’ keyword &mdash; Chapel Documentation 1.23</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Locale Models" href="localeModels.html" />
    <link rel="prev" title="LLVM Support" href="llvm.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.23
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.23";
$pagename = "technotes/local";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Technical Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="allocators.html">Chapel’s Use of Allocators</a></li>
<li class="toctree-l2"><a class="reference internal" href="atomics.html">Runtime Support for Atomics</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsi.html">Domain Map Standard Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="errorHandling.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="extern.html">C Interoperability</a></li>
<li class="toctree-l2"><a class="reference internal" href="firstClassFns.html">First-class Functions in Chapel</a></li>
<li class="toctree-l2"><a class="reference internal" href="fortranInterop.html">Fortran Interoperability</a></li>
<li class="toctree-l2"><a class="reference internal" href="forwarding.html">Forwarding Methods Calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="globalvars.html">Global Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="initTypeAlias.html">Invoking Initializers with a Generic Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="initequals.html">The ‘init=’ Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="libraries.html">Exporting Chapel as a Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimeChecking.html">Lifetime Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="llvm.html">LLVM Support</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The ‘local’ keyword</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-local-statement">The ‘local’ Statement</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#syntax">Syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conditional-local">Conditional <cite>local</cite></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-local-do-on-statement">The ‘local do on’ Statement</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="localeModels.html">Locale Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="main.html">Support for main() Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="module_include.html">Including Sub-Modules from Separate Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="module_search.html">Module Search Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="nilChecking.html">Checking for Nil Dereferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="overloadSets.html">Checking Overload Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="partialInstantiations.html">Partial Instantiations</a></li>
<li class="toctree-l2"><a class="reference internal" href="reduceIntents.html">Reduce Intents</a></li>
<li class="toctree-l2"><a class="reference internal" href="sets.html">Associative Set Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="subquery.html">Querying a Local Subdomain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../primers/index.html">Primers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Technical Notes</a> &raquo;</li>
        
      <li>The ‘local’ keyword</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/technotes/local.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-local-keyword">
<span id="readme-local"></span><h1>The ‘local’ keyword<a class="headerlink" href="#the-local-keyword" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-local-statement">
<h2>The ‘local’ Statement<a class="headerlink" href="#the-local-statement" title="Permalink to this headline">¶</a></h2>
<p>This README describes the <code class="docutils literal notranslate"><span class="pre">local</span></code> statement in the Chapel language.
Its definition and implementation is an area of ongoing work and it
should be used with caution.</p>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">local</span></code> construct in Chapel performs runtime checks for any
communication within the construct. If communication occurs, an error
is reported. The checks are performed in the code within the lexical
scope of the construct, as well as in all function calls performed by
that code, directly or indirectly, explicitly or implicitly. The
checks can be disabled with the <code class="docutils literal notranslate"><span class="pre">--no-local-checks</span></code> flag, which is implied
by the <code class="docutils literal notranslate"><span class="pre">--no-checks</span></code> and <code class="docutils literal notranslate"><span class="pre">--fast</span></code> flags.</p>
<p>Communication occurs in the following cases:</p>
<ul class="simple">
<li>remote memory (i.e. data not located on the current locale)
is referenced (read from or assigned to), or</li>
<li>an <code class="docutils literal notranslate"><span class="pre">on</span></code> statement attempts to execute on a remote locale.</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">local</span></code> construct is useful to establish that certain code is
communication free. This may be desired, for example, when tuning
the performance of a program, as communication usually slows down
execution.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">local</span></code> construct does not necessarily indicate the cause of
communication when present. See the <a class="reference internal" href="../modules/standard/CommDiagnostics.html#module-CommDiagnostics" title="CommDiagnostics: This module provides support for reporting and counting"><code class="xref chpl chpl-mod docutils literal notranslate"><span class="pre">CommDiagnostics</span></code></a> module for ways to
diagnose communication.</p>
</div>
<div class="section" id="syntax">
<h3>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">local</span></code> construct is a statement. It consists of the <code class="docutils literal notranslate"><span class="pre">local</span></code> keyword
followed by a do statement or block:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>local-statement:
    &quot;local&quot; [condition] do statement
    &quot;local&quot; [condition] block-statement
</pre></div>
</div>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of a <code class="docutils literal notranslate"><span class="pre">local</span></code> statement:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">local</span> <span class="k">do</span>
  <span class="nx">x</span> <span class="o">=</span> <span class="nx">A</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</pre></div>
</div>
<p>The inner statement is often a block, commonly referred to as a
“local block”:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">local</span> <span class="p">{</span>
  <span class="nx">initializeMyData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="nx">compute</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the above examples, the Chapel implementation checks whether <code class="docutils literal notranslate"><span class="pre">x</span></code>,
as well as all memory referenced during the calls of <code class="docutils literal notranslate"><span class="pre">A.this(5)</span></code>
(an implicit call for <code class="docutils literal notranslate"><span class="pre">A(5)</span></code>), initializeMyData(), and compute(),
are located on the current locale. Otherwise an error is reported.
Analogously, if <code class="docutils literal notranslate"><span class="pre">on</span></code> statement(s) are executed during these calls
that attempt to execute on a different locale, an error is reported.</p>
</div>
<div class="section" id="conditional-local">
<h3>Conditional <cite>local</cite><a class="headerlink" href="#conditional-local" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">local</span></code> statement behavior can be controlled via the optional
conditional expression.</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">local</span> <span class="nx">data</span><span class="p">.</span><span class="nx">locale</span> <span class="o">==</span> <span class="nx">here</span> <span class="p">{</span>
  <span class="nx">initializeMyData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="nx">compute</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above example will be localized only if <code class="docutils literal notranslate"><span class="pre">data</span></code> resides in the
current locale. Conditional local statement above compiled identically
as:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">locale</span> <span class="o">==</span> <span class="nx">here</span> <span class="p">{</span>
  <span class="k">local</span> <span class="p">{</span>
    <span class="nx">initializeMyData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">compute</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="nx">initializeMyData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="nx">compute</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This implies that local statements in outer dynamic/static scopes will
override the inner ones. i.e. if <code class="docutils literal notranslate"><span class="pre">data.locale</span> <span class="pre">==</span> <span class="pre">here</span></code> evaluates to
<code class="docutils literal notranslate"><span class="pre">true</span></code>, localized bodies of <code class="docutils literal notranslate"><span class="pre">initializeMyData</span></code> and <code class="docutils literal notranslate"><span class="pre">compute</span></code> will be
used whether they have any <code class="docutils literal notranslate"><span class="pre">local</span></code> statement, or not. (This includes
<code class="docutils literal notranslate"><span class="pre">local</span> <span class="pre">false</span></code> blocks).</p>
</div>
</div>
<div class="section" id="the-local-do-on-statement">
<h2>The ‘local do on’ Statement<a class="headerlink" href="#the-local-do-on-statement" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">local</span> <span class="pre">do</span> <span class="pre">on</span></code> construct in Chapel performs an on-statement on a
sublocale within the current node. For example:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">0</span><span class="o">..#</span><span class="nx">here</span><span class="p">.</span><span class="nx">getChildCount</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">local</span> <span class="k">do</span> <span class="k">on</span> <span class="nx">here</span><span class="p">.</span><span class="nx">getChild</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;On sublocale &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">--local-checks</span></code> flag is enabled, a runtime check will be inserted
to confirm that the on-statement is performed within the same node.
<code class="docutils literal notranslate"><span class="pre">--local-checks</span></code> is enabled by default and can be disabled with
<code class="docutils literal notranslate"><span class="pre">--no-local-checks</span></code>, <code class="docutils literal notranslate"><span class="pre">--no-checks</span></code>, or <code class="docutils literal notranslate"><span class="pre">--fast</span></code>.</p>
<p>For example this complete program would produce a runtime error if the number
of locales is greater than one:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">LastLocale</span> <span class="o">=</span> <span class="nx">Locales</span><span class="p">[</span><span class="nx">numLocales</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="k">local</span> <span class="k">do</span> <span class="k">on</span> <span class="nx">LastLocale</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;On remote locale &quot;</span><span class="p">,</span> <span class="nx">LastLocale</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">local</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">err</span> <span class="o">-</span><span class="n">nl</span> <span class="mi">2</span>
<span class="n">local</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">err</span><span class="o">.</span><span class="n">chpl</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">Local</span><span class="o">-</span><span class="n">on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">local</span>
</pre></div>
</div>
<p>This program begins executing on Locale 0, so when the <code class="docutils literal notranslate"><span class="pre">local</span> <span class="pre">do</span> <span class="pre">on</span></code>
attempts to execute on a different node (the last Locale) we see a
runtime error.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">local</span> <span class="pre">do</span> <span class="pre">on</span></code> construct functions similarly to a normal
on-statement in all other ways. Note that it is unrelated to <code class="docutils literal notranslate"><span class="pre">local</span></code>
statements or <code class="docutils literal notranslate"><span class="pre">local</span></code> blocks, and that it has no impact on what
communication is or is not allowed (other than where the on-statement
can execute).</p>
<p>With this information the compiler can reduce overhead associated with wide
pointers and hopefully improve performance.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="localeModels.html" class="btn btn-neutral float-right" title="Locale Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="llvm.html" class="btn btn-neutral float-left" title="LLVM Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>