

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Support for main() Functions &mdash; Chapel Documentation 1.23</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Including Sub-Modules from Separate Files" href="module_include.html" />
    <link rel="prev" title="Locale Models" href="localeModels.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation

<!-- display version if button won't be rendered -->
<?php if (false) { ?>
<br>1.23
<?php } ?>

</a>

<?php
// Variables given by sphinx
$chplTitle = "1.23";
$pagename = "technotes/main";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Technical Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="allocators.html">Chapel’s Use of Allocators</a></li>
<li class="toctree-l2"><a class="reference internal" href="atomics.html">Runtime Support for Atomics</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsi.html">Domain Map Standard Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="errorHandling.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="extern.html">C Interoperability</a></li>
<li class="toctree-l2"><a class="reference internal" href="firstClassFns.html">First-class Functions in Chapel</a></li>
<li class="toctree-l2"><a class="reference internal" href="fortranInterop.html">Fortran Interoperability</a></li>
<li class="toctree-l2"><a class="reference internal" href="forwarding.html">Forwarding Methods Calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="globalvars.html">Global Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="initTypeAlias.html">Invoking Initializers with a Generic Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="initequals.html">The ‘init=’ Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="libraries.html">Exporting Chapel as a Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimeChecking.html">Lifetime Checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="llvm.html">LLVM Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="local.html">The ‘local’ keyword</a></li>
<li class="toctree-l2"><a class="reference internal" href="localeModels.html">Locale Models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Support for main() Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#returning-a-status-value">Returning a status value</a></li>
<li class="toctree-l3"><a class="reference internal" href="#having-main-accept-command-line-arguments">Having main() accept command-line arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="module_include.html">Including Sub-Modules from Separate Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="module_search.html">Module Search Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="nilChecking.html">Checking for Nil Dereferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="overloadSets.html">Checking Overload Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="partialInstantiations.html">Partial Instantiations</a></li>
<li class="toctree-l2"><a class="reference internal" href="reduceIntents.html">Reduce Intents</a></li>
<li class="toctree-l2"><a class="reference internal" href="sets.html">Associative Set Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="subquery.html">Querying a Local Subdomain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../primers/index.html">Primers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec/index.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Documentation Archives</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chapel Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Technical Notes</a> &raquo;</li>
        
      <li>Support for main() Functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/technotes/main.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="support-for-main-functions">
<span id="readme-main"></span><h1>Support for main() Functions<a class="headerlink" href="#support-for-main-functions" title="Permalink to this headline">¶</a></h1>
<p>After running module initialization code (top-level statements in
modules), a Chapel program will start executing from the entry point,
a function named main().  Chapel’s main() function has typically taken
no arguments and had no return type.  This README describes initial
support for returning a status value and making main() take arbitrary
command-line arguments.</p>
<div class="section" id="returning-a-status-value">
<h2>Returning a status value<a class="headerlink" href="#returning-a-status-value" title="Permalink to this headline">¶</a></h2>
<p>Traditionally, the only way to return a nonzero exit value from a
Chapel program has been to call exit().  Optionally, main() can be
declared to return an integer in which case the value returned serves
as the status value.</p>
</div>
<div class="section" id="having-main-accept-command-line-arguments">
<h2>Having main() accept command-line arguments<a class="headerlink" href="#having-main-accept-command-line-arguments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>Because Chapel programs have traditionally accepted a number of
“built-in” flags and configuration variables, there has been no way to
create a Chapel program that accepts arguments like an arbitrary list
of filenames or flags that might conflict with built-in capabilities.
For most uses, Chapel’s existing config variable support is useful and
easy; occasionally, however, one wants to fully control argument
processing.</p>
<p>If a program’s main() function is declared to take no arguments, Chapel
will behave as it traditionally has – built-in flags and config
settings will be handled and unrecognized flags will trigger an error.</p>
<p>Alternatively, a main() function can be declared to take an array of
strings as an argument.  By doing so, the program opts-in to explicit
argument handling, described in the remainder of this README.</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>To use this feature, declare main as follows:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">proc</span> <span class="nf">main</span><span class="p">(</span><span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...body...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When main is so declared, Chapel’s default command line argument
processing changes. Rather than generate an error message when an
unknown argument is encountered, that argument will instead be passed
on to this main(args) function. Arguments corresponding to config
variables or Chapel’s predefined flags (like <code class="docutils literal notranslate"><span class="pre">-nl</span></code>, <code class="docutils literal notranslate"><span class="pre">-b</span></code>, etc) will still
be processed and will not be passed on to the main(args) function.</p>
<p>To be clear, the arguments that would be handled without using this
feature will continue to behave as usual. The difference is that other
arguments will be passed to main(args) rather than generating an error
message. The only exception to this, is <code class="docutils literal notranslate"><span class="pre">--help</span></code> and <code class="docutils literal notranslate"><span class="pre">-h</span></code>.</p>
<p>Prior to this feature, a Chapel program would always exit immediately
after printing the help message. A programmer might want to print
other information explaining what non-config-var command line
arguments are available and what they might do. For this reason, when
a Chapel program includes a main declared to take arguments, <code class="docutils literal notranslate"><span class="pre">--help</span></code>
and <code class="docutils literal notranslate"><span class="pre">-h</span></code> will be passed on to the main(args) function.  The function
Help.printUsage() will print out the familiar config var table.</p>
<p>To gain access to this new function requires a module:</p>
<p><code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">Help;</span></code></p>
<p>From that module, the function printDefaultUsage() is available. For
example, consider the following program:</p>
<div class="highlight-chapel notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Help</span><span class="p">;</span>

<span class="k">proc</span> <span class="nf">main</span><span class="p">(</span><span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">a</span> <span class="kd">in</span> <span class="nx">args</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">a</span><span class="o">==</span><span class="s">&quot;--help&quot;</span> <span class="p">{</span>
      <span class="nx">printUsage</span><span class="p">();</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;\nEXTRA ARGUMENTS:&quot;</span><span class="p">);</span>
      <span class="nx">writeln</span><span class="p">(</span>  <span class="s">&quot;================&quot;</span><span class="p">);</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;You can provide an arbitrary list of filenames.&quot;</span><span class="p">);</span>
      <span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This program scans its argument list for <code class="docutils literal notranslate"><span class="pre">--help</span></code>, and if found, it
prints the standard usage message as well as some additional text
explaining the purpose of the extra arguments. Note that this could be
used by a program which simply wants to add explanatory text to the
<code class="docutils literal notranslate"><span class="pre">--help</span></code> output without actually handling any additional arguments.</p>
<p>Finally, as is common in GNU programs, there is a way to suspend
argument processing when main is declared to take arguments. Suppose
you are writing <code class="docutils literal notranslate"><span class="pre">rm</span></code> in Chapel and need to delete a file named
<code class="docutils literal notranslate"><span class="pre">--memTrack=true</span></code>. Your program will consume this flag during startup,
rather than passing it on to the declared main function. However,
placing the argument <code class="docutils literal notranslate"><span class="pre">--</span></code> in the argument list will cause all
following arguments to be passed to the declared main function and
will suspend handling of any builtin command line
arguments. Specifically, if <code class="docutils literal notranslate"><span class="pre">myprogram</span></code> is a Chapel program which has
declared main to take arguments:</p>
<p><code class="docutils literal notranslate"><span class="pre">./myprogram</span> <span class="pre">--</span> <span class="pre">--memTrack=true</span></code></p>
<p>will result in the program receiving <code class="docutils literal notranslate"><span class="pre">--memTrack=true</span></code> as the first
argument after the executable name.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="module_include.html" class="btn btn-neutral float-right" title="Including Sub-Modules from Separate Files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="localeModels.html" class="btn btn-neutral float-left" title="Locale Models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Hewlett Packard Enterprise Development LP

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 



</body>
</html>